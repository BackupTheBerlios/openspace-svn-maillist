<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Openspace-svn] r227 - in branches/mloskot-style-refactoring: . src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/openspace-svn/2005-November/index.html" >
   <LINK REL="made" HREF="mailto:openspace-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenspace-svn%5D%20r227%20-%20in%20branches/mloskot-style-refactoring%3A%20.%20src&In-Reply-To=%3C200511111807.jABI7u8r012650%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000006.html">
   <LINK REL="Next"  HREF="000008.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Openspace-svn] r227 - in branches/mloskot-style-refactoring: . src</H1>
    <B>compbatant at berlios.de</B> 
    <A HREF="mailto:openspace-svn%40lists.berlios.de?Subject=Re%3A%20%5BOpenspace-svn%5D%20r227%20-%20in%20branches/mloskot-style-refactoring%3A%20.%20src&In-Reply-To=%3C200511111807.jABI7u8r012650%40sheep.berlios.de%3E"
       TITLE="[Openspace-svn] r227 - in branches/mloskot-style-refactoring: . src">compbatant at berlios.de
       </A><BR>
    <I>Fri Nov 11 19:07:56 CET 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000006.html">[Openspace-svn] r226 - branches/mloskot-style-refactoring/src
</A></li>
        <LI>Next message: <A HREF="000008.html">[Openspace-svn] r228 - branches/mloskot-style-refactoring/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9">[ date ]</a>
              <a href="thread.html#9">[ thread ]</a>
              <a href="subject.html#9">[ subject ]</a>
              <a href="author.html#9">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: compbatant
Date: 2005-11-11 19:07:47 +0100 (Fri, 11 Nov 2005)
New Revision: 227

Modified:
   branches/mloskot-style-refactoring/aclocal.m4
   branches/mloskot-style-refactoring/config.guess
   branches/mloskot-style-refactoring/config.sub
   branches/mloskot-style-refactoring/configure
   branches/mloskot-style-refactoring/ltmain.sh
   branches/mloskot-style-refactoring/src/Makefile
   branches/mloskot-style-refactoring/src/OSFileList.cpp
Log:
prawie dziala


Modified: branches/mloskot-style-refactoring/aclocal.m4
===================================================================
--- branches/mloskot-style-refactoring/aclocal.m4	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/aclocal.m4	2005-11-11 18:07:47 UTC (rev 227)
@@ -14,7 +14,6 @@
 # libtool.m4 - Configure libtool for the host system. -*-Autoconf-*-
 
 # serial 47 AC_PROG_LIBTOOL
-# Debian $Rev: 214 $
 
 
 # AC_PROVIDE_IFELSE(MACRO-NAME, IF-PROVIDED, IF-NOT-PROVIDED)
@@ -124,7 +123,7 @@
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='sed -e s/^X//'
+Xsed='sed -e 1s/^X//'
 [sed_quote_subst='s/\([\\&quot;\\`$\\\\]\)/\\\1/g']
 
 # Same as above, but do not quote variable references.
@@ -192,6 +191,8 @@
   old_archive_cmds=&quot;$old_archive_cmds~\$RANLIB \$oldlib&quot;
 fi
 
+_LT_CC_BASENAME([$compiler])
+
 # Only perform the check for file, if the check method requires it
 case $deplibs_check_method in
 file_magic*)
@@ -217,6 +218,14 @@
     [pic_mode=default])
 test -z &quot;$pic_mode&quot; &amp;&amp; pic_mode=default
 
+# Check if we have a version mismatch between libtool.m4 and ltmain.sh.
+#
+# Note:  This should be in AC_LIBTOOL_SETUP, _after_ $ltmain have been defined.
+#        We also should do it _before_ AC_LIBTOOL_LANG_C_CONFIG that actually
+#        calls AC_LIBTOOL_CONFIG and creates libtool.
+#
+_LT_VERSION_CHECK
+
 # Use C for the default configuration in the libtool script
 tagname=
 AC_LIBTOOL_LANG_C_CONFIG
@@ -224,6 +233,41 @@
 ])# AC_LIBTOOL_SETUP
 
 
+# _LT_VERSION_CHECK
+# -----------------
+AC_DEFUN([_LT_VERSION_CHECK],
+[AC_MSG_CHECKING([for correct ltmain.sh version])
+if test -z &quot;$ltmain&quot;; then
+  AC_MSG_RESULT(no)
+  echo
+  echo &quot;*** [Gentoo] sanity check failed! ***&quot;
+  echo &quot;*** \$ltmain is not defined, please check the patch for consistency! ***&quot;
+  echo
+  exit 1
+fi
+gentoo_lt_version=&quot;1.5.18&quot;
+gentoo_ltmain_version=`grep '^[[:space:]]*VERSION=' $ltmain | sed -e 's|^[[:space:]]*VERSION=||'`
+if test &quot;$gentoo_lt_version&quot; != &quot;$gentoo_ltmain_version&quot;; then
+  AC_MSG_RESULT(no)
+  echo
+  echo &quot;*** [Gentoo] sanity check failed! ***&quot;
+  echo &quot;*** libtool.m4 and ltmain.sh have a version mismatch! ***&quot;
+  echo &quot;*** (libtool.m4 = $gentoo_lt_version, ltmain.sh = $gentoo_ltmain_version) ***&quot;
+  echo
+  echo &quot;Please run:&quot;
+  echo
+  echo &quot;  libtoolize --copy --force&quot;
+  echo
+  echo &quot;if appropriate, please contact the maintainer of this&quot;
+  echo &quot;package (or your distribution) for help.&quot;
+  echo
+  exit 1
+else
+  AC_MSG_RESULT(yes)
+fi
+])# _LT_VERSION_CHECK
+
+
 # _LT_AC_SYS_COMPILER
 # -------------------
 AC_DEFUN([_LT_AC_SYS_COMPILER],
@@ -237,6 +281,48 @@
 ])# _LT_AC_SYS_COMPILER
 
 
+# _LT_CC_BASENAME(CC)
+# -------------------
+# Calculate cc_basename.  Skip known compiler wrappers and cross-prefix.
+AC_DEFUN([_LT_CC_BASENAME],
+[for cc_temp in $1&quot;&quot;; do
+  case $cc_temp in
+    compile | *[[\\/]]compile | ccache | *[[\\/]]ccache ) ;;
+    distcc | *[[\\/]]distcc | purify | *[[\\/]]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
+])
+
+
+# _LT_COMPILER_BOILERPLATE
+# ------------------------
+# Check for compiler boilerplate output or warnings with
+# the simple compiler test code.
+AC_DEFUN([_LT_COMPILER_BOILERPLATE],
+[ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+])# _LT_COMPILER_BOILERPLATE
+
+
+# _LT_LINKER_BOILERPLATE
+# ----------------------
+# Check for linker boilerplate output or warnings with
+# the simple link test code.
+AC_DEFUN([_LT_LINKER_BOILERPLATE],
+[ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+])# _LT_LINKER_BOILERPLATE
+
+
 # _LT_AC_SYS_LIBPATH_AIX
 # ----------------------
 # Links a minimal program and checks the executable
@@ -309,7 +395,7 @@
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-if test &quot;X${CDPATH+set}&quot; = Xset; then CDPATH=:; export CDPATH; fi
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
 
 if test -z &quot;$ECHO&quot;; then
 if test &quot;X${echo_test_string+set}&quot; != Xset; then
@@ -524,6 +610,20 @@
   rm -rf conftest*
   ;;
 
+*-*-linux*)
+  # Test if the compiler is 64bit
+  echo 'int i;' &gt; conftest.$ac_ext
+  lt_cv_cc_64bit_output=no
+  if AC_TRY_EVAL(ac_compile); then
+    case `/usr/bin/file conftest.$ac_objext` in
+    *&quot;ELF 64&quot;*)
+      lt_cv_cc_64bit_output=yes
+      ;;
+    esac
+  fi
+  rm -rf conftest*
+  ;;
+  
 *-*-sco3.2v5*)
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
   SAVE_CFLAGS=&quot;$CFLAGS&quot;
@@ -578,8 +678,10 @@
    echo &quot;$as_me:__oline__: \$? = $ac_status&quot; &gt;&amp;AS_MESSAGE_LOG_FD
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        $2=yes
      fi
    fi
@@ -610,6 +712,11 @@
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1&gt;&amp;AS_MESSAGE_LOG_FD
+       $echo &quot;X$_lt_linker_boilerplate&quot; | $Xsed &gt; conftest.exp
+       $SED '/^$/d' conftest.err &gt;conftest.er2
+       if diff conftest.exp conftest.er2 &gt;/dev/null; then
+         $2=yes
+       fi
      else
        $2=yes
      fi
@@ -668,11 +775,38 @@
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
- *)
+  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
+    # This has been around since 386BSD, at least.  Likely further.
+    if test -x /sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
+    elif test -x /usr/sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
+    else
+      lt_cv_sys_max_cmd_len=65536 # usable default for *BSD
+    fi
+    # And add a safety zone
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
+    ;;
+  osf*)
+    # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
+    # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
+    # nice to cause kernel panics so lets avoid the loop below.
+    # First set a reasonable default.
+    lt_cv_sys_max_cmd_len=16384
+    # 
+    if test -x /sbin/sysconfig; then
+      case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
+        *1*) lt_cv_sys_max_cmd_len=-1 ;;
+      esac
+    fi
+    ;;
+  *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
     # we can't tell.
-    while (test &quot;X&quot;`$CONFIG_SHELL [$]0 --fallback-echo &quot;X$teststring&quot; 2&gt;/dev/null` \
+    SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
+    while (test &quot;X&quot;`$SHELL [$]0 --fallback-echo &quot;X$teststring&quot; 2&gt;/dev/null` \
 	       = &quot;XX$teststring&quot;) &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
 	    new_result=`expr &quot;X$teststring&quot; : &quot;.*&quot; 2&gt;&amp;1` &amp;&amp;
 	    lt_cv_sys_max_cmd_len=$new_result &amp;&amp;
@@ -938,7 +1072,9 @@
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test ! -s out/conftest.err; then
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt; out/conftest.exp
+     $SED '/^$/d' out/conftest.err &gt;out/conftest.er2
+     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 &gt;/dev/null; then
        _LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
      fi
    fi
@@ -1006,8 +1142,8 @@
 [AC_MSG_CHECKING([how to hardcode library paths into programs])
 _LT_AC_TAGVAR(hardcode_action, $1)=
 if test -n &quot;$_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)&quot; || \
-   test -n &quot;$_LT_AC_TAGVAR(runpath_var $1)&quot; || \
-   test &quot;X$_LT_AC_TAGVAR(hardcode_automatic, $1)&quot;=&quot;Xyes&quot; ; then
+   test -n &quot;$_LT_AC_TAGVAR(runpath_var, $1)&quot; || \
+   test &quot;X$_LT_AC_TAGVAR(hardcode_automatic, $1)&quot; = &quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$_LT_AC_TAGVAR(hardcode_direct, $1)&quot; != no &amp;&amp;
@@ -1174,7 +1310,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi4*)
+bsdi[[45]]*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -1232,11 +1368,35 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
 
+  linux*)
+    if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      supports_anon_versioning=no
+      case `$LD -v 2&gt;/dev/null` in
+        *\ [01].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+        *\ 2.11.*) ;; # other 2.11 versions
+        *) supports_anon_versioning=yes ;;
+      esac
+      if test $supports_anon_versioning = yes; then
+        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+      else
+        $archive_expsym_cmds=&quot;$archive_cmds&quot;
+      fi
+    else
+      ld_shlibs=no
+    fi
+    ;;
+
   *)
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[[.]]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
@@ -1290,7 +1450,9 @@
   dynamic_linker='GNU ld.so'
   ;;
 
-freebsd*)
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
@@ -1309,7 +1471,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.[01]* | freebsdelf3.[01]*)
+  freebsd3.[[01]]* | freebsdelf3.[[01]]*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -1435,10 +1597,17 @@
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`$SED -e 's/[:,\t]/ /g;s/=[^=]*$//;s/=[^= ]* / /g' /etc/ld.so.conf | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf(&quot;cd /etc; cat %s&quot;, \[$]2)); skip = 1; } { if (!skip) print \[$]0; skip = 0; }' &lt; /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib $lt_ld_extra&quot;
   fi
 
+  case $host_cpu:$lt_cv_cc_64bit_output in
+  powerpc64:yes | s390x:yes | sparc64:yes | x86_64:yes)
+    sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /usr/X11R6/lib64&quot;
+    sys_lib_search_path_spec=&quot;/lib64 /usr/lib64 /usr/local/lib64 /usr/X11R6/lib64&quot;
+    ;;
+  esac
+
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -1446,18 +1615,26 @@
   # people can always --disable-shared, the test was removed, and we
   # assume the GNU/Linux dynamic linker is in use.
   dynamic_linker='GNU/Linux ld.so'
-  ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
+  # Find out which ABI we are using (multilib Linux x86_64 hack).
+  libsuff=
+  case &quot;$host_cpu&quot; in
+  x86_64*)
+    echo '[#]line __oline__ &quot;configure&quot;' &gt; conftest.$ac_ext
+    if AC_TRY_EVAL(ac_compile); then
+      case `/usr/bin/file conftest.$ac_objext` in
+      *64-bit*)
+        libsuff=64
+        ;;
+      esac
+    fi
+    rm -rf conftest*
+    ;;
+  *)
+    ;;
+  esac
+  sys_lib_dlsearch_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff}&quot;
+  sys_lib_search_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff} /usr/local/lib${libsuff}&quot;
   ;;
 
 knetbsd*-gnu)
@@ -1510,7 +1687,11 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  need_version=yes
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
+    *)                         need_version=no  ;;
+  esac
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -1676,7 +1857,9 @@
 
       case $tagname in
       CXX)
-	if test -n &quot;$CXX&quot; &amp;&amp; test &quot;X$CXX&quot; != &quot;Xno&quot;; then
+	if test -n &quot;$CXX&quot; &amp;&amp; ( test &quot;X$CXX&quot; != &quot;Xno&quot; &amp;&amp;
+	    ( (test &quot;X$CXX&quot; = &quot;Xg++&quot; &amp;&amp; `g++ -v &gt;/dev/null 2&gt;&amp;1` ) ||
+	    (test &quot;X$CXX&quot; != &quot;Xg++&quot;))) ; then
 	  AC_LIBTOOL_LANG_CXX_CONFIG
 	else
 	  tagname=&quot;&quot;
@@ -2081,6 +2264,15 @@
 *) reload_flag=&quot; $reload_flag&quot; ;;
 esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
+case $host_os in
+  darwin*)
+    if test &quot;$GCC&quot; = yes; then
+      reload_cmds='$CC -nostdlib ${wl}-r -o $output$reload_objs'
+    else
+      reload_cmds='$LD$reload_flag -o $output$reload_objs'
+    fi
+    ;;
+esac
 ])# AC_PROG_LD_RELOAD_FLAG
 
 
@@ -2114,7 +2306,7 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-bsdi4*)
+bsdi[[45]]*)
   lt_cv_deplibs_check_method='file_magic ELF [[0-9]][[0-9]]*-bit [[ML]]SB (shared object|dynamic lib)'
   lt_cv_file_magic_cmd='/usr/bin/file -L'
   lt_cv_file_magic_test_file=/shlib/libc.so
@@ -2137,13 +2329,13 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-freebsd* | kfreebsd*-gnu)
+freebsd* | kfreebsd*-gnu | dragonfly*)
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt; /dev/null; then
     case $host_cpu in
     i*86 )
       # Not sure whether the presence of OpenBSD here was a mistake.
       # Let's accept both of them until this is cleared up.
-      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD)/i[[3-9]]86 (compact )?demand paged shared library'
+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[[3-9]]86 (compact )?demand paged shared library'
       lt_cv_file_magic_cmd=/usr/bin/file
       lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
       ;;
@@ -2190,7 +2382,7 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt; /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   else
@@ -2209,12 +2401,10 @@
   ;;
 
 openbsd*)
-  lt_cv_file_magic_cmd=/usr/bin/file
-  lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
   if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
-    lt_cv_deplibs_check_method='file_magic ELF [[0-9]][[0-9]]*-bit [[LM]]SB shared object'
+    lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|\.so|_pic\.a)$'
   else
-    lt_cv_deplibs_check_method='file_magic OpenBSD.* shared library'
+    lt_cv_deplibs_check_method='match_pattern /lib[[^/]]+(\.so\.[[0-9]]+\.[[0-9]]+|_pic\.a)$'
   fi
   ;;
 
@@ -2404,10 +2594,21 @@
 # ---------------
 AC_DEFUN([_LT_AC_LANG_CXX],
 [AC_REQUIRE([AC_PROG_CXX])
-AC_REQUIRE([AC_PROG_CXXCPP])
+AC_REQUIRE([_LT_AC_PROG_CXXCPP])
 _LT_AC_SHELL_INIT([tagnames=${tagnames+${tagnames},}CXX])
 ])# _LT_AC_LANG_CXX
 
+# _LT_AC_PROG_CXXCPP
+# ---------------
+AC_DEFUN([_LT_AC_PROG_CXXCPP],
+[
+AC_REQUIRE([AC_PROG_CXX])
+if test -n &quot;$CXX&quot; &amp;&amp; ( test &quot;X$CXX&quot; != &quot;Xno&quot; &amp;&amp;
+    ( (test &quot;X$CXX&quot; = &quot;Xg++&quot; &amp;&amp; `g++ -v &gt;/dev/null 2&gt;&amp;1` ) ||
+    (test &quot;X$CXX&quot; != &quot;Xg++&quot;))) ; then
+  AC_PROG_CXXCPP
+fi
+])# _LT_AC_PROG_CXXCPP
 
 # AC_LIBTOOL_F77
 # --------------
@@ -2480,6 +2681,10 @@
 
 _LT_AC_SYS_COMPILER
 
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
 #
 # Check for any special shared library compilation flags.
 #
@@ -2543,43 +2748,6 @@
   if test &quot;$host_cpu&quot; != ia64 &amp;&amp; test &quot;$aix_use_runtimelinking&quot; = no ; then
     test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
   fi
-  ;;
-  darwin* | rhapsody*)
-  if test &quot;$GCC&quot; = yes; then
-    _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
-    case &quot;$host_os&quot; in
-    rhapsody* | darwin1.[[012]])
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
-      ;;
-    *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[[012]])
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-      ;;
-    esac
-    output_verbose_link_cmd='echo'
-    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring'
-    _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-    _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    _LT_AC_TAGVAR(hardcode_direct, $1)=no
-    _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
-    _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
-    _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
-  else
-    _LT_AC_TAGVAR(ld_shlibs, $1)=no
-  fi
     ;;
 esac
 AC_MSG_RESULT([$enable_shared])
@@ -2605,7 +2773,7 @@
 AC_DEFUN([_LT_AC_LANG_CXX_CONFIG],
 [AC_LANG_PUSH(C++)
 AC_REQUIRE([AC_PROG_CXX])
-AC_REQUIRE([AC_PROG_CXXCPP])
+AC_REQUIRE([_LT_AC_PROG_CXXCPP])
 
 _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
 _LT_AC_TAGVAR(allow_undefined_flag, $1)=
@@ -2649,6 +2817,10 @@
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
 
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=$CC
 lt_save_LD=$LD
@@ -2670,7 +2842,7 @@
 CC=${CXX-&quot;c++&quot;}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
-cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
+_LT_CC_BASENAME([$compiler])
 
 # We don't want -fno-exception wen compiling C++ code, so set the
 # no_builtin_flag separately
@@ -2777,7 +2949,7 @@
     _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
 
     if test &quot;$GXX&quot; = yes; then
-      case $host_os in aix4.[012]|aix4.[012].*)
+      case $host_os in aix4.[[012]]|aix4.[[012]].*)
       # We only want to do this on AIX 4.2 and lower, the check
       # below for broken collect2 doesn't work under 4.3+
 	collect2name=`${CC} -print-prog-name=collect2`
@@ -2798,6 +2970,9 @@
 	fi
       esac
       shared_flag='-shared'
+      if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+      fi
     else
       # not using gcc
       if test &quot;$host_cpu&quot; = ia64; then
@@ -2857,6 +3032,7 @@
     esac
     ;;
 
+
   cygwin* | mingw* | pw32*)
     # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1) is actually meaningless,
     # as there is no search path for DLLs.
@@ -2880,65 +3056,76 @@
       _LT_AC_TAGVAR(ld_shlibs, $1)=no
     fi
   ;;
+      darwin* | rhapsody*)
+        case &quot;$host_os&quot; in
+        rhapsody* | darwin1.[[012]])
+         _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[[012]])
+               _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
+        esac
+      _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
+      _LT_AC_TAGVAR(hardcode_direct, $1)=no
+      _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
+      _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
+      _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=''
+      _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
 
-  darwin* | rhapsody*)
-  if test &quot;$GXX&quot; = yes; then
-    _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
-    case &quot;$host_os&quot; in
-    rhapsody* | darwin1.[[012]])
-      _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
-      ;;
-    *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
+    if test &quot;$GXX&quot; = yes ; then
+      lt_int_apple_cc_single_mod=no
+      output_verbose_link_cmd='echo'
+      if $CC -dumpspecs 2&gt;&amp;1 | $EGREP 'single_module' &gt;/dev/null ; then
+       lt_int_apple_cc_single_mod=yes
+      fi
+      if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+       _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
       else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[[012]])
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined dynamic_lookup'
-            ;;
-        esac
+          _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        fi
+        _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+        # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+          if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+            _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          else
+            _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          fi
+            _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      else
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+          _LT_AC_TAGVAR(archive_cmds, $1)='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+          _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         _LT_AC_TAGVAR(ld_shlibs, $1)=no
+          ;;
+      esac
       fi
-      ;;
-    esac
-    lt_int_apple_cc_single_mod=no
-    output_verbose_link_cmd='echo'
-    if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-      lt_int_apple_cc_single_mod=yes
-    fi
-    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    else
-      _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    fi
-    _LT_AC_TAGVAR(module_cmds, $1)='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+        ;;
 
-    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    else
-      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    fi
-    _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    _LT_AC_TAGVAR(hardcode_direct, $1)=no
-    _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
-    _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
-    _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
-  else
-    _LT_AC_TAGVAR(ld_shlibs, $1)=no
-  fi
-    ;;
-
   dgux*)
     case $cc_basename in
-      ec++)
+      ec++*)
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
-      ghcx)
+      ghcx*)
 	# Green Hills C++ Compiler
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
@@ -2949,14 +3136,14 @@
 	;;
     esac
     ;;
-  freebsd[12]*)
+  freebsd[[12]]*)
     # C++ shared libraries reported to be fairly broken before switch to ELF
     _LT_AC_TAGVAR(ld_shlibs, $1)=no
     ;;
   freebsd-elf*)
     _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
     ;;
-  freebsd* | kfreebsd*-gnu)
+  freebsd* | kfreebsd*-gnu | dragonfly*)
     # FreeBSD 3 and later use GNU C++ and GNU ld with standard ELF
     # conventions
     _LT_AC_TAGVAR(ld_shlibs, $1)=yes
@@ -2973,11 +3160,11 @@
 				# location of the library.
 
     case $cc_basename in
-    CC)
+    CC*)
       # FIXME: insert proper C++ library support
       _LT_AC_TAGVAR(ld_shlibs, $1)=no
       ;;
-    aCC)
+    aCC*)
       _LT_AC_TAGVAR(archive_cmds, $1)='$rm $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       # Commands to make compiler produce verbose output that lists
       # what &quot;hidden&quot; libraries, object files and flags are used when
@@ -2987,7 +3174,7 @@
       # explicitly linking system object files so we need to strip them
       # from the output so that they don't get included in the library
       # dependencies.
-      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | grep &quot;[-]L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | grep &quot;[[-]]L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
       ;;
     *)
       if test &quot;$GXX&quot; = yes; then
@@ -3038,11 +3225,11 @@
     esac
 
     case $cc_basename in
-      CC)
+      CC*)
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
-      aCC)
+      aCC*)
 	case &quot;$host_cpu&quot; in
 	hppa*64*|ia64*)
 	  _LT_AC_TAGVAR(archive_cmds, $1)='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
@@ -3082,9 +3269,9 @@
     ;;
   irix5* | irix6*)
     case $cc_basename in
-      CC)
+      CC*)
 	# SGI C++
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	# Archives containing C++ object files must be created using
 	# &quot;CC -ar&quot;, where &quot;CC&quot; is the IRIX C++ compiler.  This is
@@ -3095,7 +3282,7 @@
       *)
 	if test &quot;$GXX&quot; = yes; then
 	  if test &quot;$with_gnu_ld&quot; = no; then
-	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	  else
 	    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` -o $lib'
 	  fi
@@ -3108,7 +3295,7 @@
     ;;
   linux*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -3133,17 +3320,41 @@
 	# &quot;CC -Bstatic&quot;, where &quot;CC&quot; is the KAI C++ compiler.
 	_LT_AC_TAGVAR(old_archive_cmds, $1)='$CC -Bstatic -o $oldlib $oldobjs'
 	;;
-      icpc)
+      icpc*)
 	# Intel C++
 	with_gnu_ld=yes
+	# version 8.0 and above of icpc choke on multiply defined symbols
+	# if we add $predep_objects and $postdep_objects, however 7.1 and
+	# earlier do not add the objects themselves.
+	case `$CC -V 2&gt;&amp;1` in
+	*&quot;Version 7.&quot;*)
+  	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+  	  _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	  ;;
+	*)  # Version 8.0 or newer
+	  tmp_idyn=
+	  case $host_cpu in
+	    ia64*) tmp_idyn=' -i_dynamic';;
+	  esac
+  	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared'&quot;$tmp_idyn&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	  _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared'&quot;$tmp_idyn&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	  ;;
+	esac
 	_LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
 	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
 	;;
-      cxx)
+      pgCC*)
+        # Portland Group C++ compiler
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+  	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+
+	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
+	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
+	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+        ;;
+      cxx*)
 	# Compaq C++
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname  -o $lib ${wl}-retain-symbols-file $wl$export_symbols'
@@ -3174,7 +3385,7 @@
     ;;
   mvs*)
     case $cc_basename in
-      cxx)
+      cxx*)
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
@@ -3184,7 +3395,7 @@
 	;;
     esac
     ;;
-  netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+  netbsd*)
     if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
       _LT_AC_TAGVAR(archive_cmds, $1)='$LD -Bshareable  -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags'
       wlarc=
@@ -3195,9 +3406,25 @@
     # Workaround some broken pre-1.5 toolchains
     output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep conftest.$objext | $SED -e &quot;s:-lgcc -lc -lgcc::&quot;'
     ;;
+  openbsd2*)
+    # C++ shared libraries are fairly broken
+    _LT_AC_TAGVAR(ld_shlibs, $1)=no
+    ;;
+  openbsd*)
+    _LT_AC_TAGVAR(hardcode_direct, $1)=yes
+    _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
+    _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+    _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
+    if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file,$export_symbols -o $lib'
+      _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
+      _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+    fi
+    output_verbose_link_cmd='echo'
+    ;;
   osf3*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -3213,14 +3440,14 @@
 	_LT_AC_TAGVAR(old_archive_cmds, $1)='$CC -Bstatic -o $oldlib $oldobjs'
 
 	;;
-      RCC)
+      RCC*)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
-      cxx)
+      cxx*)
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 	_LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -3238,7 +3465,7 @@
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
 	  _LT_AC_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 
 	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 	  _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -3257,7 +3484,7 @@
     ;;
   osf4* | osf5*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -3272,17 +3499,17 @@
 	# the KAI C++ compiler.
 	_LT_AC_TAGVAR(old_archive_cmds, $1)='$CC -o $oldlib $oldobjs'
 	;;
-      RCC)
+      RCC*)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
-      cxx)
+      cxx*)
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
-	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done~
 	  echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version	$verstring` -update_registry $objdir/so_locations -o $lib~
+	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version	$verstring` -update_registry ${output_objdir}/so_locations -o $lib~
 	  $rm $lib.exp'
 
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -3301,7 +3528,7 @@
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
 	  _LT_AC_TAGVAR(allow_undefined_flag, $1)=' ${wl}-expect_unresolved ${wl}\*'
-	 _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	 _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 
 	  _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath ${wl}$libdir'
 	  _LT_AC_TAGVAR(hardcode_libdir_separator, $1)=:
@@ -3325,7 +3552,7 @@
   sco*)
     _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
     case $cc_basename in
-      CC)
+      CC*)
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
@@ -3337,12 +3564,12 @@
     ;;
   sunos4*)
     case $cc_basename in
-      CC)
+      CC*)
 	# Sun C++ 4.x
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
 	;;
-      lcc)
+      lcc*)
 	# Lucid
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
@@ -3355,7 +3582,7 @@
     ;;
   solaris*)
     case $cc_basename in
-      CC)
+      CC*)
 	# Sun C++ 4.2, 5.x and Centerline C++
 	_LT_AC_TAGVAR(no_undefined_flag, $1)=' -zdefs'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
@@ -3365,13 +3592,17 @@
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
 	_LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
 	case $host_os in
-	  solaris2.[0-5] | solaris2.[0-5].*) ;;
+	  solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
 	  *)
 	    # The C++ compiler is used as linker so we must use $wl
 	    # flag to pass the commands to the underlying system
-	    # linker.
+	    # linker. We must also pass each convience library through
+	    # to the system linker between allextract/defaultextract.
+	    # The C++ compiler will combine linker options so we
+	    # cannot just pass the convience library names through
+	    # without $wl.
 	    # Supported since Solaris 2.6 (maybe 2.5.1?)
-	    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+	    _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract'
 	    ;;
 	esac
 	_LT_AC_TAGVAR(link_all_deplibs, $1)=yes
@@ -3392,7 +3623,7 @@
 	# in the archive.
 	_LT_AC_TAGVAR(old_archive_cmds, $1)='$CC -xar -o $oldlib $oldobjs'
 	;;
-      gcx)
+      gcx*)
 	# Green Hills C++ Compiler
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 
@@ -3435,7 +3666,7 @@
     ;;
   tandem*)
     case $cc_basename in
-      NCC)
+      NCC*)
 	# NonStop-UX NCC 3.20
 	# FIXME: insert proper C++ library support
 	_LT_AC_TAGVAR(ld_shlibs, $1)=no
@@ -3667,12 +3898,16 @@
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
 
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${F77-&quot;f77&quot;}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
-cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
+_LT_CC_BASENAME([$compiler])
 
 AC_MSG_CHECKING([if libtool supports shared libraries])
 AC_MSG_RESULT([$can_build_shared])
@@ -3691,7 +3926,9 @@
   fi
   ;;
 aix4* | aix5*)
-  test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  if test &quot;$host_cpu&quot; != ia64 &amp;&amp; test &quot;$aix_use_runtimelinking&quot; = no ; then
+    test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  fi
   ;;
 esac
 AC_MSG_RESULT([$enable_shared])
@@ -3742,20 +3979,27 @@
 lt_simple_compile_test_code=&quot;class foo {}\n&quot;
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='public class conftest { public static void main(String[] argv) {}; }\n'
+lt_simple_link_test_code='public class conftest { public static void main(String[[]] argv) {}; }\n'
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
 
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${GCJ-&quot;gcj&quot;}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
+_LT_CC_BASENAME([$compiler])
 
 # GCJ did not exist at the time GCC didn't implicitly link libc in.
 _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
 
+_LT_AC_TAGVAR(old_archive_cmds, $1)=$old_archive_cmds
+
 AC_LIBTOOL_PROG_COMPILER_NO_RTTI($1)
 AC_LIBTOOL_PROG_COMPILER_PIC($1)
 AC_LIBTOOL_PROG_CC_C_O($1)
@@ -3798,11 +4042,16 @@
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 _LT_AC_SYS_COMPILER
 
+# save warnings/boilerplate of simple test code
+_LT_COMPILER_BOILERPLATE
+_LT_LINKER_BOILERPLATE
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${RC-&quot;windres&quot;}
 compiler=$CC
 _LT_AC_TAGVAR(compiler, $1)=$CC
+_LT_CC_BASENAME([$compiler])
 _LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1)=yes
 
 AC_LIBTOOL_CONFIG($1)
@@ -3938,7 +4187,7 @@
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -3949,11 +4198,11 @@
 SED=$lt_SED
 
 # Sed that helps us avoid accidentally triggering echo(1) options like -n.
-Xsed=&quot;$SED -e s/^X//&quot;
+Xsed=&quot;$SED -e 1s/^X//&quot;
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-if test &quot;X\${CDPATH+set}&quot; = Xset; then CDPATH=:; export CDPATH; fi
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
 
 # The names of the tagged configurations supported by this script.
 available_tags=
@@ -3984,7 +4233,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -4060,7 +4315,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_[]_LT_AC_TAGVAR(lt_cv_prog_compiler_c_o, $1)
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -4334,9 +4589,6 @@
 # Regexp to match symbols that can be accessed directly from C.
 sympat='\([[_A-Za-z]][[_A-Za-z0-9]]*\)'
 
-# Transform the above into a raw symbol and a C symbol.
-symxfrm='\1 \2\3 \3'
-
 # Transform an extracted symbol line into a proper C declaration
 lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^. .* \(.*\)$/extern int \1;/p'&quot;
 
@@ -4358,6 +4610,13 @@
   lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'&quot;
   lt_cv_sys_global_symbol_to_c_name_address=&quot;sed -n -e 's/^: \([[^ ]]*\) $/  {\\\&quot;\1\\\&quot;, (lt_ptr) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\&quot;\2\&quot;, (lt_ptr) \&amp;\2},/p'&quot;
   ;;
+linux*)
+  if test &quot;$host_cpu&quot; = ia64; then
+    symcode='[[ABCDGIRSTW]]'
+    lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'&quot;
+    lt_cv_sys_global_symbol_to_c_name_address=&quot;sed -n -e 's/^: \([[^ ]]*\) $/  {\\\&quot;\1\\\&quot;, (lt_ptr) 0},/p' -e 's/^$symcode* \([[^ ]]*\) \([[^ ]]*\)$/  {\&quot;\2\&quot;, (lt_ptr) \&amp;\2},/p'&quot;
+  fi
+  ;;
 irix* | nonstopux*)
   symcode='[[BCDEGRST]]'
   ;;
@@ -4389,8 +4648,11 @@
 # Try without a prefix undercore, then with it.
 for ac_symprfx in &quot;&quot; &quot;_&quot;; do
 
+  # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
+  symxfrm=&quot;\\1 $ac_symprfx\\2 \\2&quot;
+
   # Write the raw and C identifiers.
-  lt_cv_sys_global_symbol_pipe=&quot;sed -n -e 's/^.*[[ 	]]\($symcode$symcode*\)[[ 	]][[ 	]]*\($ac_symprfx\)$sympat$opt_cr$/$symxfrm/p'&quot;
+  lt_cv_sys_global_symbol_pipe=&quot;sed -n -e 's/^.*[[ 	]]\($symcode$symcode*\)[[ 	]][[ 	]]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'&quot;
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -4579,18 +4841,28 @@
 	;;
       chorus*)
 	case $cc_basename in
-	cxch68)
+	cxch68*)
 	  # Green Hills C++ Compiler
 	  # _LT_AC_TAGVAR(lt_prog_compiler_static, $1)=&quot;--no_auto_instantiation -u __main -u __premain -u _abort -r $COOL_DIR/lib/libOrb.a $MVME_DIR/lib/CC/libC.a $MVME_DIR/lib/classix/libcx.s.a&quot;
 	  ;;
 	esac
 	;;
+       darwin*)
+         # PIC is the default on this platform
+         # Common symbols not allowed in MH_DYLIB files
+         case $cc_basename in
+           xlc*)
+           _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-qnocommon'
+           _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+           ;;
+         esac
+       ;;
       dgux*)
 	case $cc_basename in
-	  ec++)
+	  ec++*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    ;;
-	  ghcx)
+	  ghcx*)
 	    # Green Hills C++ Compiler
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-pic'
 	    ;;
@@ -4598,19 +4870,19 @@
 	    ;;
 	esac
 	;;
-      freebsd* | kfreebsd*-gnu)
+      freebsd* | kfreebsd*-gnu | dragonfly*)
 	# FreeBSD uses GNU C++
 	;;
       hpux9* | hpux10* | hpux11*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)=&quot;${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive&quot;
 	    if test &quot;$host_cpu&quot; != ia64; then
 	      _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='+Z'
 	    fi
 	    ;;
-	  aCC)
+	  aCC*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)=&quot;${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive&quot;
 	    case &quot;$host_cpu&quot; in
@@ -4628,7 +4900,7 @@
 	;;
       irix5* | irix6* | nonstopux*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-non_shared'
 	    # CC pic flag -KPIC is the default.
@@ -4639,18 +4911,24 @@
 	;;
       linux*)
 	case $cc_basename in
-	  KCC)
+	  KCC*)
 	    # KAI C++ Compiler
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='--backend -Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
 	    ;;
-	  icpc)
+	  icpc* | ecpc*)
 	    # Intel C++
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
 	    ;;
-	  cxx)
+	  pgCC*)
+	    # Portland Group C++ compiler.
+	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fpic'
+	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
+	    ;;
+	  cxx*)
 	    # Compaq C++
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
 	    # Linux and Compaq Tru64 Unix objects are PIC.
@@ -4667,25 +4945,25 @@
 	;;
       mvs*)
 	case $cc_basename in
-	  cxx)
+	  cxx*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-W c,exportall'
 	    ;;
 	  *)
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+      netbsd*)
 	;;
       osf3* | osf4* | osf5*)
 	case $cc_basename in
-	  KCC)
+	  KCC*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='--backend -Wl,'
 	    ;;
-	  RCC)
+	  RCC*)
 	    # Rational C++ 2.4.1
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-pic'
 	    ;;
-	  cxx)
+	  cxx*)
 	    # Digital/Compaq C++
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
@@ -4701,7 +4979,7 @@
 	;;
       sco*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fPIC'
 	    ;;
 	  *)
@@ -4710,13 +4988,13 @@
 	;;
       solaris*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	    _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld '
 	    ;;
-	  gcx)
+	  gcx*)
 	    # Green Hills C++ Compiler
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-PIC'
 	    ;;
@@ -4726,12 +5004,12 @@
 	;;
       sunos4*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    # Sun C++ 4.x
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-pic'
 	    _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
 	    ;;
-	  lcc)
+	  lcc*)
 	    # Lucid
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-pic'
 	    ;;
@@ -4741,7 +5019,7 @@
 	;;
       tandem*)
 	case $cc_basename in
-	  NCC)
+	  NCC*)
 	    # NonStop-UX NCC 3.20
 	    _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	    ;;
@@ -4838,6 +5116,16 @@
 	_LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
+      darwin*)
+        # PIC is the default on this platform
+        # Common symbols not allowed in MH_DYLIB files
+       case $cc_basename in
+         xlc*)
+         _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-qnocommon'
+         _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+         ;;
+       esac
+       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -4873,12 +5161,19 @@
       ;;
 
     linux*)
-      case $CC in
+      case $cc_basename in
       icc* | ecc*)
 	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
 	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
 	_LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
         ;;
+      pgcc* | pgf77* | pgf90*)
+        # Portland Group compilers (*not* the Pentium gcc compiler,
+	# which looks to be a dead project)
+	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+	_LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-fpic'
+	_LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-static'
+        ;;
       ccc*)
         _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
         # All Alpha code is PIC.
@@ -4899,9 +5194,14 @@
       ;;
 
     solaris*)
-      _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-KPIC'
       _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
+      case $cc_basename in
+      f77* | f90* | f95*)
+	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Qoption ld ';;
+      *)
+	_LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,';;
+      esac
       ;;
 
     sunos4*)
@@ -4923,6 +5223,11 @@
       fi
       ;;
 
+    unicos*)
+      _LT_AC_TAGVAR(lt_prog_compiler_wl, $1)='-Wl,'
+      _LT_AC_TAGVAR(lt_prog_compiler_can_build_shared, $1)=no
+      ;;
+
     uts4*)
       _LT_AC_TAGVAR(lt_prog_compiler_pic, $1)='-pic'
       _LT_AC_TAGVAR(lt_prog_compiler_static, $1)='-Bstatic'
@@ -4983,11 +5288,8 @@
     _LT_AC_TAGVAR(export_symbols_cmds, $1)=&quot;$ltdll_cmds&quot;
   ;;
   cygwin* | mingw*)
-    _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGS]] /s/.* \([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+    _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]] /s/.* \([[^ ]]*\)/\1 DATA/;/^.* __nm__/s/^.* __nm__\([[^ ]]*\) [[^ ]]*/\1 DATA/;/^I /d;/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
   ;;
-  linux*)
-    _LT_AC_TAGVAR(link_all_deplibs, $1)=no
-  ;;
   *)
     _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
   ;;
@@ -5029,7 +5331,8 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
-
+  # Just being paranoid about ensuring that cc_basename is set.
+  _LT_CC_BASENAME([$compiler])
   case $host_os in
   cygwin* | mingw* | pw32*)
     # FIXME: the MSVC++ port hasn't been tested in a loooong time
@@ -5048,7 +5351,28 @@
   if test &quot;$with_gnu_ld&quot; = yes; then
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
-
+    
+    # Set some defaults for GNU ld with shared library support. These
+    # are reset later if shared libraries are not supported. Putting them
+    # here allows them to be overridden if necessary.
+    runpath_var=LD_RUN_PATH
+    _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
+    _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
+    # ancient GNU ld didn't support --whole-archive et. al.
+    if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
+	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+      else
+  	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
+    fi
+    supports_anon_versioning=no
+    case `$LD -v 2&gt;/dev/null` in
+      *\ [[01]].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+      *\ 2.11.*) ;; # other 2.11 versions
+      *) supports_anon_versioning=yes ;;
+    esac
+    
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -5099,7 +5423,7 @@
       _LT_AC_TAGVAR(allow_undefined_flag, $1)=unsupported
       _LT_AC_TAGVAR(always_export_symbols, $1)=no
       _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
-      _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGS]] /s/.* \([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+      _LT_AC_TAGVAR(export_symbols_cmds, $1)='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[[BCDGRS]] /s/.* \([[^ ]]*\)/\1 DATA/'\'' | $SED -e '\''/^[[AITW]] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
 
       if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
         _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -5113,11 +5437,42 @@
 	fi~
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
-	ld_shlibs=no
+	_LT_AC_TAGVAR(ld_shlibs, $1)=no
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    linux*)
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
+	tmp_addflag=
+	case $cc_basename,$host_cpu in
+	pgcc*)				# Portland Group C compiler
+	  _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag'
+	  ;;
+	pgf77* | pgf90* )			# Portland Group f77 and f90 compilers
+	  _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag -Mnomain' ;;
+	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
+	  tmp_addflag=' -i_dynamic' ;;
+	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
+	  tmp_addflag=' -i_dynamic -nofor_main' ;;
+	ifc* | ifort*)			# Intel Fortran compiler
+	  tmp_addflag=' -nofor_main' ;;
+	esac
+	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+
+	if test $supports_anon_versioning = yes; then
+	  _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+  cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+  $echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+	  $CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+	fi
+      else
+	_LT_AC_TAGVAR(ld_shlibs, $1)=no
+      fi
+      ;;
+
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -5155,32 +5510,6 @@
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
       ;;
 
-  linux*)
-    if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
-        tmp_archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	_LT_AC_TAGVAR(archive_cmds, $1)=&quot;$tmp_archive_cmds&quot;
-      supports_anon_versioning=no
-      case `$LD -v 2&gt;/dev/null` in
-        *\ [01].* | *\ 2.[[0-9]].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
-        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-        *\ 2.11.*) ;; # other 2.11 versions
-        *) supports_anon_versioning=yes ;;
-      esac
-      if test $supports_anon_versioning = yes; then
-        _LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
-cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
-$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
-        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-      else
-        _LT_AC_TAGVAR(archive_expsym_cmds, $1)=&quot;$tmp_archive_cmds&quot;
-      fi
-      _LT_AC_TAGVAR(link_all_deplibs, $1)=no
-    else
-      _LT_AC_TAGVAR(ld_shlibs, $1)=no
-    fi
-    ;;
-
     *)
       if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
@@ -5191,16 +5520,11 @@
       ;;
     esac
 
-    if test &quot;$_LT_AC_TAGVAR(ld_shlibs, $1)&quot; = yes; then
-      runpath_var=LD_RUN_PATH
-      _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}--rpath ${wl}$libdir'
-      _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}--export-dynamic'
-      # ancient GNU ld didn't support --whole-archive et. al.
-      if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
- 	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
-      else
-  	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
-      fi
+    if test &quot;$_LT_AC_TAGVAR(ld_shlibs, $1)&quot; = no; then
+      runpath_var=
+      _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)=
+      _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)=
+      _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -5264,7 +5588,7 @@
       _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
 
       if test &quot;$GCC&quot; = yes; then
-	case $host_os in aix4.[012]|aix4.[012].*)
+	case $host_os in aix4.[[012]]|aix4.[[012]].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -5285,6 +5609,9 @@
 	  fi
 	esac
 	shared_flag='-shared'
+	if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	  shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+	fi
       else
 	# not using gcc
 	if test &quot;$host_cpu&quot; = ia64; then
@@ -5343,7 +5670,7 @@
       _LT_AC_TAGVAR(ld_shlibs, $1)=no
       ;;
 
-    bsdi4*)
+    bsdi[[45]]*)
       _LT_AC_TAGVAR(export_dynamic_flag_spec, $1)=-rdynamic
       ;;
 
@@ -5364,57 +5691,57 @@
       _LT_AC_TAGVAR(old_archive_From_new_cmds, $1)='true'
       # FIXME: Should let the user specify the lib program.
       _LT_AC_TAGVAR(old_archive_cmds, $1)='lib /OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path='`cygpath -w &quot;$srcfile&quot;`'
+      _LT_AC_TAGVAR(fix_srcfile_path, $1)='`cygpath -w &quot;$srcfile&quot;`'
       _LT_AC_TAGVAR(enable_shared_with_static_runtimes, $1)=yes
       ;;
 
     darwin* | rhapsody*)
-    if test &quot;$GXX&quot; = yes ; then
-      _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
       case &quot;$host_os&quot; in
-      rhapsody* | darwin1.[[012]])
-	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined suppress'
-	;;
-      *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	_LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[[012]])
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            _LT_AC_TAGVAR(allow_undefined_flag, $1)='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-	;;
+        rhapsody* | darwin1.[[012]])
+         _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[[012]])
+               _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               _LT_AC_TAGVAR(allow_undefined_flag, $1)='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
       esac
-    	lt_int_apple_cc_single_mod=no
-    	output_verbose_link_cmd='echo'
-    	if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-    	  lt_int_apple_cc_single_mod=yes
-    	fi
-    	if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-    	  _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    	else
-        _LT_AC_TAGVAR(archive_cmds, $1)='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      fi
-      _LT_AC_TAGVAR(module_cmds, $1)='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-        if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-          _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        else
-          _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        fi
-          _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      _LT_AC_TAGVAR(archive_cmds_need_lc, $1)=no
       _LT_AC_TAGVAR(hardcode_direct, $1)=no
       _LT_AC_TAGVAR(hardcode_automatic, $1)=yes
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=unsupported
-      _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-all_load $convenience'
+      _LT_AC_TAGVAR(whole_archive_flag_spec, $1)=''
       _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
+    if test &quot;$GCC&quot; = yes ; then
+    	output_verbose_link_cmd='echo'
+        _LT_AC_TAGVAR(archive_cmds, $1)='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+      _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+      _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
-      _LT_AC_TAGVAR(ld_shlibs, $1)=no
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+         _LT_AC_TAGVAR(archive_cmds, $1)='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         _LT_AC_TAGVAR(module_cmds, $1)='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+         _LT_AC_TAGVAR(archive_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          _LT_AC_TAGVAR(module_expsym_cmds, $1)='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         _LT_AC_TAGVAR(ld_shlibs, $1)=no
+          ;;
+      esac
     fi
       ;;
 
@@ -5448,7 +5775,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu)
+    freebsd* | kfreebsd*-gnu | dragonfly*)
       _LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       _LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-R$libdir'
       _LT_AC_TAGVAR(hardcode_direct, $1)=yes
@@ -5535,7 +5862,7 @@
       _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -5559,6 +5886,7 @@
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
       if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='${wl}-rpath,$libdir'
 	_LT_AC_TAGVAR(export_dynamic_flag_spec, $1)='${wl}-E'
       else
@@ -5604,7 +5932,7 @@
 	_LT_AC_TAGVAR(allow_undefined_flag, $1)=' -expect_unresolved \*'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	_LT_AC_TAGVAR(hardcode_libdir_flag_spec, $1)='-rpath $libdir'
@@ -5623,10 +5951,12 @@
     solaris*)
       _LT_AC_TAGVAR(no_undefined_flag, $1)=' -z text'
       if test &quot;$GCC&quot; = yes; then
+	wlarc='${wl}'
 	_LT_AC_TAGVAR(archive_cmds, $1)='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
       else
+	wlarc=''
 	_LT_AC_TAGVAR(archive_cmds, $1)='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	_LT_AC_TAGVAR(archive_expsym_cmds, $1)='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
@@ -5635,8 +5965,18 @@
       _LT_AC_TAGVAR(hardcode_shlibpath_var, $1)=no
       case $host_os in
       solaris2.[[0-5]] | solaris2.[[0-5]].*) ;;
-      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
-	_LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-z allextract$convenience -z defaultextract' ;;
+      *)
+ 	# The compiler driver will combine linker options so we
+ 	# cannot just pass the convience library names through
+ 	# without $wl, iff we do not link with $LD.
+ 	# Luckily, gcc supports the same syntax we need for Sun Studio.
+ 	# Supported since Solaris 2.6 (maybe 2.5.1?)
+ 	case $wlarc in
+ 	'')
+ 	  _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='-z allextract$convenience -z defaultextract' ;;
+ 	*)
+ 	  _LT_AC_TAGVAR(whole_archive_flag_spec, $1)='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract' ;;
+ 	esac ;;
       esac
       _LT_AC_TAGVAR(link_all_deplibs, $1)=yes
       ;;
@@ -5897,7 +6237,7 @@
 # Add /usr/xpg4/bin/sed as it is typically found on Solaris
 # along with /bin/sed that truncates output.
 for lt_ac_sed in $lt_ac_sed_list /usr/xpg4/bin/sed; do
-  test ! -f $lt_ac_sed &amp;&amp; break
+  test ! -f $lt_ac_sed &amp;&amp; continue
   cat /dev/null &gt; conftest.in
   lt_ac_count=0
   echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;conftest.in
@@ -5922,8 +6262,8 @@
     fi
   done
 done
+])
 SED=$lt_cv_path_SED
-])
 AC_MSG_RESULT([$SED])
 ])
 

Modified: branches/mloskot-style-refactoring/config.guess
===================================================================
--- branches/mloskot-style-refactoring/config.guess	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/config.guess	2005-11-11 18:07:47 UTC (rev 227)
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2005-04-22'
+timestamp='2004-03-12'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -53,7 +53,7 @@
 GNU config.guess ($timestamp)
 
 Originally written by Per Bothner.
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
@@ -203,15 +203,15 @@
     amiga:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    arc:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     cats:OpenBSD:*:*)
 	echo arm-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
     hp300:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
-    luna88k:OpenBSD:*:*)
-    	echo m88k-unknown-openbsd${UNAME_RELEASE}
-	exit 0 ;;
     mac68k:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
@@ -227,12 +227,21 @@
     mvmeppc:OpenBSD:*:*)
 	echo powerpc-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    pegasos:OpenBSD:*:*)
+	echo powerpc-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
+    pmax:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     sgi:OpenBSD:*:*)
-	echo mips64-unknown-openbsd${UNAME_RELEASE}
+	echo mipseb-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
     sun3:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    wgrisc:OpenBSD:*:*)
+	echo mipsel-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     *:OpenBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
@@ -298,6 +307,9 @@
 	# 1.2 uses &quot;1.2&quot; for uname -r.
 	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
 	exit 0 ;;
+    Alpha*:OpenVMS:*:*)
+	echo alpha-hp-vms
+	exit 0 ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# Should we change UNAME_MACHINE based on the output of uname instead
@@ -319,9 +331,6 @@
     *:OS/390:*:*)
 	echo i370-ibm-openedition
 	exit 0 ;;
-    *:z/VM:*:*)
-	echo s390-ibm-zvmoe
-	exit 0 ;;
     *:OS400:*:*)
         echo powerpc-ibm-os400
 	exit 0 ;;
@@ -345,7 +354,7 @@
     DRS?6000:unix:4.0:6*)
 	echo sparc-icl-nx6
 	exit 0 ;;
-    DRS?6000:UNIX_SV:4.2*:7* | DRS?6000:isis:4.2*:7*)
+    DRS?6000:UNIX_SV:4.2*:7*)
 	case `/usr/bin/uname -p` in
 	    sparc) echo sparc-icl-nx7 &amp;&amp; exit 0 ;;
 	esac ;;
@@ -755,7 +764,7 @@
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
     *:UNICOS/mp:*:*)
-	echo craynv-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	echo nv1-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
@@ -778,7 +787,21 @@
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit 0 ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	# Determine whether the default compiler uses glibc.
+	eval $set_cc_for_build
+	sed 's/^	//' &lt;&lt; EOF &gt;$dummy.c
+	#include &lt;features.h&gt;
+	#if __GLIBC__ &gt;= 2
+	LIBC=gnu
+	#else
+	LIBC=
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2&gt;/dev/null | grep ^LIBC=`
+	# GNU/KFreeBSD systems have a &quot;k&quot; prefix to indicate we are using
+	# FreeBSD's kernel, but not the complete OS.
+	case ${LIBC} in gnu) kernel_only='k' ;; esac
+	echo ${UNAME_MACHINE}-unknown-${kernel_only}freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
 	exit 0 ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
@@ -804,9 +827,6 @@
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
 	exit 0 ;;
-    amd64:CYGWIN*:*:*)
-	echo x86_64-unknown-cygwin
-	exit 0 ;;
     p*:CYGWIN*:*)
 	echo powerpcle-unknown-cygwin
 	exit 0 ;;
@@ -830,12 +850,6 @@
     cris:Linux:*:*)
 	echo cris-axis-linux-gnu
 	exit 0 ;;
-    crisv32:Linux:*:*)
-	echo crisv32-axis-linux-gnu
-	exit 0 ;;
-    frv:Linux:*:*)
-    	echo frv-unknown-linux-gnu
-	exit 0 ;;
     ia64:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
@@ -1082,9 +1096,9 @@
     M680?0:D-NIX:5.3:*)
 	echo m68k-diab-dnix
 	exit 0 ;;
-    M68*:*:R3V[5678]*:*)
+    M68*:*:R3V[567]*:*)
 	test -r /sysV68 &amp;&amp; echo 'm68k-motorola-sysv' &amp;&amp; exit 0 ;;
-    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0 | S7501*:*:4.0:3.0)
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&amp;&amp; OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' &lt; /etc/.relid`
@@ -1140,10 +1154,6 @@
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/openspace-svn">seanf at swdc.stratus.com.</A>
 	echo i860-stratus-sysv4
 	exit 0 ;;
-    i*86:VOS:*:*)
-	# From <A HREF="https://lists.berlios.de/mailman/listinfo/openspace-svn">Paul.Green at stratus.com.</A>
-	echo ${UNAME_MACHINE}-stratus-vos
-	exit 0 ;;
     *:VOS:*:*)
 	# From <A HREF="https://lists.berlios.de/mailman/listinfo/openspace-svn">Paul.Green at stratus.com.</A>
 	echo hppa1.1-stratus-vos
@@ -1186,10 +1196,9 @@
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
 	exit 0 ;;
     *:Darwin:*:*)
-	UNAME_PROCESSOR=`uname -p` || UNAME_PROCESSOR=unknown
-	case $UNAME_PROCESSOR in
+	case `uname -p` in
 	    *86) UNAME_PROCESSOR=i686 ;;
-	    unknown) UNAME_PROCESSOR=powerpc ;;
+	    powerpc) UNAME_PROCESSOR=powerpc ;;
 	esac
 	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
 	exit 0 ;;
@@ -1204,9 +1213,6 @@
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit 0 ;;
-    NSE-?:NONSTOP_KERNEL:*:*)
-	echo nse-tandem-nsk${UNAME_RELEASE}
-	exit 0 ;;
     NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
 	exit 0 ;;
@@ -1254,16 +1260,6 @@
     *:DragonFly:*:*)
 	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
 	exit 0 ;;
-    *:*VMS:*:*)
-    	UNAME_MACHINE=`(uname -p) 2&gt;/dev/null`
-	case &quot;${UNAME_MACHINE}&quot; in
-	    A*) echo alpha-dec-vms &amp;&amp; exit 0 ;;
-	    I*) echo ia64-dec-vms &amp;&amp; exit 0 ;;
-	    V*) echo vax-dec-vms &amp;&amp; exit 0 ;;
-	esac ;;
-    *:XENIX:*:SysV)
-	echo i386-pc-xenix
-	exit 0 ;;
 esac
 
 #echo '(No uname command or uname output not recognized.)' 1&gt;&amp;2
@@ -1423,9 +1419,7 @@
 the operating system you are using. It is advised that you
 download the most up to date version of the config scripts from
 
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.guess</A>
-and
-  <A HREF="http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub">http://savannah.gnu.org/cgi-bin/viewcvs/*checkout*/config/config/config.sub</A>
+    <A HREF="ftp://ftp.gnu.org/pub/gnu/config/">ftp://ftp.gnu.org/pub/gnu/config/</A>
 
 If the version you run ($0) is already up to date, please
 send the following data and any information you think might be

Modified: branches/mloskot-style-refactoring/config.sub
===================================================================
--- branches/mloskot-style-refactoring/config.sub	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/config.sub	2005-11-11 18:07:47 UTC (rev 227)
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002, 2003, 2004, 2005 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2005-04-22'
+timestamp='2004-03-12'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -70,7 +70,7 @@
 version=&quot;\
 GNU config.sub ($timestamp)
 
-Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004, 2005
+Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001
 Free Software Foundation, Inc.
 
 This is free software; see the source for copying conditions.  There is NO
@@ -145,7 +145,7 @@
 	-convergent* | -ncr* | -news | -32* | -3600* | -3100* | -hitachi* |\
 	-c[123]* | -convex* | -sun | -crds | -omron* | -dg | -ultra | -tti* | \
 	-harris | -dolphin | -highlevel | -gould | -cbm | -ns | -masscomp | \
-	-apple | -axis | -knuth | -cray)
+	-apple | -axis)
 		os=
 		basic_machine=$1
 		;;
@@ -231,14 +231,13 @@
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
 	| am33_2.0 \
 	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
-	| bfin \
 	| c4x | clipper \
 	| d10v | d30v | dlx | dsp16xx \
 	| fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
 	| ip2k | iq2000 \
-	| m32r | m32rle | m68000 | m68k | m88k | maxq | mcore \
+	| m32r | m32rle | m68000 | m68k | m88k | mcore \
 	| mips | mipsbe | mipseb | mipsel | mipsle \
 	| mips16 \
 	| mips64 | mips64el \
@@ -263,13 +262,12 @@
 	| pyramid \
 	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
 	| sh64 | sh64le \
-	| sparc | sparc64 | sparc64b | sparc86x | sparclet | sparclite \
-	| sparcv8 | sparcv9 | sparcv9b \
+	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv8 | sparcv9 | sparcv9b \
 	| strongarm \
 	| tahoe | thumb | tic4x | tic80 | tron \
 	| v850 | v850e \
 	| we32k \
-	| x86 | xscale | xscalee[bl] | xstormy16 | xtensa \
+	| x86 | xscale | xstormy16 | xtensa \
 	| z8k)
 		basic_machine=$basic_machine-unknown
 		;;
@@ -300,9 +298,9 @@
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
 	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* \
-	| bfin-* | bs2000-* \
+	| bs2000-* \
 	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
-	| clipper-* | craynv-* | cydra-* \
+	| clipper-* | cydra-* \
 	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
 	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
@@ -312,7 +310,7 @@
 	| ip2k-* | iq2000-* \
 	| m32r-* | m32rle-* \
 	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
-	| m88110-* | m88k-* | maxq-* | mcore-* \
+	| m88110-* | m88k-* | mcore-* \
 	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
 	| mips16-* \
 	| mips64-* | mips64el-* \
@@ -328,9 +326,8 @@
 	| mipsisa64sb1-* | mipsisa64sb1el-* \
 	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
 	| mipstx39-* | mipstx39el-* \
-	| mmix-* \
 	| msp430-* \
-	| none-* | np1-* | ns16k-* | ns32k-* \
+	| none-* | np1-* | nv1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
@@ -338,16 +335,15 @@
 	| romp-* | rs6000-* \
 	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
 	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
-	| sparc-* | sparc64-* | sparc64b-* | sparc86x-* | sparclet-* \
-	| sparclite-* \
+	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
 	| sparcv8-* | sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
 	| tahoe-* | thumb-* \
 	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
 	| tron-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xps100-* | xscale-* | xscalee[bl]-* \
-	| xstormy16-* | xtensa-* \
+	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
+	| xtensa-* \
 	| ymp-* \
 	| z8k-*)
 		;;
@@ -449,10 +445,6 @@
 		basic_machine=j90-cray
 		os=-unicos
 		;;
-	craynv)
-		basic_machine=craynv-cray
-		os=-unicosmp
-		;;
 	cr16c)
 		basic_machine=cr16c-unknown
 		os=-elf
@@ -460,9 +452,6 @@
 	crds | unos)
 		basic_machine=m68k-crds
 		;;
-	crisv32 | crisv32-* | etraxfs*)
-		basic_machine=crisv32-axis
-		;;
 	cris | cris-* | etrax*)
 		basic_machine=cris-axis
 		;;
@@ -492,10 +481,6 @@
 		basic_machine=m88k-motorola
 		os=-sysv3
 		;;
-	djgpp)
-		basic_machine=i586-pc
-		os=-msdosdjgpp
-		;;
 	dpx20 | dpx20-*)
 		basic_machine=rs6000-bull
 		os=-bosx
@@ -674,6 +659,10 @@
 	mips3*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`-unknown
 		;;
+	mmix*)
+		basic_machine=mmix-knuth
+		os=-mmixware
+		;;
 	monitor)
 		basic_machine=m68k-rom68k
 		os=-coff
@@ -754,6 +743,10 @@
 	np1)
 		basic_machine=np1-gould
 		;;
+	nv1)
+		basic_machine=nv1-cray
+		os=-unicosmp
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -1036,10 +1029,6 @@
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
-	xbox)
-		basic_machine=i686-pc
-		os=-mingw32
-		;;
 	xps | xps100)
 		basic_machine=xps100-honeywell
 		;;
@@ -1070,9 +1059,6 @@
 	romp)
 		basic_machine=romp-ibm
 		;;
-	mmix)
-		basic_machine=mmix-knuth
-		;;
 	rs6000)
 		basic_machine=rs6000-ibm
 		;;
@@ -1308,9 +1294,6 @@
 	-kaos*)
 		os=-kaos
 		;;
-	-zvmoe)
-		os=-zvmoe
-		;;
 	-none)
 		;;
 	*)
@@ -1391,9 +1374,6 @@
 	*-ibm)
 		os=-aix
 		;;
-    	*-knuth)
-		os=-mmixware
-		;;
 	*-wec)
 		os=-proelf
 		;;

Modified: branches/mloskot-style-refactoring/configure
===================================================================
--- branches/mloskot-style-refactoring/configure	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/configure	2005-11-11 18:07:47 UTC (rev 227)
@@ -280,7 +280,7 @@
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-if test &quot;X${CDPATH+set}&quot; = Xset; then CDPATH=:; export CDPATH; fi
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
 
 if test -z &quot;$ECHO&quot;; then
 if test &quot;X${echo_test_string+set}&quot; != Xset; then
@@ -3893,7 +3893,7 @@
 # Add /usr/xpg4/bin/sed as it is typically found on Solaris
 # along with /bin/sed that truncates output.
 for lt_ac_sed in $lt_ac_sed_list /usr/xpg4/bin/sed; do
-  test ! -f $lt_ac_sed &amp;&amp; break
+  test ! -f $lt_ac_sed &amp;&amp; continue
   cat /dev/null &gt; conftest.in
   lt_ac_count=0
   echo $ECHO_N &quot;0123456789$ECHO_C&quot; &gt;conftest.in
@@ -3918,10 +3918,10 @@
     fi
   done
 done
-SED=$lt_cv_path_SED
 
 fi
 
+SED=$lt_cv_path_SED
 echo &quot;$as_me:$LINENO: result: $SED&quot; &gt;&amp;5
 echo &quot;${ECHO_T}$SED&quot; &gt;&amp;6
 
@@ -4062,6 +4062,15 @@
 *) reload_flag=&quot; $reload_flag&quot; ;;
 esac
 reload_cmds='$LD$reload_flag -o $output$reload_objs'
+case $host_os in
+  darwin*)
+    if test &quot;$GCC&quot; = yes; then
+      reload_cmds='$CC -nostdlib ${wl}-r -o $output$reload_objs'
+    else
+      reload_cmds='$LD$reload_flag -o $output$reload_objs'
+    fi
+    ;;
+esac
 
 echo &quot;$as_me:$LINENO: checking for BSD-compatible nm&quot; &gt;&amp;5
 echo $ECHO_N &quot;checking for BSD-compatible nm... $ECHO_C&quot; &gt;&amp;6
@@ -4148,7 +4157,7 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-bsdi4*)
+bsdi[45]*)
   lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [ML]SB (shared object|dynamic lib)'
   lt_cv_file_magic_cmd='/usr/bin/file -L'
   lt_cv_file_magic_test_file=/shlib/libc.so
@@ -4171,13 +4180,13 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-freebsd* | kfreebsd*-gnu)
+freebsd* | kfreebsd*-gnu | dragonfly*)
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt; /dev/null; then
     case $host_cpu in
     i*86 )
       # Not sure whether the presence of OpenBSD here was a mistake.
       # Let's accept both of them until this is cleared up.
-      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD)/i[3-9]86 (compact )?demand paged shared library'
+      lt_cv_deplibs_check_method='file_magic (FreeBSD|OpenBSD|DragonFly)/i[3-9]86 (compact )?demand paged shared library'
       lt_cv_file_magic_cmd=/usr/bin/file
       lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
       ;;
@@ -4224,7 +4233,7 @@
   lt_cv_deplibs_check_method=pass_all
   ;;
 
-netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+netbsd*)
   if echo __ELF__ | $CC -E - | grep __ELF__ &gt; /dev/null; then
     lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
   else
@@ -4243,12 +4252,10 @@
   ;;
 
 openbsd*)
-  lt_cv_file_magic_cmd=/usr/bin/file
-  lt_cv_file_magic_test_file=`echo /usr/lib/libc.so.*`
   if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
-    lt_cv_deplibs_check_method='file_magic ELF [0-9][0-9]*-bit [LM]SB shared object'
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|\.so|_pic\.a)$'
   else
-    lt_cv_deplibs_check_method='file_magic OpenBSD.* shared library'
+    lt_cv_deplibs_check_method='match_pattern /lib[^/]+(\.so\.[0-9]+\.[0-9]+|_pic\.a)$'
   fi
   ;;
 
@@ -4341,7 +4348,7 @@
   ;;
 *-*-irix6*)
   # Find out which ABI we are using.
-  echo '#line 4344 &quot;configure&quot;' &gt; conftest.$ac_ext
+  echo '#line 4351 &quot;configure&quot;' &gt; conftest.$ac_ext
   if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
   (eval $ac_compile) 2&gt;&amp;5
   ac_status=$?
@@ -4422,6 +4429,24 @@
   rm -rf conftest*
   ;;
 
+*-*-linux*)
+  # Test if the compiler is 64bit
+  echo 'int i;' &gt; conftest.$ac_ext
+  lt_cv_cc_64bit_output=no
+  if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; then
+    case `/usr/bin/file conftest.$ac_objext` in
+    *&quot;ELF 64&quot;*)
+      lt_cv_cc_64bit_output=yes
+      ;;
+    esac
+  fi
+  rm -rf conftest*
+  ;;
+
 *-*-sco3.2v5*)
   # On SCO OpenServer 5, we need -belf to get full-featured binaries.
   SAVE_CFLAGS=&quot;$CFLAGS&quot;
@@ -4892,7 +4917,12 @@
 
 done
 
-ac_ext=cc
+
+
+if test -n &quot;$CXX&quot; &amp;&amp; ( test &quot;X$CXX&quot; != &quot;Xno&quot; &amp;&amp;
+    ( (test &quot;X$CXX&quot; = &quot;Xg++&quot; &amp;&amp; `g++ -v &gt;/dev/null 2&gt;&amp;1` ) ||
+    (test &quot;X$CXX&quot; != &quot;Xg++&quot;))) ; then
+  ac_ext=cc
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
@@ -5122,7 +5152,9 @@
 ac_link='$CXX -o conftest$ac_exeext $CXXFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
 ac_compiler_gnu=$ac_cv_cxx_compiler_gnu
 
+fi
 
+
 ac_ext=f
 ac_compile='$F77 -c $FFLAGS conftest.$ac_ext &gt;&amp;5'
 ac_link='$F77 -o conftest$ac_exeext $FFLAGS $LDFLAGS conftest.$ac_ext $LIBS &gt;&amp;5'
@@ -5215,7 +5247,7 @@
 
 
 # Provide some information about the compiler.
-echo &quot;$as_me:5218:&quot; \
+echo &quot;$as_me:5250:&quot; \
      &quot;checking for Fortran 77 compiler version&quot; &gt;&amp;5
 ac_compiler=`set X $ac_compile; echo $2`
 { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compiler --version &lt;/dev/null &gt;&amp;5\&quot;&quot;) &gt;&amp;5
@@ -5405,11 +5437,38 @@
     lt_cv_sys_max_cmd_len=8192;
     ;;
 
- *)
+  netbsd* | freebsd* | openbsd* | darwin* | dragonfly*)
+    # This has been around since 386BSD, at least.  Likely further.
+    if test -x /sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/sbin/sysctl -n kern.argmax`
+    elif test -x /usr/sbin/sysctl; then
+      lt_cv_sys_max_cmd_len=`/usr/sbin/sysctl -n kern.argmax`
+    else
+      lt_cv_sys_max_cmd_len=65536 # usable default for *BSD
+    fi
+    # And add a safety zone
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \/ 4`
+    lt_cv_sys_max_cmd_len=`expr $lt_cv_sys_max_cmd_len \* 3`
+    ;;
+  osf*)
+    # Dr. Hans Ekkehard Plesser reports seeing a kernel panic running configure
+    # due to this test when exec_disable_arg_limit is 1 on Tru64. It is not
+    # nice to cause kernel panics so lets avoid the loop below.
+    # First set a reasonable default.
+    lt_cv_sys_max_cmd_len=16384
+    #
+    if test -x /sbin/sysconfig; then
+      case `/sbin/sysconfig -q proc exec_disable_arg_limit` in
+        *1*) lt_cv_sys_max_cmd_len=-1 ;;
+      esac
+    fi
+    ;;
+  *)
     # If test is not a shell built-in, we'll probably end up computing a
     # maximum length that is only half of the actual maximum length, but
     # we can't tell.
-    while (test &quot;X&quot;`$CONFIG_SHELL $0 --fallback-echo &quot;X$teststring&quot; 2&gt;/dev/null` \
+    SHELL=${SHELL-${CONFIG_SHELL-/bin/sh}}
+    while (test &quot;X&quot;`$SHELL $0 --fallback-echo &quot;X$teststring&quot; 2&gt;/dev/null` \
 	       = &quot;XX$teststring&quot;) &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
 	    new_result=`expr &quot;X$teststring&quot; : &quot;.*&quot; 2&gt;&amp;1` &amp;&amp;
 	    lt_cv_sys_max_cmd_len=$new_result &amp;&amp;
@@ -5455,9 +5514,6 @@
 # Regexp to match symbols that can be accessed directly from C.
 sympat='\([_A-Za-z][_A-Za-z0-9]*\)'
 
-# Transform the above into a raw symbol and a C symbol.
-symxfrm='\1 \2\3 \3'
-
 # Transform an extracted symbol line into a proper C declaration
 lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^. .* \(.*\)$/extern int \1;/p'&quot;
 
@@ -5479,6 +5535,13 @@
   lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'&quot;
   lt_cv_sys_global_symbol_to_c_name_address=&quot;sed -n -e 's/^: \([^ ]*\) $/  {\\\&quot;\1\\\&quot;, (lt_ptr) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\&quot;\2\&quot;, (lt_ptr) \&amp;\2},/p'&quot;
   ;;
+linux*)
+  if test &quot;$host_cpu&quot; = ia64; then
+    symcode='[ABCDGIRSTW]'
+    lt_cv_sys_global_symbol_to_cdecl=&quot;sed -n -e 's/^T .* \(.*\)$/extern int \1();/p' -e 's/^$symcode* .* \(.*\)$/extern char \1;/p'&quot;
+    lt_cv_sys_global_symbol_to_c_name_address=&quot;sed -n -e 's/^: \([^ ]*\) $/  {\\\&quot;\1\\\&quot;, (lt_ptr) 0},/p' -e 's/^$symcode* \([^ ]*\) \([^ ]*\)$/  {\&quot;\2\&quot;, (lt_ptr) \&amp;\2},/p'&quot;
+  fi
+  ;;
 irix* | nonstopux*)
   symcode='[BCDEGRST]'
   ;;
@@ -5510,8 +5573,11 @@
 # Try without a prefix undercore, then with it.
 for ac_symprfx in &quot;&quot; &quot;_&quot;; do
 
+  # Transform symcode, sympat, and symprfx into a raw symbol and a C symbol.
+  symxfrm=&quot;\\1 $ac_symprfx\\2 \\2&quot;
+
   # Write the raw and C identifiers.
-  lt_cv_sys_global_symbol_pipe=&quot;sed -n -e 's/^.*[ 	]\($symcode$symcode*\)[ 	][ 	]*\($ac_symprfx\)$sympat$opt_cr$/$symxfrm/p'&quot;
+  lt_cv_sys_global_symbol_pipe=&quot;sed -n -e 's/^.*[ 	]\($symcode$symcode*\)[ 	][ 	]*$ac_symprfx$sympat$opt_cr$/$symxfrm/p'&quot;
 
   # Check to see that the pipe works correctly.
   pipe_works=no
@@ -5673,7 +5739,7 @@
 
 # Sed substitution that helps us do robust quoting.  It backslashifies
 # metacharacters that are still active within double-quoted strings.
-Xsed='sed -e s/^X//'
+Xsed='sed -e 1s/^X//'
 sed_quote_subst='s/\([\\&quot;\\`$\\\\]\)/\\\1/g'
 
 # Same as above, but do not quote variable references.
@@ -5978,6 +6044,17 @@
   old_archive_cmds=&quot;$old_archive_cmds~\$RANLIB \$oldlib&quot;
 fi
 
+for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
+
+
 # Only perform the check for file, if the check method requires it
 case $deplibs_check_method in
 file_magic*)
@@ -6133,6 +6210,47 @@
 fi;
 test -z &quot;$pic_mode&quot; &amp;&amp; pic_mode=default
 
+# Check if we have a version mismatch between libtool.m4 and ltmain.sh.
+#
+# Note:  This should be in AC_LIBTOOL_SETUP, _after_ $ltmain have been defined.
+#        We also should do it _before_ AC_LIBTOOL_LANG_C_CONFIG that actually
+#        calls AC_LIBTOOL_CONFIG and creates libtool.
+#
+echo &quot;$as_me:$LINENO: checking for correct ltmain.sh version&quot; &gt;&amp;5
+echo $ECHO_N &quot;checking for correct ltmain.sh version... $ECHO_C&quot; &gt;&amp;6
+if test -z &quot;$ltmain&quot;; then
+  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  echo
+  echo &quot;*** Gentoo sanity check failed! ***&quot;
+  echo &quot;*** \$ltmain is not defined, please check the patch for consistency! ***&quot;
+  echo
+  exit 1
+fi
+gentoo_lt_version=&quot;1.5.18&quot;
+gentoo_ltmain_version=`grep '^[:space:]*VERSION=' $ltmain | sed -e 's|^[:space:]*VERSION=||'`
+if test &quot;$gentoo_lt_version&quot; != &quot;$gentoo_ltmain_version&quot;; then
+  echo &quot;$as_me:$LINENO: result: no&quot; &gt;&amp;5
+echo &quot;${ECHO_T}no&quot; &gt;&amp;6
+  echo
+  echo &quot;*** Gentoo sanity check failed! ***&quot;
+  echo &quot;*** libtool.m4 and ltmain.sh have a version mismatch! ***&quot;
+  echo &quot;*** (libtool.m4 = $gentoo_lt_version, ltmain.sh = $gentoo_ltmain_version) ***&quot;
+  echo
+  echo &quot;Please run:&quot;
+  echo
+  echo &quot;  libtoolize --copy --force&quot;
+  echo
+  echo &quot;if appropriate, please contact the maintainer of this&quot;
+  echo &quot;package (or your distribution) for help.&quot;
+  echo
+  exit 1
+else
+  echo &quot;$as_me:$LINENO: result: yes&quot; &gt;&amp;5
+echo &quot;${ECHO_T}yes&quot; &gt;&amp;6
+fi
+
+
 # Use C for the default configuration in the libtool script
 tagname=
 lt_save_CC=&quot;$CC&quot;
@@ -6164,6 +6282,20 @@
 compiler=$CC
 
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+
+
 #
 # Check for any special shared library compilation flags.
 #
@@ -6205,6 +6337,11 @@
      if test -s conftest.err; then
        # Append any errors to the config.log.
        cat conftest.err 1&gt;&amp;5
+       $echo &quot;X$_lt_linker_boilerplate&quot; | $Xsed &gt; conftest.exp
+       $SED '/^$/d' conftest.err &gt;conftest.er2
+       if diff conftest.exp conftest.er2 &gt;/dev/null; then
+         lt_prog_compiler_static_works=yes
+       fi
      else
        lt_prog_compiler_static_works=yes
      fi
@@ -6249,15 +6386,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:6252: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:6389: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:6256: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:6393: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_rtti_exceptions=yes
      fi
    fi
@@ -6360,6 +6499,16 @@
 	lt_prog_compiler_static='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
+      darwin*)
+        # PIC is the default on this platform
+        # Common symbols not allowed in MH_DYLIB files
+       case $cc_basename in
+         xlc*)
+         lt_prog_compiler_pic='-qnocommon'
+         lt_prog_compiler_wl='-Wl,'
+         ;;
+       esac
+       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -6395,12 +6544,19 @@
       ;;
 
     linux*)
-      case $CC in
+      case $cc_basename in
       icc* | ecc*)
 	lt_prog_compiler_wl='-Wl,'
 	lt_prog_compiler_pic='-KPIC'
 	lt_prog_compiler_static='-static'
         ;;
+      pgcc* | pgf77* | pgf90*)
+        # Portland Group compilers (*not* the Pentium gcc compiler,
+	# which looks to be a dead project)
+	lt_prog_compiler_wl='-Wl,'
+	lt_prog_compiler_pic='-fpic'
+	lt_prog_compiler_static='-static'
+        ;;
       ccc*)
         lt_prog_compiler_wl='-Wl,'
         # All Alpha code is PIC.
@@ -6421,9 +6577,14 @@
       ;;
 
     solaris*)
-      lt_prog_compiler_wl='-Wl,'
       lt_prog_compiler_pic='-KPIC'
       lt_prog_compiler_static='-Bstatic'
+      case $cc_basename in
+      f77* | f90* | f95*)
+	lt_prog_compiler_wl='-Qoption ld ';;
+      *)
+	lt_prog_compiler_wl='-Wl,';;
+      esac
       ;;
 
     sunos4*)
@@ -6445,6 +6606,11 @@
       fi
       ;;
 
+    unicos*)
+      lt_prog_compiler_wl='-Wl,'
+      lt_prog_compiler_can_build_shared=no
+      ;;
+
     uts4*)
       lt_prog_compiler_pic='-pic'
       lt_prog_compiler_static='-Bstatic'
@@ -6482,15 +6648,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:6485: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:6651: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:6489: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:6655: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_prog_compiler_pic_works=yes
      fi
    fi
@@ -6542,16 +6710,18 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:6545: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:6713: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;out/conftest.err)
    ac_status=$?
    cat out/conftest.err &gt;&amp;5
-   echo &quot;$as_me:6549: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:6717: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test ! -s out/conftest.err; then
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt; out/conftest.exp
+     $SED '/^$/d' out/conftest.err &gt;out/conftest.er2
+     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_c_o=yes
      fi
    fi
@@ -6631,6 +6801,16 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
+  # Just being paranoid about ensuring that cc_basename is set.
+  for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -6651,6 +6831,27 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
+    # Set some defaults for GNU ld with shared library support. These
+    # are reset later if shared libraries are not supported. Putting them
+    # here allows them to be overridden if necessary.
+    runpath_var=LD_RUN_PATH
+    hardcode_libdir_flag_spec='${wl}--rpath ${wl}$libdir'
+    export_dynamic_flag_spec='${wl}--export-dynamic'
+    # ancient GNU ld didn't support --whole-archive et. al.
+    if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
+	whole_archive_flag_spec=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+      else
+  	whole_archive_flag_spec=
+    fi
+    supports_anon_versioning=no
+    case `$LD -v 2&gt;/dev/null` in
+      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+      *\ 2.11.*) ;; # other 2.11 versions
+      *) supports_anon_versioning=yes ;;
+    esac
+
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -6701,7 +6902,7 @@
       allow_undefined_flag=unsupported
       always_export_symbols=no
       enable_shared_with_static_runtimes=yes
-      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+      export_symbols_cmds='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
 
       if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
         archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -6719,7 +6920,38 @@
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    linux*)
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
+	tmp_addflag=
+	case $cc_basename,$host_cpu in
+	pgcc*)				# Portland Group C compiler
+	  whole_archive_flag_spec='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag'
+	  ;;
+	pgf77* | pgf90* )			# Portland Group f77 and f90 compilers
+	  whole_archive_flag_spec='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag -Mnomain' ;;
+	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
+	  tmp_addflag=' -i_dynamic' ;;
+	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
+	  tmp_addflag=' -i_dynamic -nofor_main' ;;
+	ifc* | ifort*)			# Intel Fortran compiler
+	  tmp_addflag=' -nofor_main' ;;
+	esac
+	archive_cmds='$CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+
+	if test $supports_anon_versioning = yes; then
+	  archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+  cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+  $echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+	  $CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+	fi
+      else
+	ld_shlibs=no
+      fi
+      ;;
+
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -6757,32 +6989,6 @@
       hardcode_shlibpath_var=no
       ;;
 
-  linux*)
-    if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
-        tmp_archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_cmds=&quot;$tmp_archive_cmds&quot;
-      supports_anon_versioning=no
-      case `$LD -v 2&gt;/dev/null` in
-        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
-        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-        *\ 2.11.*) ;; # other 2.11 versions
-        *) supports_anon_versioning=yes ;;
-      esac
-      if test $supports_anon_versioning = yes; then
-        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
-cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
-$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
-        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-      else
-        archive_expsym_cmds=&quot;$tmp_archive_cmds&quot;
-      fi
-      link_all_deplibs=no
-    else
-      ld_shlibs=no
-    fi
-    ;;
-
     *)
       if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
@@ -6793,16 +6999,11 @@
       ;;
     esac
 
-    if test &quot;$ld_shlibs&quot; = yes; then
-      runpath_var=LD_RUN_PATH
-      hardcode_libdir_flag_spec='${wl}--rpath ${wl}$libdir'
-      export_dynamic_flag_spec='${wl}--export-dynamic'
-      # ancient GNU ld didn't support --whole-archive et. al.
-      if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
- 	whole_archive_flag_spec=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
-      else
-  	whole_archive_flag_spec=
-      fi
+    if test &quot;$ld_shlibs&quot; = no; then
+      runpath_var=
+      hardcode_libdir_flag_spec=
+      export_dynamic_flag_spec=
+      whole_archive_flag_spec=
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -6866,7 +7067,7 @@
       link_all_deplibs=yes
 
       if test &quot;$GCC&quot; = yes; then
-	case $host_os in aix4.012|aix4.012.*)
+	case $host_os in aix4.[012]|aix4.[012].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -6887,6 +7088,9 @@
 	  fi
 	esac
 	shared_flag='-shared'
+	if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	  shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+	fi
       else
 	# not using gcc
 	if test &quot;$host_cpu&quot; = ia64; then
@@ -7047,7 +7251,7 @@
       ld_shlibs=no
       ;;
 
-    bsdi4*)
+    bsdi[45]*)
       export_dynamic_flag_spec=-rdynamic
       ;;
 
@@ -7073,52 +7277,52 @@
       ;;
 
     darwin* | rhapsody*)
-    if test &quot;$GXX&quot; = yes ; then
-      archive_cmds_need_lc=no
       case &quot;$host_os&quot; in
-      rhapsody* | darwin1.[012])
-	allow_undefined_flag='-undefined suppress'
-	;;
-      *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	allow_undefined_flag='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[012])
-            allow_undefined_flag='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            allow_undefined_flag='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-	;;
+        rhapsody* | darwin1.[012])
+         allow_undefined_flag='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           allow_undefined_flag='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[012])
+               allow_undefined_flag='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               allow_undefined_flag='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
       esac
-    	lt_int_apple_cc_single_mod=no
-    	output_verbose_link_cmd='echo'
-    	if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-    	  lt_int_apple_cc_single_mod=yes
-    	fi
-    	if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-    	  archive_cmds='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    	else
-        archive_cmds='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      fi
-      module_cmds='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-        if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-          archive_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        else
-          archive_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        fi
-          module_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_cmds_need_lc=no
       hardcode_direct=no
       hardcode_automatic=yes
       hardcode_shlibpath_var=unsupported
-      whole_archive_flag_spec='-all_load $convenience'
+      whole_archive_flag_spec=''
       link_all_deplibs=yes
+    if test &quot;$GCC&quot; = yes ; then
+    	output_verbose_link_cmd='echo'
+        archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+      module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+      archive_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      module_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
-      ld_shlibs=no
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+         archive_cmds='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+         archive_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          module_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         ld_shlibs=no
+          ;;
+      esac
     fi
       ;;
 
@@ -7152,7 +7356,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu)
+    freebsd* | kfreebsd*-gnu | dragonfly*)
       archive_cmds='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec='-R$libdir'
       hardcode_direct=yes
@@ -7239,7 +7443,7 @@
       link_all_deplibs=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -7263,6 +7467,7 @@
       hardcode_shlibpath_var=no
       if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
 	archive_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec='${wl}-E'
       else
@@ -7308,7 +7513,7 @@
 	allow_undefined_flag=' -expect_unresolved \*'
 	archive_cmds='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	archive_expsym_cmds='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec='-rpath $libdir'
@@ -7327,10 +7532,12 @@
     solaris*)
       no_undefined_flag=' -z text'
       if test &quot;$GCC&quot; = yes; then
+	wlarc='${wl}'
 	archive_cmds='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
       else
+	wlarc=''
 	archive_cmds='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
@@ -7339,8 +7546,18 @@
       hardcode_shlibpath_var=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
-	whole_archive_flag_spec='-z allextract$convenience -z defaultextract' ;;
+      *)
+ 	# The compiler driver will combine linker options so we
+ 	# cannot just pass the convience library names through
+ 	# without $wl, iff we do not link with $LD.
+ 	# Luckily, gcc supports the same syntax we need for Sun Studio.
+ 	# Supported since Solaris 2.6 (maybe 2.5.1?)
+ 	case $wlarc in
+ 	'')
+ 	  whole_archive_flag_spec='-z allextract$convenience -z defaultextract' ;;
+ 	*)
+ 	  whole_archive_flag_spec='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract' ;;
+ 	esac ;;
       esac
       link_all_deplibs=yes
       ;;
@@ -7614,7 +7831,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi4*)
+bsdi[45]*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -7672,11 +7889,35 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
 
+  linux*)
+    if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      supports_anon_versioning=no
+      case `$LD -v 2&gt;/dev/null` in
+        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+        *\ 2.11.*) ;; # other 2.11 versions
+        *) supports_anon_versioning=yes ;;
+      esac
+      if test $supports_anon_versioning = yes; then
+        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+      else
+        $archive_expsym_cmds=&quot;$archive_cmds&quot;
+      fi
+    else
+      ld_shlibs=no
+    fi
+    ;;
+
   *)
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
@@ -7730,7 +7971,9 @@
   dynamic_linker='GNU ld.so'
   ;;
 
-freebsd*)
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
@@ -7749,7 +7992,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.01* | freebsdelf3.01*)
+  freebsd3.[01]* | freebsdelf3.[01]*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -7875,10 +8118,17 @@
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`$SED -e 's/:,\t/ /g;s/=^=*$//;s/=^= * / /g' /etc/ld.so.conf | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf(&quot;cd /etc; cat %s&quot;, \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' &lt; /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib $lt_ld_extra&quot;
   fi
 
+  case $host_cpu:$lt_cv_cc_64bit_output in
+  powerpc64:yes | s390x:yes | sparc64:yes | x86_64:yes)
+    sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /usr/X11R6/lib64&quot;
+    sys_lib_search_path_spec=&quot;/lib64 /usr/lib64 /usr/local/lib64 /usr/X11R6/lib64&quot;
+    ;;
+  esac
+
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -7886,18 +8136,30 @@
   # people can always --disable-shared, the test was removed, and we
   # assume the GNU/Linux dynamic linker is in use.
   dynamic_linker='GNU/Linux ld.so'
-  ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
+  # Find out which ABI we are using (multilib Linux x86_64 hack).
+  libsuff=
+  case &quot;$host_cpu&quot; in
+  x86_64*)
+    echo '#line 8144 &quot;configure&quot;' &gt; conftest.$ac_ext
+    if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; then
+      case `/usr/bin/file conftest.$ac_objext` in
+      *64-bit*)
+        libsuff=64
+        ;;
+      esac
+    fi
+    rm -rf conftest*
+    ;;
+  *)
+    ;;
+  esac
+  sys_lib_dlsearch_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff}&quot;
+  sys_lib_search_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff} /usr/local/lib${libsuff}&quot;
   ;;
 
 knetbsd*-gnu)
@@ -7950,7 +8212,11 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  need_version=yes
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
+    *)                         need_version=no  ;;
+  esac
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -8072,8 +8338,8 @@
 echo $ECHO_N &quot;checking how to hardcode library paths into programs... $ECHO_C&quot; &gt;&amp;6
 hardcode_action=
 if test -n &quot;$hardcode_libdir_flag_spec&quot; || \
-   test -n &quot;$runpath_var &quot; || \
-   test &quot;X$hardcode_automatic&quot;=&quot;Xyes&quot; ; then
+   test -n &quot;$runpath_var&quot; || \
+   test &quot;X$hardcode_automatic&quot; = &quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$hardcode_direct&quot; != no &amp;&amp;
@@ -8739,7 +9005,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 8742 &quot;configure&quot;
+#line 9008 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -8837,7 +9103,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 8840 &quot;configure&quot;
+#line 9106 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -8966,43 +9232,6 @@
   if test &quot;$host_cpu&quot; != ia64 &amp;&amp; test &quot;$aix_use_runtimelinking&quot; = no ; then
     test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
   fi
-  ;;
-  darwin* | rhapsody*)
-  if test &quot;$GCC&quot; = yes; then
-    archive_cmds_need_lc=no
-    case &quot;$host_os&quot; in
-    rhapsody* | darwin1.[012])
-      allow_undefined_flag='-undefined suppress'
-      ;;
-    *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	allow_undefined_flag='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[012])
-            allow_undefined_flag='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            allow_undefined_flag='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-      ;;
-    esac
-    output_verbose_link_cmd='echo'
-    archive_cmds='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring'
-    module_cmds='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-    archive_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag  -o $lib $libobjs $deplibs$compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    module_expsym_cmds='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    hardcode_direct=no
-    hardcode_automatic=yes
-    hardcode_shlibpath_var=unsupported
-    whole_archive_flag_spec='-all_load $convenience'
-    link_all_deplibs=yes
-  else
-    ld_shlibs=no
-  fi
     ;;
 esac
 echo &quot;$as_me:$LINENO: result: $enable_shared&quot; &gt;&amp;5
@@ -9132,7 +9361,7 @@
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -9143,11 +9372,11 @@
 SED=$lt_SED
 
 # Sed that helps us avoid accidentally triggering echo(1) options like -n.
-Xsed=&quot;$SED -e s/^X//&quot;
+Xsed=&quot;$SED -e 1s/^X//&quot;
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-if test &quot;X\${CDPATH+set}&quot; = Xset; then CDPATH=:; export CDPATH; fi
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
 
 # The names of the tagged configurations supported by this script.
 available_tags=
@@ -9177,7 +9406,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -9253,7 +9488,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -9548,7 +9783,9 @@
 
       case $tagname in
       CXX)
-	if test -n &quot;$CXX&quot; &amp;&amp; test &quot;X$CXX&quot; != &quot;Xno&quot;; then
+	if test -n &quot;$CXX&quot; &amp;&amp; ( test &quot;X$CXX&quot; != &quot;Xno&quot; &amp;&amp;
+	    ( (test &quot;X$CXX&quot; = &quot;Xg++&quot; &amp;&amp; `g++ -v &gt;/dev/null 2&gt;&amp;1` ) ||
+	    (test &quot;X$CXX&quot; != &quot;Xg++&quot;))) ; then
 	  ac_ext=cc
 ac_cpp='$CXXCPP $CPPFLAGS'
 ac_compile='$CXX -c $CXXFLAGS $CPPFLAGS conftest.$ac_ext &gt;&amp;5'
@@ -9606,6 +9843,20 @@
 compiler=$CC
 
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=$CC
 lt_save_LD=$LD
@@ -9627,8 +9878,17 @@
 CC=${CXX-&quot;c++&quot;}
 compiler=$CC
 compiler_CXX=$CC
-cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
+for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
+
 # We don't want -fno-exception wen compiling C++ code, so set the
 # no_builtin_flag separately
 if test &quot;$GXX&quot; = yes; then
@@ -9841,7 +10101,7 @@
     link_all_deplibs_CXX=yes
 
     if test &quot;$GXX&quot; = yes; then
-      case $host_os in aix4.012|aix4.012.*)
+      case $host_os in aix4.[012]|aix4.[012].*)
       # We only want to do this on AIX 4.2 and lower, the check
       # below for broken collect2 doesn't work under 4.3+
 	collect2name=`${CC} -print-prog-name=collect2`
@@ -9862,6 +10122,9 @@
 	fi
       esac
       shared_flag='-shared'
+      if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+      fi
     else
       # not using gcc
       if test &quot;$host_cpu&quot; = ia64; then
@@ -10023,6 +10286,7 @@
     esac
     ;;
 
+
   cygwin* | mingw* | pw32*)
     # _LT_AC_TAGVAR(hardcode_libdir_flag_spec, CXX) is actually meaningless,
     # as there is no search path for DLLs.
@@ -10046,65 +10310,76 @@
       ld_shlibs_CXX=no
     fi
   ;;
+      darwin* | rhapsody*)
+        case &quot;$host_os&quot; in
+        rhapsody* | darwin1.[012])
+         allow_undefined_flag_CXX='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           allow_undefined_flag_CXX='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[012])
+               allow_undefined_flag_CXX='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               allow_undefined_flag_CXX='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
+        esac
+      archive_cmds_need_lc_CXX=no
+      hardcode_direct_CXX=no
+      hardcode_automatic_CXX=yes
+      hardcode_shlibpath_var_CXX=unsupported
+      whole_archive_flag_spec_CXX=''
+      link_all_deplibs_CXX=yes
 
-  darwin* | rhapsody*)
-  if test &quot;$GXX&quot; = yes; then
-    archive_cmds_need_lc_CXX=no
-    case &quot;$host_os&quot; in
-    rhapsody* | darwin1.[012])
-      allow_undefined_flag_CXX='-undefined suppress'
-      ;;
-    *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	allow_undefined_flag_CXX='-flat_namespace -undefined suppress'
+    if test &quot;$GXX&quot; = yes ; then
+      lt_int_apple_cc_single_mod=no
+      output_verbose_link_cmd='echo'
+      if $CC -dumpspecs 2&gt;&amp;1 | $EGREP 'single_module' &gt;/dev/null ; then
+       lt_int_apple_cc_single_mod=yes
+      fi
+      if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+       archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
       else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[012])
-            allow_undefined_flag_CXX='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            allow_undefined_flag_CXX='-undefined dynamic_lookup'
-            ;;
-        esac
+          archive_cmds_CXX='$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+        fi
+        module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+        # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+          if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
+            archive_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          else
+            archive_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          fi
+            module_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      else
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+          archive_cmds_CXX='$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+          module_cmds_CXX='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+          archive_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj ${wl}-single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          module_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         ld_shlibs_CXX=no
+          ;;
+      esac
       fi
-      ;;
-    esac
-    lt_int_apple_cc_single_mod=no
-    output_verbose_link_cmd='echo'
-    if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-      lt_int_apple_cc_single_mod=yes
-    fi
-    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-      archive_cmds_CXX='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    else
-      archive_cmds_CXX='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    fi
-    module_cmds_CXX='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+        ;;
 
-    # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-    if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-      archive_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    else
-      archive_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    fi
-    module_expsym_cmds_CXX='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-    hardcode_direct_CXX=no
-    hardcode_automatic_CXX=yes
-    hardcode_shlibpath_var_CXX=unsupported
-    whole_archive_flag_spec_CXX='-all_load $convenience'
-    link_all_deplibs_CXX=yes
-  else
-    ld_shlibs_CXX=no
-  fi
-    ;;
-
   dgux*)
     case $cc_basename in
-      ec++)
+      ec++*)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      ghcx)
+      ghcx*)
 	# Green Hills C++ Compiler
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10115,14 +10390,14 @@
 	;;
     esac
     ;;
-  freebsd12*)
+  freebsd[12]*)
     # C++ shared libraries reported to be fairly broken before switch to ELF
     ld_shlibs_CXX=no
     ;;
   freebsd-elf*)
     archive_cmds_need_lc_CXX=no
     ;;
-  freebsd* | kfreebsd*-gnu)
+  freebsd* | kfreebsd*-gnu | dragonfly*)
     # FreeBSD 3 and later use GNU C++ and GNU ld with standard ELF
     # conventions
     ld_shlibs_CXX=yes
@@ -10139,11 +10414,11 @@
 				# location of the library.
 
     case $cc_basename in
-    CC)
+    CC*)
       # FIXME: insert proper C++ library support
       ld_shlibs_CXX=no
       ;;
-    aCC)
+    aCC*)
       archive_cmds_CXX='$rm $output_objdir/$soname~$CC -b ${wl}+b ${wl}$install_libdir -o $output_objdir/$soname $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags~test $output_objdir/$soname = $lib || mv $output_objdir/$soname $lib'
       # Commands to make compiler produce verbose output that lists
       # what &quot;hidden&quot; libraries, object files and flags are used when
@@ -10153,7 +10428,7 @@
       # explicitly linking system object files so we need to strip them
       # from the output so that they don't get included in the library
       # dependencies.
-      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | grep &quot;-L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
+      output_verbose_link_cmd='templist=`($CC -b $CFLAGS -v conftest.$objext 2&gt;&amp;1) | grep &quot;[-]L&quot;`; list=&quot;&quot;; for z in $templist; do case $z in conftest.$objext) list=&quot;$list $z&quot;;; *.$objext);; *) list=&quot;$list $z&quot;;;esac; done; echo $list'
       ;;
     *)
       if test &quot;$GXX&quot; = yes; then
@@ -10204,11 +10479,11 @@
     esac
 
     case $cc_basename in
-      CC)
+      CC*)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      aCC)
+      aCC*)
 	case &quot;$host_cpu&quot; in
 	hppa*64*|ia64*)
 	  archive_cmds_CXX='$LD -b +h $soname -o $lib $linker_flags $libobjs $deplibs'
@@ -10248,9 +10523,9 @@
     ;;
   irix5* | irix6*)
     case $cc_basename in
-      CC)
+      CC*)
 	# SGI C++
-	archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	archive_cmds_CXX='$CC -shared -all -multigot $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	# Archives containing C++ object files must be created using
 	# &quot;CC -ar&quot;, where &quot;CC&quot; is the IRIX C++ compiler.  This is
@@ -10261,7 +10536,7 @@
       *)
 	if test &quot;$GXX&quot; = yes; then
 	  if test &quot;$with_gnu_ld&quot; = no; then
-	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 	  else
 	    archive_cmds_CXX='$CC -shared -nostdlib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` -o $lib'
 	  fi
@@ -10274,7 +10549,7 @@
     ;;
   linux*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10299,17 +10574,41 @@
 	# &quot;CC -Bstatic&quot;, where &quot;CC&quot; is the KAI C++ compiler.
 	old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs'
 	;;
-      icpc)
+      icpc*)
 	# Intel C++
 	with_gnu_ld=yes
+	# version 8.0 and above of icpc choke on multiply defined symbols
+	# if we add $predep_objects and $postdep_objects, however 7.1 and
+	# earlier do not add the objects themselves.
+	case `$CC -V 2&gt;&amp;1` in
+	*&quot;Version 7.&quot;*)
+  	  archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
+  	  archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	  ;;
+	*)  # Version 8.0 or newer
+	  tmp_idyn=
+	  case $host_cpu in
+	    ia64*) tmp_idyn=' -i_dynamic';;
+	  esac
+  	  archive_cmds_CXX='$CC -shared'&quot;$tmp_idyn&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+	  archive_expsym_cmds_CXX='$CC -shared'&quot;$tmp_idyn&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
+	  ;;
+	esac
 	archive_cmds_need_lc_CXX=no
-	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname ${wl}-retain-symbols-file $wl$export_symbols -o $lib'
 	hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
 	whole_archive_flag_spec_CXX='${wl}--whole-archive$convenience ${wl}--no-whole-archive'
 	;;
-      cxx)
+      pgCC*)
+        # Portland Group C++ compiler
+	archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname -o $lib'
+  	archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname ${wl}-retain-symbols-file ${wl}$export_symbols -o $lib'
+
+	hardcode_libdir_flag_spec_CXX='${wl}--rpath ${wl}$libdir'
+	export_dynamic_flag_spec_CXX='${wl}--export-dynamic'
+	whole_archive_flag_spec_CXX='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+        ;;
+      cxx*)
 	# Compaq C++
 	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname -o $lib'
 	archive_expsym_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $wl$soname  -o $lib ${wl}-retain-symbols-file $wl$export_symbols'
@@ -10340,7 +10639,7 @@
     ;;
   mvs*)
     case $cc_basename in
-      cxx)
+      cxx*)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
@@ -10350,7 +10649,7 @@
 	;;
     esac
     ;;
-  netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+  netbsd*)
     if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
       archive_cmds_CXX='$LD -Bshareable  -o $lib $predep_objects $libobjs $deplibs $postdep_objects $linker_flags'
       wlarc=
@@ -10361,9 +10660,25 @@
     # Workaround some broken pre-1.5 toolchains
     output_verbose_link_cmd='$CC -shared $CFLAGS -v conftest.$objext 2&gt;&amp;1 | grep conftest.$objext | $SED -e &quot;s:-lgcc -lc -lgcc::&quot;'
     ;;
+  openbsd2*)
+    # C++ shared libraries are fairly broken
+    ld_shlibs_CXX=no
+    ;;
+  openbsd*)
+    hardcode_direct_CXX=yes
+    hardcode_shlibpath_var_CXX=no
+    archive_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -o $lib'
+    hardcode_libdir_flag_spec_CXX='${wl}-rpath,$libdir'
+    if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
+      archive_expsym_cmds_CXX='$CC -shared $pic_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-retain-symbols-file,$export_symbols -o $lib'
+      export_dynamic_flag_spec_CXX='${wl}-E'
+      whole_archive_flag_spec_CXX=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+    fi
+    output_verbose_link_cmd='echo'
+    ;;
   osf3*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10379,14 +10694,14 @@
 	old_archive_cmds_CXX='$CC -Bstatic -o $oldlib $oldobjs'
 
 	;;
-      RCC)
+      RCC*)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      cxx)
+      cxx*)
 	allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 
 	hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	hardcode_libdir_separator_CXX=:
@@ -10404,7 +10719,7 @@
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
 	  allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	  archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	  archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 
 	  hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	  hardcode_libdir_separator_CXX=:
@@ -10423,7 +10738,7 @@
     ;;
   osf4* | osf5*)
     case $cc_basename in
-      KCC)
+      KCC*)
 	# Kuck and Associates, Inc. (KAI) C++ Compiler
 
 	# KCC will only create a shared library if the output file
@@ -10438,17 +10753,17 @@
 	# the KAI C++ compiler.
 	old_archive_cmds_CXX='$CC -o $oldlib $oldobjs'
 	;;
-      RCC)
+      RCC*)
 	# Rational C++ 2.4.1
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      cxx)
+      cxx*)
 	allow_undefined_flag_CXX=' -expect_unresolved \*'
-	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib'
+	archive_cmds_CXX='$CC -shared${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	archive_expsym_cmds_CXX='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done~
 	  echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version	$verstring` -update_registry $objdir/so_locations -o $lib~
+	  $CC -shared$allow_undefined_flag $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags -msym -soname $soname -Wl,-input -Wl,$lib.exp  `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version	$verstring` -update_registry ${output_objdir}/so_locations -o $lib~
 	  $rm $lib.exp'
 
 	hardcode_libdir_flag_spec_CXX='-rpath $libdir'
@@ -10467,7 +10782,7 @@
       *)
 	if test &quot;$GXX&quot; = yes &amp;&amp; test &quot;$with_gnu_ld&quot; = no; then
 	  allow_undefined_flag_CXX=' ${wl}-expect_unresolved ${wl}\*'
-	 archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${objdir}/so_locations -o $lib'
+	 archive_cmds_CXX='$CC -shared -nostdlib ${allow_undefined_flag} $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-msym ${wl}-soname ${wl}$soname `test -n &quot;$verstring&quot; &amp;&amp; echo ${wl}-set_version ${wl}$verstring` ${wl}-update_registry ${wl}${output_objdir}/so_locations -o $lib'
 
 	  hardcode_libdir_flag_spec_CXX='${wl}-rpath ${wl}$libdir'
 	  hardcode_libdir_separator_CXX=:
@@ -10491,7 +10806,7 @@
   sco*)
     archive_cmds_need_lc_CXX=no
     case $cc_basename in
-      CC)
+      CC*)
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
@@ -10503,12 +10818,12 @@
     ;;
   sunos4*)
     case $cc_basename in
-      CC)
+      CC*)
 	# Sun C++ 4.x
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
 	;;
-      lcc)
+      lcc*)
 	# Lucid
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10521,7 +10836,7 @@
     ;;
   solaris*)
     case $cc_basename in
-      CC)
+      CC*)
 	# Sun C++ 4.2, 5.x and Centerline C++
 	no_undefined_flag_CXX=' -zdefs'
 	archive_cmds_CXX='$CC -G${allow_undefined_flag} -nolib -h$soname -o $lib $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags'
@@ -10531,13 +10846,17 @@
 	hardcode_libdir_flag_spec_CXX='-R$libdir'
 	hardcode_shlibpath_var_CXX=no
 	case $host_os in
-	  solaris2.0-5 | solaris2.0-5.*) ;;
+	  solaris2.[0-5] | solaris2.[0-5].*) ;;
 	  *)
 	    # The C++ compiler is used as linker so we must use $wl
 	    # flag to pass the commands to the underlying system
-	    # linker.
+	    # linker. We must also pass each convience library through
+	    # to the system linker between allextract/defaultextract.
+	    # The C++ compiler will combine linker options so we
+	    # cannot just pass the convience library names through
+	    # without $wl.
 	    # Supported since Solaris 2.6 (maybe 2.5.1?)
-	    whole_archive_flag_spec_CXX='${wl}-z ${wl}allextract$convenience ${wl}-z ${wl}defaultextract'
+	    whole_archive_flag_spec_CXX='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract'
 	    ;;
 	esac
 	link_all_deplibs_CXX=yes
@@ -10558,7 +10877,7 @@
 	# in the archive.
 	old_archive_cmds_CXX='$CC -xar -o $oldlib $oldobjs'
 	;;
-      gcx)
+      gcx*)
 	# Green Hills C++ Compiler
 	archive_cmds_CXX='$CC -shared $predep_objects $libobjs $deplibs $postdep_objects $compiler_flags ${wl}-h $wl$soname -o $lib'
 
@@ -10601,7 +10920,7 @@
     ;;
   tandem*)
     case $cc_basename in
-      NCC)
+      NCC*)
 	# NonStop-UX NCC 3.20
 	# FIXME: insert proper C++ library support
 	ld_shlibs_CXX=no
@@ -10810,18 +11129,28 @@
 	;;
       chorus*)
 	case $cc_basename in
-	cxch68)
+	cxch68*)
 	  # Green Hills C++ Compiler
 	  # _LT_AC_TAGVAR(lt_prog_compiler_static, CXX)=&quot;--no_auto_instantiation -u __main -u __premain -u _abort -r $COOL_DIR/lib/libOrb.a $MVME_DIR/lib/CC/libC.a $MVME_DIR/lib/classix/libcx.s.a&quot;
 	  ;;
 	esac
 	;;
+       darwin*)
+         # PIC is the default on this platform
+         # Common symbols not allowed in MH_DYLIB files
+         case $cc_basename in
+           xlc*)
+           lt_prog_compiler_pic_CXX='-qnocommon'
+           lt_prog_compiler_wl_CXX='-Wl,'
+           ;;
+         esac
+       ;;
       dgux*)
 	case $cc_basename in
-	  ec++)
+	  ec++*)
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    ;;
-	  ghcx)
+	  ghcx*)
 	    # Green Hills C++ Compiler
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
@@ -10829,19 +11158,19 @@
 	    ;;
 	esac
 	;;
-      freebsd* | kfreebsd*-gnu)
+      freebsd* | kfreebsd*-gnu | dragonfly*)
 	# FreeBSD uses GNU C++
 	;;
       hpux9* | hpux10* | hpux11*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX=&quot;${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive&quot;
 	    if test &quot;$host_cpu&quot; != ia64; then
 	      lt_prog_compiler_pic_CXX='+Z'
 	    fi
 	    ;;
-	  aCC)
+	  aCC*)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX=&quot;${ac_cv_prog_cc_wl}-a ${ac_cv_prog_cc_wl}archive&quot;
 	    case &quot;$host_cpu&quot; in
@@ -10859,7 +11188,7 @@
 	;;
       irix5* | irix6* | nonstopux*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_static_CXX='-non_shared'
 	    # CC pic flag -KPIC is the default.
@@ -10870,18 +11199,24 @@
 	;;
       linux*)
 	case $cc_basename in
-	  KCC)
+	  KCC*)
 	    # KAI C++ Compiler
 	    lt_prog_compiler_wl_CXX='--backend -Wl,'
 	    lt_prog_compiler_pic_CXX='-fPIC'
 	    ;;
-	  icpc)
+	  icpc* | ecpc*)
 	    # Intel C++
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    lt_prog_compiler_static_CXX='-static'
 	    ;;
-	  cxx)
+	  pgCC*)
+	    # Portland Group C++ compiler.
+	    lt_prog_compiler_wl_CXX='-Wl,'
+	    lt_prog_compiler_pic_CXX='-fpic'
+	    lt_prog_compiler_static_CXX='-static'
+	    ;;
+	  cxx*)
 	    # Compaq C++
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
 	    # Linux and Compaq Tru64 Unix objects are PIC.
@@ -10898,25 +11233,25 @@
 	;;
       mvs*)
 	case $cc_basename in
-	  cxx)
+	  cxx*)
 	    lt_prog_compiler_pic_CXX='-W c,exportall'
 	    ;;
 	  *)
 	    ;;
 	esac
 	;;
-      netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+      netbsd*)
 	;;
       osf3* | osf4* | osf5*)
 	case $cc_basename in
-	  KCC)
+	  KCC*)
 	    lt_prog_compiler_wl_CXX='--backend -Wl,'
 	    ;;
-	  RCC)
+	  RCC*)
 	    # Rational C++ 2.4.1
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
-	  cxx)
+	  cxx*)
 	    # Digital/Compaq C++
 	    lt_prog_compiler_wl_CXX='-Wl,'
 	    # Make sure the PIC flag is empty.  It appears that all Alpha
@@ -10932,7 +11267,7 @@
 	;;
       sco*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    lt_prog_compiler_pic_CXX='-fPIC'
 	    ;;
 	  *)
@@ -10941,13 +11276,13 @@
 	;;
       solaris*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    # Sun C++ 4.2, 5.x and Centerline C++
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    lt_prog_compiler_static_CXX='-Bstatic'
 	    lt_prog_compiler_wl_CXX='-Qoption ld '
 	    ;;
-	  gcx)
+	  gcx*)
 	    # Green Hills C++ Compiler
 	    lt_prog_compiler_pic_CXX='-PIC'
 	    ;;
@@ -10957,12 +11292,12 @@
 	;;
       sunos4*)
 	case $cc_basename in
-	  CC)
+	  CC*)
 	    # Sun C++ 4.x
 	    lt_prog_compiler_pic_CXX='-pic'
 	    lt_prog_compiler_static_CXX='-Bstatic'
 	    ;;
-	  lcc)
+	  lcc*)
 	    # Lucid
 	    lt_prog_compiler_pic_CXX='-pic'
 	    ;;
@@ -10972,7 +11307,7 @@
 	;;
       tandem*)
 	case $cc_basename in
-	  NCC)
+	  NCC*)
 	    # NonStop-UX NCC 3.20
 	    lt_prog_compiler_pic_CXX='-KPIC'
 	    ;;
@@ -11016,15 +11351,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:11019: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:11354: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:11023: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:11358: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_prog_compiler_pic_works_CXX=yes
      fi
    fi
@@ -11076,16 +11413,18 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:11079: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:11416: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;out/conftest.err)
    ac_status=$?
    cat out/conftest.err &gt;&amp;5
-   echo &quot;$as_me:11083: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:11420: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test ! -s out/conftest.err; then
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt; out/conftest.exp
+     $SED '/^$/d' out/conftest.err &gt;out/conftest.er2
+     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_c_o_CXX=yes
      fi
    fi
@@ -11144,11 +11483,8 @@
     export_symbols_cmds_CXX=&quot;$ltdll_cmds&quot;
   ;;
   cygwin* | mingw*)
-    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+    export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/;/^.* __nm__/s/^.* __nm__\([^ ]*\) [^ ]*/\1 DATA/;/^I /d;/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
   ;;
-  linux*)
-    link_all_deplibs_CXX=no
-  ;;
   *)
     export_symbols_cmds_CXX='$NM $libobjs $convenience | $global_symbol_pipe | $SED '\''s/.* //'\'' | sort | uniq &gt; $export_symbols'
   ;;
@@ -11327,7 +11663,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi4*)
+bsdi[45]*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -11385,11 +11721,35 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
 
+  linux*)
+    if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      supports_anon_versioning=no
+      case `$LD -v 2&gt;/dev/null` in
+        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+        *\ 2.11.*) ;; # other 2.11 versions
+        *) supports_anon_versioning=yes ;;
+      esac
+      if test $supports_anon_versioning = yes; then
+        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+      else
+        $archive_expsym_cmds=&quot;$archive_cmds&quot;
+      fi
+    else
+      ld_shlibs=no
+    fi
+    ;;
+
   *)
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
@@ -11443,7 +11803,9 @@
   dynamic_linker='GNU ld.so'
   ;;
 
-freebsd*)
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
@@ -11462,7 +11824,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.01* | freebsdelf3.01*)
+  freebsd3.[01]* | freebsdelf3.[01]*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -11588,10 +11950,17 @@
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`$SED -e 's/:,\t/ /g;s/=^=*$//;s/=^= * / /g' /etc/ld.so.conf | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf(&quot;cd /etc; cat %s&quot;, \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' &lt; /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib $lt_ld_extra&quot;
   fi
 
+  case $host_cpu:$lt_cv_cc_64bit_output in
+  powerpc64:yes | s390x:yes | sparc64:yes | x86_64:yes)
+    sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /usr/X11R6/lib64&quot;
+    sys_lib_search_path_spec=&quot;/lib64 /usr/lib64 /usr/local/lib64 /usr/X11R6/lib64&quot;
+    ;;
+  esac
+
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -11599,18 +11968,30 @@
   # people can always --disable-shared, the test was removed, and we
   # assume the GNU/Linux dynamic linker is in use.
   dynamic_linker='GNU/Linux ld.so'
-  ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
+  # Find out which ABI we are using (multilib Linux x86_64 hack).
+  libsuff=
+  case &quot;$host_cpu&quot; in
+  x86_64*)
+    echo '#line 11976 &quot;configure&quot;' &gt; conftest.$ac_ext
+    if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; then
+      case `/usr/bin/file conftest.$ac_objext` in
+      *64-bit*)
+        libsuff=64
+        ;;
+      esac
+    fi
+    rm -rf conftest*
+    ;;
+  *)
+    ;;
+  esac
+  sys_lib_dlsearch_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff}&quot;
+  sys_lib_search_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff} /usr/local/lib${libsuff}&quot;
   ;;
 
 knetbsd*-gnu)
@@ -11663,7 +12044,11 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  need_version=yes
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
+    *)                         need_version=no  ;;
+  esac
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -11785,8 +12170,8 @@
 echo $ECHO_N &quot;checking how to hardcode library paths into programs... $ECHO_C&quot; &gt;&amp;6
 hardcode_action_CXX=
 if test -n &quot;$hardcode_libdir_flag_spec_CXX&quot; || \
-   test -n &quot;$runpath_var CXX&quot; || \
-   test &quot;X$hardcode_automatic_CXX&quot;=&quot;Xyes&quot; ; then
+   test -n &quot;$runpath_var_CXX&quot; || \
+   test &quot;X$hardcode_automatic_CXX&quot; = &quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$hardcode_direct_CXX&quot; != no &amp;&amp;
@@ -12452,7 +12837,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 12455 &quot;configure&quot;
+#line 12840 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -12550,7 +12935,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 12553 &quot;configure&quot;
+#line 12938 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -12768,7 +13153,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -12844,7 +13235,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_CXX
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -13125,13 +13516,36 @@
 compiler=$CC
 
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${F77-&quot;f77&quot;}
 compiler=$CC
 compiler_F77=$CC
-cc_basename=`$echo X&quot;$compiler&quot; | $Xsed -e 's%^.*/%%'`
+for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
+
 echo &quot;$as_me:$LINENO: checking if libtool supports shared libraries&quot; &gt;&amp;5
 echo $ECHO_N &quot;checking if libtool supports shared libraries... $ECHO_C&quot; &gt;&amp;6
 echo &quot;$as_me:$LINENO: result: $can_build_shared&quot; &gt;&amp;5
@@ -13152,7 +13566,9 @@
   fi
   ;;
 aix4* | aix5*)
-  test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  if test &quot;$host_cpu&quot; != ia64 &amp;&amp; test &quot;$aix_use_runtimelinking&quot; = no ; then
+    test &quot;$enable_shared&quot; = yes &amp;&amp; enable_static=no
+  fi
   ;;
 esac
 echo &quot;$as_me:$LINENO: result: $enable_shared&quot; &gt;&amp;5
@@ -13255,6 +13671,16 @@
 	lt_prog_compiler_static_F77='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
+      darwin*)
+        # PIC is the default on this platform
+        # Common symbols not allowed in MH_DYLIB files
+       case $cc_basename in
+         xlc*)
+         lt_prog_compiler_pic_F77='-qnocommon'
+         lt_prog_compiler_wl_F77='-Wl,'
+         ;;
+       esac
+       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -13290,12 +13716,19 @@
       ;;
 
     linux*)
-      case $CC in
+      case $cc_basename in
       icc* | ecc*)
 	lt_prog_compiler_wl_F77='-Wl,'
 	lt_prog_compiler_pic_F77='-KPIC'
 	lt_prog_compiler_static_F77='-static'
         ;;
+      pgcc* | pgf77* | pgf90*)
+        # Portland Group compilers (*not* the Pentium gcc compiler,
+	# which looks to be a dead project)
+	lt_prog_compiler_wl_F77='-Wl,'
+	lt_prog_compiler_pic_F77='-fpic'
+	lt_prog_compiler_static_F77='-static'
+        ;;
       ccc*)
         lt_prog_compiler_wl_F77='-Wl,'
         # All Alpha code is PIC.
@@ -13316,9 +13749,14 @@
       ;;
 
     solaris*)
-      lt_prog_compiler_wl_F77='-Wl,'
       lt_prog_compiler_pic_F77='-KPIC'
       lt_prog_compiler_static_F77='-Bstatic'
+      case $cc_basename in
+      f77* | f90* | f95*)
+	lt_prog_compiler_wl_F77='-Qoption ld ';;
+      *)
+	lt_prog_compiler_wl_F77='-Wl,';;
+      esac
       ;;
 
     sunos4*)
@@ -13340,6 +13778,11 @@
       fi
       ;;
 
+    unicos*)
+      lt_prog_compiler_wl_F77='-Wl,'
+      lt_prog_compiler_can_build_shared_F77=no
+      ;;
+
     uts4*)
       lt_prog_compiler_pic_F77='-pic'
       lt_prog_compiler_static_F77='-Bstatic'
@@ -13377,15 +13820,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:13380: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:13823: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:13384: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:13827: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_prog_compiler_pic_works_F77=yes
      fi
    fi
@@ -13437,16 +13882,18 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:13440: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:13885: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;out/conftest.err)
    ac_status=$?
    cat out/conftest.err &gt;&amp;5
-   echo &quot;$as_me:13444: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:13889: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test ! -s out/conftest.err; then
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt; out/conftest.exp
+     $SED '/^$/d' out/conftest.err &gt;out/conftest.er2
+     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_c_o_F77=yes
      fi
    fi
@@ -13526,6 +13973,16 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
+  # Just being paranoid about ensuring that cc_basename is set.
+  for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -13546,6 +14003,27 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
+    # Set some defaults for GNU ld with shared library support. These
+    # are reset later if shared libraries are not supported. Putting them
+    # here allows them to be overridden if necessary.
+    runpath_var=LD_RUN_PATH
+    hardcode_libdir_flag_spec_F77='${wl}--rpath ${wl}$libdir'
+    export_dynamic_flag_spec_F77='${wl}--export-dynamic'
+    # ancient GNU ld didn't support --whole-archive et. al.
+    if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
+	whole_archive_flag_spec_F77=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+      else
+  	whole_archive_flag_spec_F77=
+    fi
+    supports_anon_versioning=no
+    case `$LD -v 2&gt;/dev/null` in
+      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+      *\ 2.11.*) ;; # other 2.11 versions
+      *) supports_anon_versioning=yes ;;
+    esac
+
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -13596,7 +14074,7 @@
       allow_undefined_flag_F77=unsupported
       always_export_symbols_F77=no
       enable_shared_with_static_runtimes_F77=yes
-      export_symbols_cmds_F77='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+      export_symbols_cmds_F77='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
 
       if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
         archive_cmds_F77='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -13610,11 +14088,42 @@
 	fi~
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
-	ld_shlibs=no
+	ld_shlibs_F77=no
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    linux*)
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
+	tmp_addflag=
+	case $cc_basename,$host_cpu in
+	pgcc*)				# Portland Group C compiler
+	  whole_archive_flag_spec_F77='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag'
+	  ;;
+	pgf77* | pgf90* )			# Portland Group f77 and f90 compilers
+	  whole_archive_flag_spec_F77='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag -Mnomain' ;;
+	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
+	  tmp_addflag=' -i_dynamic' ;;
+	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
+	  tmp_addflag=' -i_dynamic -nofor_main' ;;
+	ifc* | ifort*)			# Intel Fortran compiler
+	  tmp_addflag=' -nofor_main' ;;
+	esac
+	archive_cmds_F77='$CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+
+	if test $supports_anon_versioning = yes; then
+	  archive_expsym_cmds_F77='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+  cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+  $echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+	  $CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+	fi
+      else
+	ld_shlibs_F77=no
+      fi
+      ;;
+
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds_F77='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -13652,32 +14161,6 @@
       hardcode_shlibpath_var_F77=no
       ;;
 
-  linux*)
-    if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
-        tmp_archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_cmds_F77=&quot;$tmp_archive_cmds&quot;
-      supports_anon_versioning=no
-      case `$LD -v 2&gt;/dev/null` in
-        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
-        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-        *\ 2.11.*) ;; # other 2.11 versions
-        *) supports_anon_versioning=yes ;;
-      esac
-      if test $supports_anon_versioning = yes; then
-        archive_expsym_cmds_F77='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
-cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
-$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
-        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-      else
-        archive_expsym_cmds_F77=&quot;$tmp_archive_cmds&quot;
-      fi
-      link_all_deplibs_F77=no
-    else
-      ld_shlibs_F77=no
-    fi
-    ;;
-
     *)
       if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	archive_cmds_F77='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
@@ -13688,16 +14171,11 @@
       ;;
     esac
 
-    if test &quot;$ld_shlibs_F77&quot; = yes; then
-      runpath_var=LD_RUN_PATH
-      hardcode_libdir_flag_spec_F77='${wl}--rpath ${wl}$libdir'
-      export_dynamic_flag_spec_F77='${wl}--export-dynamic'
-      # ancient GNU ld didn't support --whole-archive et. al.
-      if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
- 	whole_archive_flag_spec_F77=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
-      else
-  	whole_archive_flag_spec_F77=
-      fi
+    if test &quot;$ld_shlibs_F77&quot; = no; then
+      runpath_var=
+      hardcode_libdir_flag_spec_F77=
+      export_dynamic_flag_spec_F77=
+      whole_archive_flag_spec_F77=
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -13761,7 +14239,7 @@
       link_all_deplibs_F77=yes
 
       if test &quot;$GCC&quot; = yes; then
-	case $host_os in aix4.012|aix4.012.*)
+	case $host_os in aix4.[012]|aix4.[012].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -13782,6 +14260,9 @@
 	  fi
 	esac
 	shared_flag='-shared'
+	if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	  shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+	fi
       else
 	# not using gcc
 	if test &quot;$host_cpu&quot; = ia64; then
@@ -13922,7 +14403,7 @@
       ld_shlibs_F77=no
       ;;
 
-    bsdi4*)
+    bsdi[45]*)
       export_dynamic_flag_spec_F77=-rdynamic
       ;;
 
@@ -13943,57 +14424,57 @@
       old_archive_From_new_cmds_F77='true'
       # FIXME: Should let the user specify the lib program.
       old_archive_cmds_F77='lib /OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path='`cygpath -w &quot;$srcfile&quot;`'
+      fix_srcfile_path_F77='`cygpath -w &quot;$srcfile&quot;`'
       enable_shared_with_static_runtimes_F77=yes
       ;;
 
     darwin* | rhapsody*)
-    if test &quot;$GXX&quot; = yes ; then
-      archive_cmds_need_lc_F77=no
       case &quot;$host_os&quot; in
-      rhapsody* | darwin1.[012])
-	allow_undefined_flag_F77='-undefined suppress'
-	;;
-      *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	allow_undefined_flag_F77='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[012])
-            allow_undefined_flag_F77='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            allow_undefined_flag_F77='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-	;;
+        rhapsody* | darwin1.[012])
+         allow_undefined_flag_F77='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           allow_undefined_flag_F77='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[012])
+               allow_undefined_flag_F77='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               allow_undefined_flag_F77='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
       esac
-    	lt_int_apple_cc_single_mod=no
-    	output_verbose_link_cmd='echo'
-    	if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-    	  lt_int_apple_cc_single_mod=yes
-    	fi
-    	if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-    	  archive_cmds_F77='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    	else
-        archive_cmds_F77='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      fi
-      module_cmds_F77='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-        if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-          archive_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        else
-          archive_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        fi
-          module_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_cmds_need_lc_F77=no
       hardcode_direct_F77=no
       hardcode_automatic_F77=yes
       hardcode_shlibpath_var_F77=unsupported
-      whole_archive_flag_spec_F77='-all_load $convenience'
+      whole_archive_flag_spec_F77=''
       link_all_deplibs_F77=yes
+    if test &quot;$GCC&quot; = yes ; then
+    	output_verbose_link_cmd='echo'
+        archive_cmds_F77='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+      module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+      archive_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      module_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
-      ld_shlibs_F77=no
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+         archive_cmds_F77='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         module_cmds_F77='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+         archive_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          module_expsym_cmds_F77='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         ld_shlibs_F77=no
+          ;;
+      esac
     fi
       ;;
 
@@ -14027,7 +14508,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu)
+    freebsd* | kfreebsd*-gnu | dragonfly*)
       archive_cmds_F77='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec_F77='-R$libdir'
       hardcode_direct_F77=yes
@@ -14114,7 +14595,7 @@
       link_all_deplibs_F77=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds_F77='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -14138,6 +14619,7 @@
       hardcode_shlibpath_var_F77=no
       if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
 	archive_cmds_F77='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds_F77='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec_F77='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_F77='${wl}-E'
       else
@@ -14183,7 +14665,7 @@
 	allow_undefined_flag_F77=' -expect_unresolved \*'
 	archive_cmds_F77='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	archive_expsym_cmds_F77='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec_F77='-rpath $libdir'
@@ -14202,10 +14684,12 @@
     solaris*)
       no_undefined_flag_F77=' -z text'
       if test &quot;$GCC&quot; = yes; then
+	wlarc='${wl}'
 	archive_cmds_F77='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	archive_expsym_cmds_F77='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
       else
+	wlarc=''
 	archive_cmds_F77='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	archive_expsym_cmds_F77='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
@@ -14214,8 +14698,18 @@
       hardcode_shlibpath_var_F77=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
-	whole_archive_flag_spec_F77='-z allextract$convenience -z defaultextract' ;;
+      *)
+ 	# The compiler driver will combine linker options so we
+ 	# cannot just pass the convience library names through
+ 	# without $wl, iff we do not link with $LD.
+ 	# Luckily, gcc supports the same syntax we need for Sun Studio.
+ 	# Supported since Solaris 2.6 (maybe 2.5.1?)
+ 	case $wlarc in
+ 	'')
+ 	  whole_archive_flag_spec_F77='-z allextract$convenience -z defaultextract' ;;
+ 	*)
+ 	  whole_archive_flag_spec_F77='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract' ;;
+ 	esac ;;
       esac
       link_all_deplibs_F77=yes
       ;;
@@ -14489,7 +14983,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi4*)
+bsdi[45]*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -14547,11 +15041,35 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
 
+  linux*)
+    if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      supports_anon_versioning=no
+      case `$LD -v 2&gt;/dev/null` in
+        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+        *\ 2.11.*) ;; # other 2.11 versions
+        *) supports_anon_versioning=yes ;;
+      esac
+      if test $supports_anon_versioning = yes; then
+        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+      else
+        $archive_expsym_cmds=&quot;$archive_cmds&quot;
+      fi
+    else
+      ld_shlibs=no
+    fi
+    ;;
+
   *)
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
@@ -14605,7 +15123,9 @@
   dynamic_linker='GNU ld.so'
   ;;
 
-freebsd*)
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
@@ -14624,7 +15144,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.01* | freebsdelf3.01*)
+  freebsd3.[01]* | freebsdelf3.[01]*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -14750,10 +15270,17 @@
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`$SED -e 's/:,\t/ /g;s/=^=*$//;s/=^= * / /g' /etc/ld.so.conf | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf(&quot;cd /etc; cat %s&quot;, \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' &lt; /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib $lt_ld_extra&quot;
   fi
 
+  case $host_cpu:$lt_cv_cc_64bit_output in
+  powerpc64:yes | s390x:yes | sparc64:yes | x86_64:yes)
+    sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /usr/X11R6/lib64&quot;
+    sys_lib_search_path_spec=&quot;/lib64 /usr/lib64 /usr/local/lib64 /usr/X11R6/lib64&quot;
+    ;;
+  esac
+
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -14761,18 +15288,30 @@
   # people can always --disable-shared, the test was removed, and we
   # assume the GNU/Linux dynamic linker is in use.
   dynamic_linker='GNU/Linux ld.so'
-  ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
+  # Find out which ABI we are using (multilib Linux x86_64 hack).
+  libsuff=
+  case &quot;$host_cpu&quot; in
+  x86_64*)
+    echo '#line 15296 &quot;configure&quot;' &gt; conftest.$ac_ext
+    if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; then
+      case `/usr/bin/file conftest.$ac_objext` in
+      *64-bit*)
+        libsuff=64
+        ;;
+      esac
+    fi
+    rm -rf conftest*
+    ;;
+  *)
+    ;;
+  esac
+  sys_lib_dlsearch_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff}&quot;
+  sys_lib_search_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff} /usr/local/lib${libsuff}&quot;
   ;;
 
 knetbsd*-gnu)
@@ -14825,7 +15364,11 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  need_version=yes
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
+    *)                         need_version=no  ;;
+  esac
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -14947,8 +15490,8 @@
 echo $ECHO_N &quot;checking how to hardcode library paths into programs... $ECHO_C&quot; &gt;&amp;6
 hardcode_action_F77=
 if test -n &quot;$hardcode_libdir_flag_spec_F77&quot; || \
-   test -n &quot;$runpath_var F77&quot; || \
-   test &quot;X$hardcode_automatic_F77&quot;=&quot;Xyes&quot; ; then
+   test -n &quot;$runpath_var_F77&quot; || \
+   test &quot;X$hardcode_automatic_F77&quot; = &quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$hardcode_direct_F77&quot; != no &amp;&amp;
@@ -15125,7 +15668,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -15201,7 +15750,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_F77
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -15439,7 +15988,7 @@
 lt_simple_compile_test_code=&quot;class foo {}\n&quot;
 
 # Code to be used in simple link tests
-lt_simple_link_test_code='public class conftest { public static void main(String argv) {}; }\n'
+lt_simple_link_test_code='public class conftest { public static void main(String[] argv) {}; }\n'
 
 # ltmain only uses $CC for tagged configurations so make sure $CC is set.
 
@@ -15450,16 +15999,42 @@
 compiler=$CC
 
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${GCJ-&quot;gcj&quot;}
 compiler=$CC
 compiler_GCJ=$CC
+for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
+
 # GCJ did not exist at the time GCC didn't implicitly link libc in.
 archive_cmds_need_lc_GCJ=no
 
+old_archive_cmds_GCJ=$old_archive_cmds
 
+
 lt_prog_compiler_no_builtin_flag_GCJ=
 
 if test &quot;$GCC&quot; = yes; then
@@ -15484,15 +16059,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:15487: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:16062: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:15491: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:16066: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_rtti_exceptions=yes
      fi
    fi
@@ -15595,6 +16172,16 @@
 	lt_prog_compiler_static_GCJ='-bnso -bI:/lib/syscalls.exp'
       fi
       ;;
+      darwin*)
+        # PIC is the default on this platform
+        # Common symbols not allowed in MH_DYLIB files
+       case $cc_basename in
+         xlc*)
+         lt_prog_compiler_pic_GCJ='-qnocommon'
+         lt_prog_compiler_wl_GCJ='-Wl,'
+         ;;
+       esac
+       ;;
 
     mingw* | pw32* | os2*)
       # This hack is so that the source file can tell whether it is being
@@ -15630,12 +16217,19 @@
       ;;
 
     linux*)
-      case $CC in
+      case $cc_basename in
       icc* | ecc*)
 	lt_prog_compiler_wl_GCJ='-Wl,'
 	lt_prog_compiler_pic_GCJ='-KPIC'
 	lt_prog_compiler_static_GCJ='-static'
         ;;
+      pgcc* | pgf77* | pgf90*)
+        # Portland Group compilers (*not* the Pentium gcc compiler,
+	# which looks to be a dead project)
+	lt_prog_compiler_wl_GCJ='-Wl,'
+	lt_prog_compiler_pic_GCJ='-fpic'
+	lt_prog_compiler_static_GCJ='-static'
+        ;;
       ccc*)
         lt_prog_compiler_wl_GCJ='-Wl,'
         # All Alpha code is PIC.
@@ -15656,9 +16250,14 @@
       ;;
 
     solaris*)
-      lt_prog_compiler_wl_GCJ='-Wl,'
       lt_prog_compiler_pic_GCJ='-KPIC'
       lt_prog_compiler_static_GCJ='-Bstatic'
+      case $cc_basename in
+      f77* | f90* | f95*)
+	lt_prog_compiler_wl_GCJ='-Qoption ld ';;
+      *)
+	lt_prog_compiler_wl_GCJ='-Wl,';;
+      esac
       ;;
 
     sunos4*)
@@ -15680,6 +16279,11 @@
       fi
       ;;
 
+    unicos*)
+      lt_prog_compiler_wl_GCJ='-Wl,'
+      lt_prog_compiler_can_build_shared_GCJ=no
+      ;;
+
     uts4*)
       lt_prog_compiler_pic_GCJ='-pic'
       lt_prog_compiler_static_GCJ='-Bstatic'
@@ -15717,15 +16321,17 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:15720: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:16324: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;conftest.err)
    ac_status=$?
    cat conftest.err &gt;&amp;5
-   echo &quot;$as_me:15724: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:16328: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s &quot;$ac_outfile&quot;; then
      # The compiler can only warn and ignore the option if not recognized
-     # So say no if there are warnings
-     if test ! -s conftest.err; then
+     # So say no if there are warnings other than the usual output.
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt;conftest.exp
+     $SED '/^$/d' conftest.err &gt;conftest.er2
+     if test ! -s conftest.err || diff conftest.exp conftest.er2 &gt;/dev/null; then
        lt_prog_compiler_pic_works_GCJ=yes
      fi
    fi
@@ -15777,16 +16383,18 @@
    -e 's:.*FLAGS}? :&amp;$lt_compiler_flag :; t' \
    -e 's: [^ ]*conftest\.: $lt_compiler_flag&amp;:; t' \
    -e 's:$: $lt_compiler_flag:'`
-   (eval echo &quot;\&quot;\$as_me:15780: $lt_compile\&quot;&quot; &gt;&amp;5)
+   (eval echo &quot;\&quot;\$as_me:16386: $lt_compile\&quot;&quot; &gt;&amp;5)
    (eval &quot;$lt_compile&quot; 2&gt;out/conftest.err)
    ac_status=$?
    cat out/conftest.err &gt;&amp;5
-   echo &quot;$as_me:15784: \$? = $ac_status&quot; &gt;&amp;5
+   echo &quot;$as_me:16390: \$? = $ac_status&quot; &gt;&amp;5
    if (exit $ac_status) &amp;&amp; test -s out/conftest2.$ac_objext
    then
      # The compiler can only warn and ignore the option if not recognized
      # So say no if there are warnings
-     if test ! -s out/conftest.err; then
+     $echo &quot;X$_lt_compiler_boilerplate&quot; | $Xsed &gt; out/conftest.exp
+     $SED '/^$/d' out/conftest.err &gt;out/conftest.er2
+     if test ! -s out/conftest.err || diff out/conftest.exp out/conftest.er2 &gt;/dev/null; then
        lt_cv_prog_compiler_c_o_GCJ=yes
      fi
    fi
@@ -15866,6 +16474,16 @@
   # rely on this symbol name, it's probably fine to never include it in
   # preloaded symbol tables.
   extract_expsyms_cmds=
+  # Just being paranoid about ensuring that cc_basename is set.
+  for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
 
   case $host_os in
   cygwin* | mingw* | pw32*)
@@ -15886,6 +16504,27 @@
     # If archive_cmds runs LD, not CC, wlarc should be empty
     wlarc='${wl}'
 
+    # Set some defaults for GNU ld with shared library support. These
+    # are reset later if shared libraries are not supported. Putting them
+    # here allows them to be overridden if necessary.
+    runpath_var=LD_RUN_PATH
+    hardcode_libdir_flag_spec_GCJ='${wl}--rpath ${wl}$libdir'
+    export_dynamic_flag_spec_GCJ='${wl}--export-dynamic'
+    # ancient GNU ld didn't support --whole-archive et. al.
+    if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
+	whole_archive_flag_spec_GCJ=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
+      else
+  	whole_archive_flag_spec_GCJ=
+    fi
+    supports_anon_versioning=no
+    case `$LD -v 2&gt;/dev/null` in
+      *\ [01].* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+      *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+      *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+      *\ 2.11.*) ;; # other 2.11 versions
+      *) supports_anon_versioning=yes ;;
+    esac
+
     # See if GNU ld supports shared libraries.
     case $host_os in
     aix3* | aix4* | aix5*)
@@ -15936,7 +16575,7 @@
       allow_undefined_flag_GCJ=unsupported
       always_export_symbols_GCJ=no
       enable_shared_with_static_runtimes_GCJ=yes
-      export_symbols_cmds_GCJ='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
+      export_symbols_cmds_GCJ='$NM $libobjs $convenience | $global_symbol_pipe | $SED -e '\''/^[BCDGRS] /s/.* \([^ ]*\)/\1 DATA/'\'' | $SED -e '\''/^[AITW] /s/.* //'\'' | sort | uniq &gt; $export_symbols'
 
       if $LD --help 2&gt;&amp;1 | grep 'auto-import' &gt; /dev/null; then
         archive_cmds_GCJ='$CC -shared $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000 ${wl}--out-implib,$lib'
@@ -15950,11 +16589,42 @@
 	fi~
 	$CC -shared $output_objdir/$soname.def $libobjs $deplibs $compiler_flags -o $output_objdir/$soname ${wl}--image-base=0x10000000  ${wl}--out-implib,$lib'
       else
-	ld_shlibs=no
+	ld_shlibs_GCJ=no
       fi
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    linux*)
+      if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
+	tmp_addflag=
+	case $cc_basename,$host_cpu in
+	pgcc*)				# Portland Group C compiler
+	  whole_archive_flag_spec_GCJ='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag'
+	  ;;
+	pgf77* | pgf90* )			# Portland Group f77 and f90 compilers
+	  whole_archive_flag_spec_GCJ='${wl}--whole-archive,`for conv in $convenience\&quot;\&quot;; do test  -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}--no-whole-archive'
+	  tmp_addflag=' $pic_flag -Mnomain' ;;
+	ecc*,ia64* | icc*,ia64*)		# Intel C compiler on ia64
+	  tmp_addflag=' -i_dynamic' ;;
+	efc*,ia64* | ifort*,ia64*)	# Intel Fortran compiler on ia64
+	  tmp_addflag=' -i_dynamic -nofor_main' ;;
+	ifc* | ifort*)			# Intel Fortran compiler
+	  tmp_addflag=' -nofor_main' ;;
+	esac
+	archive_cmds_GCJ='$CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+
+	if test $supports_anon_versioning = yes; then
+	  archive_expsym_cmds_GCJ='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+  cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+  $echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+	  $CC -shared'&quot;$tmp_addflag&quot;' $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+	fi
+      else
+	ld_shlibs_GCJ=no
+      fi
+      ;;
+
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds_GCJ='$LD -Bshareable $libobjs $deplibs $linker_flags -o $lib'
 	wlarc=
@@ -15992,32 +16662,6 @@
       hardcode_shlibpath_var_GCJ=no
       ;;
 
-  linux*)
-    if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
-        tmp_archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
-	archive_cmds_GCJ=&quot;$tmp_archive_cmds&quot;
-      supports_anon_versioning=no
-      case `$LD -v 2&gt;/dev/null` in
-        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
-        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
-        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
-        *\ 2.11.*) ;; # other 2.11 versions
-        *) supports_anon_versioning=yes ;;
-      esac
-      if test $supports_anon_versioning = yes; then
-        archive_expsym_cmds_GCJ='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
-cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
-$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
-        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
-      else
-        archive_expsym_cmds_GCJ=&quot;$tmp_archive_cmds&quot;
-      fi
-      link_all_deplibs_GCJ=no
-    else
-      ld_shlibs_GCJ=no
-    fi
-    ;;
-
     *)
       if $LD --help 2&gt;&amp;1 | grep ': supported targets:.* elf' &gt; /dev/null; then
 	archive_cmds_GCJ='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
@@ -16028,16 +16672,11 @@
       ;;
     esac
 
-    if test &quot;$ld_shlibs_GCJ&quot; = yes; then
-      runpath_var=LD_RUN_PATH
-      hardcode_libdir_flag_spec_GCJ='${wl}--rpath ${wl}$libdir'
-      export_dynamic_flag_spec_GCJ='${wl}--export-dynamic'
-      # ancient GNU ld didn't support --whole-archive et. al.
-      if $LD --help 2&gt;&amp;1 | grep 'no-whole-archive' &gt; /dev/null; then
- 	whole_archive_flag_spec_GCJ=&quot;$wlarc&quot;'--whole-archive$convenience '&quot;$wlarc&quot;'--no-whole-archive'
-      else
-  	whole_archive_flag_spec_GCJ=
-      fi
+    if test &quot;$ld_shlibs_GCJ&quot; = no; then
+      runpath_var=
+      hardcode_libdir_flag_spec_GCJ=
+      export_dynamic_flag_spec_GCJ=
+      whole_archive_flag_spec_GCJ=
     fi
   else
     # PORTME fill in a description of your system's linker (not GNU ld)
@@ -16101,7 +16740,7 @@
       link_all_deplibs_GCJ=yes
 
       if test &quot;$GCC&quot; = yes; then
-	case $host_os in aix4.012|aix4.012.*)
+	case $host_os in aix4.[012]|aix4.[012].*)
 	# We only want to do this on AIX 4.2 and lower, the check
 	# below for broken collect2 doesn't work under 4.3+
 	  collect2name=`${CC} -print-prog-name=collect2`
@@ -16122,6 +16761,9 @@
 	  fi
 	esac
 	shared_flag='-shared'
+	if test &quot;$aix_use_runtimelinking&quot; = yes; then
+	  shared_flag=&quot;$shared_flag &quot;'${wl}-G'
+	fi
       else
 	# not using gcc
 	if test &quot;$host_cpu&quot; = ia64; then
@@ -16282,7 +16924,7 @@
       ld_shlibs_GCJ=no
       ;;
 
-    bsdi4*)
+    bsdi[45]*)
       export_dynamic_flag_spec_GCJ=-rdynamic
       ;;
 
@@ -16303,57 +16945,57 @@
       old_archive_From_new_cmds_GCJ='true'
       # FIXME: Should let the user specify the lib program.
       old_archive_cmds_GCJ='lib /OUT:$oldlib$oldobjs$old_deplibs'
-      fix_srcfile_path='`cygpath -w &quot;$srcfile&quot;`'
+      fix_srcfile_path_GCJ='`cygpath -w &quot;$srcfile&quot;`'
       enable_shared_with_static_runtimes_GCJ=yes
       ;;
 
     darwin* | rhapsody*)
-    if test &quot;$GXX&quot; = yes ; then
-      archive_cmds_need_lc_GCJ=no
       case &quot;$host_os&quot; in
-      rhapsody* | darwin1.[012])
-	allow_undefined_flag_GCJ='-undefined suppress'
-	;;
-      *) # Darwin 1.3 on
-      if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
-      	allow_undefined_flag_GCJ='-flat_namespace -undefined suppress'
-      else
-        case ${MACOSX_DEPLOYMENT_TARGET} in
-          10.[012])
-            allow_undefined_flag_GCJ='-flat_namespace -undefined suppress'
-            ;;
-          10.*)
-            allow_undefined_flag_GCJ='-undefined dynamic_lookup'
-            ;;
-        esac
-      fi
-	;;
+        rhapsody* | darwin1.[012])
+         allow_undefined_flag_GCJ='${wl}-undefined ${wl}suppress'
+         ;;
+       *) # Darwin 1.3 on
+         if test -z ${MACOSX_DEPLOYMENT_TARGET} ; then
+           allow_undefined_flag_GCJ='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+         else
+           case ${MACOSX_DEPLOYMENT_TARGET} in
+             10.[012])
+               allow_undefined_flag_GCJ='${wl}-flat_namespace ${wl}-undefined ${wl}suppress'
+               ;;
+             10.*)
+               allow_undefined_flag_GCJ='${wl}-undefined ${wl}dynamic_lookup'
+               ;;
+           esac
+         fi
+         ;;
       esac
-    	lt_int_apple_cc_single_mod=no
-    	output_verbose_link_cmd='echo'
-    	if $CC -dumpspecs 2&gt;&amp;1 | grep 'single_module' &gt;/dev/null ; then
-    	  lt_int_apple_cc_single_mod=yes
-    	fi
-    	if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-    	  archive_cmds_GCJ='$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-    	else
-        archive_cmds_GCJ='$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
-      fi
-      module_cmds_GCJ='$CC ${wl}-bind_at_load $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
-      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
-        if test &quot;X$lt_int_apple_cc_single_mod&quot; = Xyes ; then
-          archive_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib -single_module $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        else
-          archive_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -r ${wl}-bind_at_load -keep_private_externs -nostdlib -o ${lib}-master.o $libobjs~$CC -dynamiclib $allow_undefined_flag -o $lib ${lib}-master.o $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
-        fi
-          module_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      archive_cmds_need_lc_GCJ=no
       hardcode_direct_GCJ=no
       hardcode_automatic_GCJ=yes
       hardcode_shlibpath_var_GCJ=unsupported
-      whole_archive_flag_spec_GCJ='-all_load $convenience'
+      whole_archive_flag_spec_GCJ=''
       link_all_deplibs_GCJ=yes
+    if test &quot;$GCC&quot; = yes ; then
+    	output_verbose_link_cmd='echo'
+        archive_cmds_GCJ='$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring'
+      module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+      # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+      archive_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -dynamiclib $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags -install_name $rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+      module_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
     else
-      ld_shlibs_GCJ=no
+      case $cc_basename in
+        xlc*)
+         output_verbose_link_cmd='echo'
+         archive_cmds_GCJ='$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}`echo $rpath/$soname` $verstring'
+         module_cmds_GCJ='$CC $allow_undefined_flag -o $lib -bundle $libobjs $deplibs$compiler_flags'
+          # Don't fix this by using the ld -exported_symbols_list flag, it doesn't exist in older darwin ld's
+         archive_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC -qmkshrobj $allow_undefined_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-install_name ${wl}$rpath/$soname $verstring~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          module_expsym_cmds_GCJ='sed -e &quot;s,#.*,,&quot; -e &quot;s,^[    ]*,,&quot; -e &quot;s,^\(..*\),_&amp;,&quot; &lt; $export_symbols &gt; $output_objdir/${libname}-symbols.expsym~$CC $allow_undefined_flag  -o $lib -bundle $libobjs $deplibs$compiler_flags~nmedit -s $output_objdir/${libname}-symbols.expsym ${lib}'
+          ;;
+       *)
+         ld_shlibs_GCJ=no
+          ;;
+      esac
     fi
       ;;
 
@@ -16387,7 +17029,7 @@
       ;;
 
     # FreeBSD 3 and greater uses gcc -shared to do shared libraries.
-    freebsd* | kfreebsd*-gnu)
+    freebsd* | kfreebsd*-gnu | dragonfly*)
       archive_cmds_GCJ='$CC -shared -o $lib $libobjs $deplibs $compiler_flags'
       hardcode_libdir_flag_spec_GCJ='-R$libdir'
       hardcode_direct_GCJ=yes
@@ -16474,7 +17116,7 @@
       link_all_deplibs_GCJ=yes
       ;;
 
-    netbsd* | netbsdelf*-gnu | knetbsd*-gnu)
+    netbsd*)
       if echo __ELF__ | $CC -E - | grep __ELF__ &gt;/dev/null; then
 	archive_cmds_GCJ='$LD -Bshareable -o $lib $libobjs $deplibs $linker_flags'  # a.out
       else
@@ -16498,6 +17140,7 @@
       hardcode_shlibpath_var_GCJ=no
       if test -z &quot;`echo __ELF__ | $CC -E - | grep __ELF__`&quot; || test &quot;$host_os-$host_cpu&quot; = &quot;openbsd2.8-powerpc&quot;; then
 	archive_cmds_GCJ='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags'
+	archive_expsym_cmds_GCJ='$CC -shared $pic_flag -o $lib $libobjs $deplibs $compiler_flags ${wl}-retain-symbols-file,$export_symbols'
 	hardcode_libdir_flag_spec_GCJ='${wl}-rpath,$libdir'
 	export_dynamic_flag_spec_GCJ='${wl}-E'
       else
@@ -16543,7 +17186,7 @@
 	allow_undefined_flag_GCJ=' -expect_unresolved \*'
 	archive_cmds_GCJ='$LD -shared${allow_undefined_flag} $libobjs $deplibs $linker_flags -msym -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib'
 	archive_expsym_cmds_GCJ='for i in `cat $export_symbols`; do printf &quot;%s %s\\n&quot; -exported_symbol &quot;\$i&quot; &gt;&gt; $lib.exp; done; echo &quot;-hidden&quot;&gt;&gt; $lib.exp~
-	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${objdir}/so_locations -o $lib~$rm $lib.exp'
+	$LD -shared${allow_undefined_flag} -input $lib.exp $linker_flags $libobjs $deplibs -soname $soname `test -n &quot;$verstring&quot; &amp;&amp; echo -set_version $verstring` -update_registry ${output_objdir}/so_locations -o $lib~$rm $lib.exp'
 
 	# Both c and cxx compiler support -rpath directly
 	hardcode_libdir_flag_spec_GCJ='-rpath $libdir'
@@ -16562,10 +17205,12 @@
     solaris*)
       no_undefined_flag_GCJ=' -z text'
       if test &quot;$GCC&quot; = yes; then
+	wlarc='${wl}'
 	archive_cmds_GCJ='$CC -shared ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags'
 	archive_expsym_cmds_GCJ='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
 	  $CC -shared ${wl}-M ${wl}$lib.exp ${wl}-h ${wl}$soname -o $lib $libobjs $deplibs $compiler_flags~$rm $lib.exp'
       else
+	wlarc=''
 	archive_cmds_GCJ='$LD -G${allow_undefined_flag} -h $soname -o $lib $libobjs $deplibs $linker_flags'
 	archive_expsym_cmds_GCJ='$echo &quot;{ global:&quot; &gt; $lib.exp~cat $export_symbols | $SED -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $lib.exp~$echo &quot;local: *; };&quot; &gt;&gt; $lib.exp~
   	$LD -G${allow_undefined_flag} -M $lib.exp -h $soname -o $lib $libobjs $deplibs $linker_flags~$rm $lib.exp'
@@ -16574,8 +17219,18 @@
       hardcode_shlibpath_var_GCJ=no
       case $host_os in
       solaris2.[0-5] | solaris2.[0-5].*) ;;
-      *) # Supported since Solaris 2.6 (maybe 2.5.1?)
-	whole_archive_flag_spec_GCJ='-z allextract$convenience -z defaultextract' ;;
+      *)
+ 	# The compiler driver will combine linker options so we
+ 	# cannot just pass the convience library names through
+ 	# without $wl, iff we do not link with $LD.
+ 	# Luckily, gcc supports the same syntax we need for Sun Studio.
+ 	# Supported since Solaris 2.6 (maybe 2.5.1?)
+ 	case $wlarc in
+ 	'')
+ 	  whole_archive_flag_spec_GCJ='-z allextract$convenience -z defaultextract' ;;
+ 	*)
+ 	  whole_archive_flag_spec_GCJ='${wl}-z ${wl}allextract`for conv in $convenience\&quot;\&quot;; do test -n \&quot;$conv\&quot; &amp;&amp; new_convenience=\&quot;$new_convenience,$conv\&quot;; done; $echo \&quot;$new_convenience\&quot;` ${wl}-z ${wl}defaultextract' ;;
+ 	esac ;;
       esac
       link_all_deplibs_GCJ=yes
       ;;
@@ -16849,7 +17504,7 @@
   shlibpath_var=LIBRARY_PATH
   ;;
 
-bsdi4*)
+bsdi[45]*)
   version_type=linux
   need_version=no
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major $libname${shared_ext}'
@@ -16907,11 +17562,35 @@
       ;;
     pw32*)
       # pw32 DLLs use 'pw' prefix rather than 'lib'
-      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/./-/g'`${versuffix}${shared_ext}'
+      library_names_spec='`echo ${libname} | sed -e 's/^lib/pw/'``echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext}'
       ;;
     esac
     ;;
 
+  linux*)
+    if $LD --help 2&gt;&amp;1 | egrep ': supported targets:.* elf' &gt; /dev/null; then
+      archive_cmds='$CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname -o $lib'
+      supports_anon_versioning=no
+      case `$LD -v 2&gt;/dev/null` in
+        *\ 01.* | *\ 2.[0-9].* | *\ 2.10.*) ;; # catch versions &lt; 2.11
+        *\ 2.11.93.0.2\ *) supports_anon_versioning=yes ;; # RH7.3 ...
+        *\ 2.11.92.0.12\ *) supports_anon_versioning=yes ;; # Mandrake 8.2 ...
+        *\ 2.11.*) ;; # other 2.11 versions
+        *) supports_anon_versioning=yes ;;
+      esac
+      if test $supports_anon_versioning = yes; then
+        archive_expsym_cmds='$echo &quot;{ global:&quot; &gt; $output_objdir/$libname.ver~
+cat $export_symbols | sed -e &quot;s/\(.*\)/\1;/&quot; &gt;&gt; $output_objdir/$libname.ver~
+$echo &quot;local: *; };&quot; &gt;&gt; $output_objdir/$libname.ver~
+        $CC -shared $libobjs $deplibs $compiler_flags ${wl}-soname $wl$soname ${wl}-version-script ${wl}$output_objdir/$libname.ver -o $lib'
+      else
+        $archive_expsym_cmds=&quot;$archive_cmds&quot;
+      fi
+    else
+      ld_shlibs=no
+    fi
+    ;;
+
   *)
     library_names_spec='${libname}`echo ${release} | $SED -e 's/[.]/-/g'`${versuffix}${shared_ext} $libname.lib'
     ;;
@@ -16965,7 +17644,9 @@
   dynamic_linker='GNU ld.so'
   ;;
 
-freebsd*)
+freebsd* | dragonfly*)
+  # DragonFly does not have aout.  When/if they implement a new
+  # versioning mechanism, adjust this.
   objformat=`test -x /usr/bin/objformat &amp;&amp; /usr/bin/objformat || echo aout`
   version_type=freebsd-$objformat
   case $version_type in
@@ -16984,7 +17665,7 @@
   freebsd2*)
     shlibpath_overrides_runpath=yes
     ;;
-  freebsd3.01* | freebsdelf3.01*)
+  freebsd3.[01]* | freebsdelf3.[01]*)
     shlibpath_overrides_runpath=yes
     hardcode_into_libs=yes
     ;;
@@ -17110,10 +17791,17 @@
 
   # Append ld.so.conf contents to the search path
   if test -f /etc/ld.so.conf; then
-    lt_ld_extra=`$SED -e 's/:,\t/ /g;s/=^=*$//;s/=^= * / /g' /etc/ld.so.conf | tr '\n' ' '`
+    lt_ld_extra=`awk '/^include / { system(sprintf(&quot;cd /etc; cat %s&quot;, \$2)); skip = 1; } { if (!skip) print \$0; skip = 0; }' &lt; /etc/ld.so.conf | $SED -e 's/#.*//;s/[:,	]/ /g;s/=[^=]*$//;s/=[^= ]* / /g;/^$/d' | tr '\n' ' '`
     sys_lib_dlsearch_path_spec=&quot;/lib /usr/lib $lt_ld_extra&quot;
   fi
 
+  case $host_cpu:$lt_cv_cc_64bit_output in
+  powerpc64:yes | s390x:yes | sparc64:yes | x86_64:yes)
+    sys_lib_dlsearch_path_spec=&quot;/lib64 /usr/lib64 /usr/X11R6/lib64&quot;
+    sys_lib_search_path_spec=&quot;/lib64 /usr/lib64 /usr/local/lib64 /usr/X11R6/lib64&quot;
+    ;;
+  esac
+
   # We used to test for /lib/ld.so.1 and disable shared libraries on
   # powerpc, because MkLinux only supported shared libraries with the
   # GNU dynamic linker.  Since this was broken with cross compilers,
@@ -17121,18 +17809,30 @@
   # people can always --disable-shared, the test was removed, and we
   # assume the GNU/Linux dynamic linker is in use.
   dynamic_linker='GNU/Linux ld.so'
-  ;;
 
-netbsdelf*-gnu)
-  version_type=linux
-  need_lib_prefix=no
-  need_version=no
-  library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${release}${shared_ext}$major ${libname}${shared_ext}'
-  soname_spec='${libname}${release}${shared_ext}$major'
-  shlibpath_var=LD_LIBRARY_PATH
-  shlibpath_overrides_runpath=no
-  hardcode_into_libs=yes
-  dynamic_linker='NetBSD ld.elf_so'
+  # Find out which ABI we are using (multilib Linux x86_64 hack).
+  libsuff=
+  case &quot;$host_cpu&quot; in
+  x86_64*)
+    echo '#line 17817 &quot;configure&quot;' &gt; conftest.$ac_ext
+    if { (eval echo &quot;$as_me:$LINENO: \&quot;$ac_compile\&quot;&quot;) &gt;&amp;5
+  (eval $ac_compile) 2&gt;&amp;5
+  ac_status=$?
+  echo &quot;$as_me:$LINENO: \$? = $ac_status&quot; &gt;&amp;5
+  (exit $ac_status); }; then
+      case `/usr/bin/file conftest.$ac_objext` in
+      *64-bit*)
+        libsuff=64
+        ;;
+      esac
+    fi
+    rm -rf conftest*
+    ;;
+  *)
+    ;;
+  esac
+  sys_lib_dlsearch_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff}&quot;
+  sys_lib_search_path_spec=&quot;/lib${libsuff} /usr/lib${libsuff} /usr/local/lib${libsuff}&quot;
   ;;
 
 knetbsd*-gnu)
@@ -17185,7 +17885,11 @@
 openbsd*)
   version_type=sunos
   need_lib_prefix=no
-  need_version=yes
+  # Some older versions of OpenBSD (3.3 at least) *do* need versioned libs.
+  case $host_os in
+    openbsd3.3 | openbsd3.3.*) need_version=yes ;;
+    *)                         need_version=no  ;;
+  esac
   library_names_spec='${libname}${release}${shared_ext}$versuffix ${libname}${shared_ext}$versuffix'
   finish_cmds='PATH=&quot;\$PATH:/sbin&quot; ldconfig -m $libdir'
   shlibpath_var=LD_LIBRARY_PATH
@@ -17307,8 +18011,8 @@
 echo $ECHO_N &quot;checking how to hardcode library paths into programs... $ECHO_C&quot; &gt;&amp;6
 hardcode_action_GCJ=
 if test -n &quot;$hardcode_libdir_flag_spec_GCJ&quot; || \
-   test -n &quot;$runpath_var GCJ&quot; || \
-   test &quot;X$hardcode_automatic_GCJ&quot;=&quot;Xyes&quot; ; then
+   test -n &quot;$runpath_var_GCJ&quot; || \
+   test &quot;X$hardcode_automatic_GCJ&quot; = &quot;Xyes&quot; ; then
 
   # We can hardcode non-existant directories.
   if test &quot;$hardcode_direct_GCJ&quot; != no &amp;&amp;
@@ -17974,7 +18678,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 17977 &quot;configure&quot;
+#line 18681 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -18072,7 +18776,7 @@
   lt_dlunknown=0; lt_dlno_uscore=1; lt_dlneed_uscore=2
   lt_status=$lt_dlunknown
   cat &gt; conftest.$ac_ext &lt;&lt;EOF
-#line 18075 &quot;configure&quot;
+#line 18779 &quot;configure&quot;
 #include &quot;confdefs.h&quot;
 
 #if HAVE_DLFCN_H
@@ -18290,7 +18994,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -18366,7 +19076,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_GCJ
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?
@@ -18614,11 +19324,35 @@
 compiler=$CC
 
 
+# save warnings/boilerplate of simple test code
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_compile_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_compile&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_compiler_boilerplate=`cat conftest.err`
+$rm conftest*
+
+ac_outfile=conftest.$ac_objext
+printf &quot;$lt_simple_link_test_code&quot; &gt;conftest.$ac_ext
+eval &quot;$ac_link&quot; 2&gt;&amp;1 &gt;/dev/null | $SED '/^$/d' &gt;conftest.err
+_lt_linker_boilerplate=`cat conftest.err`
+$rm conftest*
+
+
 # Allow CC to be a program name with arguments.
 lt_save_CC=&quot;$CC&quot;
 CC=${RC-&quot;windres&quot;}
 compiler=$CC
 compiler_RC=$CC
+for cc_temp in $compiler&quot;&quot;; do
+  case $cc_temp in
+    compile | *[\\/]compile | ccache | *[\\/]ccache ) ;;
+    distcc | *[\\/]distcc | purify | *[\\/]purify ) ;;
+    \-*) ;;
+    *) break;;
+  esac
+done
+cc_basename=`$echo &quot;X$cc_temp&quot; | $Xsed -e 's%.*/%%' -e &quot;s%^$host_alias-%%&quot;`
+
 lt_cv_prog_compiler_c_o_RC=yes
 
 # The else clause should only fire when bootstrapping the
@@ -18735,7 +19469,13 @@
 # The host system.
 host_alias=$host_alias
 host=$host
+host_os=$host_os
 
+# The build system.
+build_alias=$build_alias
+build=$build
+build_os=$build_os
+
 # An echo program that does not interpret backslashes.
 echo=$lt_echo
 
@@ -18811,7 +19551,7 @@
 # Does compiler simultaneously support -c and -o options?
 compiler_c_o=$lt_lt_cv_prog_compiler_c_o_RC
 
-# Must we lock files when doing compilation ?
+# Must we lock files when doing compilation?
 need_locks=$lt_need_locks
 
 # Do we need the lib prefix for modules?

Modified: branches/mloskot-style-refactoring/ltmain.sh
===================================================================
--- branches/mloskot-style-refactoring/ltmain.sh	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/ltmain.sh	2005-11-11 18:07:47 UTC (rev 227)
@@ -1,7 +1,7 @@
 # ltmain.sh - Provide generalized library-building support services.
 # NOTE: Changing this file will not affect anything until you rerun configure.
 #
-# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005
 # Free Software Foundation, Inc.
 # Originally by Gordon Matzigkeit &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/openspace-svn">gord at gnu.ai.mit.edu</A>&gt;, 1996
 #
@@ -17,7 +17,7 @@
 #
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.
 #
 # As a special exception to the GNU General Public License, if you
 # distribute this file as part of a program that contains a
@@ -33,6 +33,9 @@
 # function.
 progpath=&quot;$0&quot;
 
+# define SED for historic ltconfig's generated by Libtool 1.3
+test -z &quot;$SED&quot; &amp;&amp; SED=sed
+
 # The name of this program:
 progname=`echo &quot;$progpath&quot; | $SED $basename`
 modename=&quot;$progname&quot;
@@ -43,9 +46,21 @@
 
 PROGRAM=ltmain.sh
 PACKAGE=libtool
-VERSION=1.5.6
-TIMESTAMP=&quot; (1.1220.2.95 2004/04/11 05:50:42) Debian$Rev: 224 $&quot;
+VERSION=1.5.18
+TIMESTAMP=&quot; (1.1220.2.246 2005/05/16 10:00:18)&quot;
 
+# See if we are running on zsh, and set the options which allow our
+# commands through without removal of \ escapes.
+if test -n &quot;${ZSH_VERSION+set}&quot; ; then
+  setopt NO_GLOB_SUBST
+fi
+# Same for EGREP, and just to be sure, do LTCC as well
+if test &quot;X$EGREP&quot; = X ; then
+    EGREP=egrep
+fi
+if test &quot;X$LTCC&quot; = X ; then
+    LTCC=${CC-gcc}
+fi
 
 # Check that we have a working $echo.
 if test &quot;X$1&quot; = X--no-reexec; then
@@ -107,8 +122,9 @@
 fi
 
 # Make sure IFS has a sensible default
-: ${IFS=&quot; 	
-&quot;}
+lt_nl='
+'
+IFS=&quot; 	$lt_nl&quot;
 
 if test &quot;$build_libtool_libs&quot; != yes &amp;&amp; test &quot;$build_old_libs&quot; != yes; then
   $echo &quot;$modename: not configured to build any kind of library&quot; 1&gt;&amp;2
@@ -127,7 +143,32 @@
 execute_dlfiles=
 lo2o=&quot;s/\\.lo\$/.${objext}/&quot;
 o2lo=&quot;s/\\.${objext}\$/.lo/&quot;
+quote_scanset='[[~#^*{};&lt;&gt;?'&quot;'&quot;' 	]'
 
+if test -z &quot;$max_cmd_len&quot;; then
+  i=0
+  testring=&quot;ABCD&quot;
+  new_result=
+  
+  # If test is not a shell built-in, we'll probably end up computing a
+  # maximum length that is only half of the actual maximum length, but
+  # we can't tell.
+  while (test &quot;X&quot;`$SHELL $0 --fallback-echo &quot;X$testring&quot; 2&gt;/dev/null` \
+             = &quot;XX$testring&quot;) &gt;/dev/null 2&gt;&amp;1 &amp;&amp;
+          new_result=`expr &quot;X$testring&quot; : &quot;.*&quot; 2&gt;&amp;1` &amp;&amp;
+          max_cmd_len=&quot;$new_result&quot; &amp;&amp;
+          test &quot;$i&quot; != 17 # 1/2 MB should be enough
+  do
+    i=`expr $i + 1`
+    testring=&quot;$testring$testring&quot;
+  done
+  testring=
+  # Add a significant safety factor because C++ compilers can tack on massive
+  # amounts of additional arguments before passing them to the linker.
+  # It appears as though 1/2 is a usable value.
+  max_cmd_len=`expr $max_cmd_len \/ 2`
+fi
+
 #####################################
 # Shell function definitions:
 # This seems to be the best place for them
@@ -138,7 +179,8 @@
 # Need a lot of goo to handle *both* DLLs and import libs
 # Has to be a shell function in order to 'eat' the argument
 # that is supplied when $file_magic_command is called.
-func_win32_libid () {
+func_win32_libid ()
+{
   win32_libid_type=&quot;unknown&quot;
   win32_fileres=`file -L $1 2&gt;/dev/null`
   case $win32_fileres in
@@ -178,12 +220,13 @@
 # Only attempt this if the compiler in the base compile
 # command doesn't match the default compiler.
 # arg is usually of the form 'gcc ...'
-func_infer_tag () {
+func_infer_tag ()
+{
     if test -n &quot;$available_tags&quot; &amp;&amp; test -z &quot;$tagname&quot;; then
       CC_quoted=
       for arg in $CC; do
 	case $arg in
-	  *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	  *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	  arg=&quot;\&quot;$arg\&quot;&quot;
 	  ;;
 	esac
@@ -204,13 +247,23 @@
 	    for arg in $CC; do
 	    # Double-quote args containing other shell metacharacters.
 	    case $arg in
-	      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	      arg=&quot;\&quot;$arg\&quot;&quot;
 	      ;;
 	    esac
 	    CC_quoted=&quot;$CC_quoted $arg&quot;
 	  done
+	    # user sometimes does CC=&lt;HOST&gt;-gcc so we need to match that to 'gcc'
+	    trimedcc=`echo ${CC} | $SED -e &quot;s/${host}-//g&quot;`
+	    # and sometimes libtool has CC=&lt;HOST&gt;-gcc but user does CC=gcc
+	    extendcc=${host}-${CC}
 	    case &quot;$@ &quot; in
+	      &quot;cc &quot;* | &quot; cc &quot;* | &quot;${host}-cc &quot;* | &quot; ${host}-cc &quot;*|\
+	      &quot;gcc &quot;* | &quot; gcc &quot;* | &quot;${host}-gcc &quot;* | &quot; ${host}-gcc &quot;*)
+	      tagname=CC
+	      break ;;
+	      &quot;$trimedcc &quot;* | &quot; $trimedcc &quot;* | &quot;`$echo $trimedcc` &quot;* | &quot; `$echo $trimedcc` &quot;*|\
+	      &quot;$extendcc &quot;* | &quot; $extendcc &quot;* | &quot;`$echo $extendcc` &quot;* | &quot; `$echo $extendcc` &quot;*|\
 	      &quot; $CC &quot;* | &quot;$CC &quot;* | &quot; `$echo $CC` &quot;* | &quot;`$echo $CC` &quot;* | &quot; $CC_quoted&quot;* | &quot;$CC_quoted &quot;* | &quot; `$echo $CC_quoted` &quot;* | &quot;`$echo $CC_quoted` &quot;*)
 	      # The compiler in the base compile command matches
 	      # the one in the tagged configuration.
@@ -235,6 +288,108 @@
       esac
     fi
 }
+
+
+# func_extract_an_archive dir oldlib
+func_extract_an_archive ()
+{
+    f_ex_an_ar_dir=&quot;$1&quot;; shift
+    f_ex_an_ar_oldlib=&quot;$1&quot;
+
+    $show &quot;(cd $f_ex_an_ar_dir &amp;&amp; $AR x $f_ex_an_ar_oldlib)&quot;
+    $run eval &quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \$f_ex_an_ar_oldlib)&quot; || exit $?
+    if ($AR t &quot;$f_ex_an_ar_oldlib&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+     :
+    else
+      $echo &quot;$modename: ERROR: object name conflicts: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib&quot; 1&gt;&amp;2
+      exit $EXIT_FAILURE
+    fi
+}
+
+# func_extract_archives gentop oldlib ...
+func_extract_archives ()
+{
+    my_gentop=&quot;$1&quot;; shift
+    my_oldlibs=${1+&quot;$@&quot;}
+    my_oldobjs=&quot;&quot;
+    my_xlib=&quot;&quot;
+    my_xabs=&quot;&quot;
+    my_xdir=&quot;&quot;
+    my_status=&quot;&quot;
+
+    $show &quot;${rm}r $my_gentop&quot;
+    $run ${rm}r &quot;$my_gentop&quot;
+    $show &quot;$mkdir $my_gentop&quot;
+    $run $mkdir &quot;$my_gentop&quot;
+    my_status=$?
+    if test &quot;$my_status&quot; -ne 0 &amp;&amp; test ! -d &quot;$my_gentop&quot;; then
+      exit $my_status
+    fi
+
+    for my_xlib in $my_oldlibs; do
+      # Extract the objects.
+      case $my_xlib in
+	[\\/]* | [A-Za-z]:[\\/]*) my_xabs=&quot;$my_xlib&quot; ;;
+	*) my_xabs=`pwd`&quot;/$my_xlib&quot; ;;
+      esac
+      my_xlib=`$echo &quot;X$my_xlib&quot; | $Xsed -e 's%^.*/%%'`
+      my_xdir=&quot;$my_gentop/$my_xlib&quot;
+
+      $show &quot;${rm}r $my_xdir&quot;
+      $run ${rm}r &quot;$my_xdir&quot;
+      $show &quot;$mkdir $my_xdir&quot;
+      $run $mkdir &quot;$my_xdir&quot;
+      status=$?
+      if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$my_xdir&quot;; then
+	exit $status
+      fi
+      case $host in
+      *-darwin*)
+	$show &quot;Extracting $my_xabs&quot;
+	# Do not bother doing anything if just a dry run
+	if test -z &quot;$run&quot;; then
+	  darwin_orig_dir=`pwd`
+	  cd $my_xdir || exit $?
+	  darwin_archive=$my_xabs
+	  darwin_curdir=`pwd`
+	  darwin_base_archive=`$echo &quot;X$darwin_archive&quot; | $Xsed -e 's%^.*/%%'`
+	  darwin_arches=`lipo -info &quot;$darwin_archive&quot; 2&gt;/dev/null | $EGREP Architectures 2&gt;/dev/null`
+	  if test -n &quot;$darwin_arches&quot;; then 
+	    darwin_arches=`echo &quot;$darwin_arches&quot; | $SED -e 's/.*<A HREF="are://">are://</A>'`
+	    darwin_arch=
+	    $show &quot;$darwin_base_archive has multiple architectures $darwin_arches&quot;
+	    for darwin_arch in  $darwin_arches ; do
+	      mkdir -p &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;
+	      lipo -thin $darwin_arch -output &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot; &quot;${darwin_archive}&quot;
+	      cd &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;
+	      func_extract_an_archive &quot;`pwd`&quot; &quot;${darwin_base_archive}&quot;
+	      cd &quot;$darwin_curdir&quot;
+	      $rm &quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;
+	    done # $darwin_arches
+      ## Okay now we have a bunch of thin objects, gotta fatten them up :)
+	    darwin_filelist=`find unfat-$$ -type f -name \*.o -print -o -name \*.lo -print| xargs basename | sort -u | $NL2SP`
+	    darwin_file=
+	    darwin_files=
+	    for darwin_file in $darwin_filelist; do
+	      darwin_files=`find unfat-$$ -name $darwin_file -print | $NL2SP`
+	      lipo -create -output &quot;$darwin_file&quot; $darwin_files
+	    done # $darwin_filelist
+	    ${rm}r unfat-$$
+	    cd &quot;$darwin_orig_dir&quot;
+	  else
+	    cd &quot;$darwin_orig_dir&quot;
+ 	    func_extract_an_archive &quot;$my_xdir&quot; &quot;$my_xabs&quot;
+	  fi # $darwin_arches
+	fi # $run
+      ;;
+      *)
+        func_extract_an_archive &quot;$my_xdir&quot; &quot;$my_xabs&quot;
+        ;;
+      esac
+      my_oldobjs=&quot;$my_oldobjs &quot;`find $my_xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
+    done
+    func_extract_archives_result=&quot;$my_oldobjs&quot;
+}
 # End of Shell function definitions
 #####################################
 
@@ -305,10 +460,10 @@
   --version)
     $echo &quot;$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP&quot;
     $echo
-    $echo &quot;Copyright (C) 2003  Free Software Foundation, Inc.&quot;
+    $echo &quot;Copyright (C) 2005  Free Software Foundation, Inc.&quot;
     $echo &quot;This is free software; see the source for copying conditions.  There is NO&quot;
     $echo &quot;warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;
-    exit $EXIT_SUCCESS
+    exit $?
     ;;
 
   --config)
@@ -317,7 +472,7 @@
     for tagname in $taglist; do
       ${SED} -n -e &quot;/^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$/,/^# ### END LIBTOOL TAG CONFIG: $tagname$/p&quot; &lt; &quot;$progpath&quot;
     done
-    exit $EXIT_SUCCESS
+    exit $?
     ;;
 
   --debug)
@@ -342,7 +497,7 @@
     else
       $echo &quot;disable static libraries&quot;
     fi
-    exit $EXIT_SUCCESS
+    exit $?
     ;;
 
   --finish) mode=&quot;finish&quot; ;;
@@ -399,7 +554,7 @@
   # Infer the operation mode.
   if test -z &quot;$mode&quot;; then
     $echo &quot;*** Warning: inferring the mode of operation is deprecated.&quot; 1&gt;&amp;2
-    $echo &quot;*** Future versions of Libtool will require -mode=MODE be specified.&quot; 1&gt;&amp;2
+    $echo &quot;*** Future versions of Libtool will require --mode=MODE be specified.&quot; 1&gt;&amp;2
     case $nonopt in
     *cc | cc* | *++ | gcc* | *-gcc* | g++* | xlc*)
       mode=link
@@ -516,7 +671,7 @@
 	    # Many Bourne shells cannot handle close brackets correctly
 	    # in scan sets, so we specify it separately.
 	    case $arg in
-	      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	      arg=&quot;\&quot;$arg\&quot;&quot;
 	      ;;
 	    esac
@@ -547,8 +702,11 @@
       case $lastarg in
       # Double-quote args containing other shell metacharacters.
       # Many Bourne shells cannot handle close brackets correctly
-      # in scan sets, so we specify it separately.
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+      # in scan sets, and some SunOS ksh mistreat backslash-escaping
+      # in scan sets (worked around with variable expansion),
+      # and furthermore cannot handle '|' '&amp;' '(' ')' in scan sets 
+      # at all, so we specify them separately.
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	lastarg=&quot;\&quot;$lastarg\&quot;&quot;
 	;;
       esac
@@ -621,6 +779,15 @@
       esac
     done
 
+    qlibobj=`$echo &quot;X$libobj&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+    case $qlibobj in
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
+	qlibobj=&quot;\&quot;$qlibobj\&quot;&quot; ;;
+    esac
+    if test &quot;X$libobj&quot; != &quot;X$qlibobj&quot;; then
+	$echo &quot;$modename: libobj name \`$libobj' may not contain shell special characters.&quot;
+	exit $EXIT_FAILURE
+    fi
     objname=`$echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'`
     xdir=`$echo &quot;X$obj&quot; | $Xsed -e 's%/[^/]*$%%'`
     if test &quot;X$xdir&quot; = &quot;X$obj&quot;; then
@@ -673,7 +840,7 @@
     # Lock this critical section if it is needed
     # We use this script file to make the link, it avoids creating a new file
     if test &quot;$need_locks&quot; = yes; then
-      until $run ln &quot;$progpath&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
+      until $run ln &quot;$srcfile&quot; &quot;$lockfile&quot; 2&gt;/dev/null; do
 	$show &quot;Waiting for $lockfile to be removed&quot;
 	sleep 2
       done
@@ -693,12 +860,17 @@
 	$run $rm $removelist
 	exit $EXIT_FAILURE
       fi
-      $echo $srcfile &gt; &quot;$lockfile&quot;
+      $echo &quot;$srcfile&quot; &gt; &quot;$lockfile&quot;
     fi
 
     if test -n &quot;$fix_srcfile_path&quot;; then
       eval srcfile=\&quot;$fix_srcfile_path\&quot;
     fi
+    qsrcfile=`$echo &quot;X$srcfile&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
+    case $qsrcfile in
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
+      qsrcfile=&quot;\&quot;$qsrcfile\&quot;&quot; ;;
+    esac
 
     $run $rm &quot;$libobj&quot; &quot;${libobj}T&quot;
 
@@ -720,10 +892,10 @@
       fbsd_hideous_sh_bug=$base_compile
 
       if test &quot;$pic_mode&quot; != no; then
-	command=&quot;$base_compile $srcfile $pic_flag&quot;
+	command=&quot;$base_compile $qsrcfile $pic_flag&quot;
       else
 	# Don't build PIC code
-	command=&quot;$base_compile $srcfile&quot;
+	command=&quot;$base_compile $qsrcfile&quot;
       fi
 
       if test ! -d &quot;${xdir}$objdir&quot;; then
@@ -803,9 +975,9 @@
     if test &quot;$build_old_libs&quot; = yes; then
       if test &quot;$pic_mode&quot; != yes; then
 	# Don't build PIC code
-	command=&quot;$base_compile $srcfile&quot;
+	command=&quot;$base_compile $qsrcfile&quot;
       else
-	command=&quot;$base_compile $srcfile $pic_flag&quot;
+	command=&quot;$base_compile $qsrcfile $pic_flag&quot;
       fi
       if test &quot;$compiler_c_o&quot; = yes; then
 	command=&quot;$command -o $obj&quot;
@@ -983,7 +1155,7 @@
       arg=&quot;$1&quot;
       shift
       case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	qarg=\&quot;`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`\&quot; ### testsuite: skip nested quoting test
 	;;
       *) qarg=$arg ;;
@@ -1227,6 +1399,13 @@
 	  prev=
 	  continue
 	  ;;
+        darwin_framework)
+	  compiler_flags=&quot;$compiler_flags $arg&quot;
+	  compile_command=&quot;$compile_command $arg&quot;
+	  finalize_command=&quot;$finalize_command $arg&quot;
+	  prev=
+	  continue
+	  ;;
 	*)
 	  eval &quot;$prev=\&quot;\$arg\&quot;&quot;
 	  prev=
@@ -1285,6 +1464,14 @@
 	continue
 	;;
 
+      -framework)
+        prev=darwin_framework
+        compiler_flags=&quot;$compiler_flags $arg&quot;
+	compile_command=&quot;$compile_command $arg&quot;
+	finalize_command=&quot;$finalize_command $arg&quot;
+        continue
+        ;;
+
       -inst-prefix-dir)
 	prev=inst_prefix
 	continue
@@ -1345,7 +1532,7 @@
 	    # These systems don't actually have a C library (as such)
 	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
 	    ;;
-	  *-*-openbsd* | *-*-freebsd*)
+	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
 	    # Do not include libc due to us having libc/libc_r.
 	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
 	    ;;
@@ -1356,7 +1543,7 @@
 	  esac
 	elif test &quot;X$arg&quot; = &quot;X-lc_r&quot;; then
 	 case $host in
-	 *-*-openbsd* | *-*-freebsd*)
+	 *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
 	   # Do not include libc_r directly, use -pthread flag.
 	   continue
 	   ;;
@@ -1366,8 +1553,20 @@
 	continue
 	;;
 
+      # Tru64 UNIX uses -model [arg] to determine the layout of C++
+      # classes, name mangling, and exception handling.
+      -model)
+	compile_command=&quot;$compile_command $arg&quot;
+	compiler_flags=&quot;$compiler_flags $arg&quot;
+	finalize_command=&quot;$finalize_command $arg&quot;
+	prev=xcompiler
+	continue
+	;;
+
      -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe)
-	deplibs=&quot;$deplibs $arg&quot;
+	compiler_flags=&quot;$compiler_flags $arg&quot;
+	compile_command=&quot;$compile_command $arg&quot;
+	finalize_command=&quot;$finalize_command $arg&quot;
 	continue
 	;;
 
@@ -1376,18 +1575,19 @@
 	continue
 	;;
 
-      # gcc -m* arguments should be passed to the linker via $compiler_flags
-      # in order to pass architecture information to the linker
-      # (e.g. 32 vs 64-bit).  This may also be accomplished via -Wl,-mfoo
-      # but this is not reliable with gcc because gcc may use -mfoo to
-      # select a different linker, different libraries, etc, while
-      # -Wl,-mfoo simply passes -mfoo to the linker.
-      -m*)
+      # -64, -mips[0-9] enable 64-bit mode on the SGI compiler
+      # -r[0-9][0-9]* specifies the processor on the SGI compiler
+      # -xarch=*, -xtarget=* enable 64-bit mode on the Sun compiler
+      # +DA*, +DD* enable 64-bit mode on the HP compiler
+      # -q* pass through compiler args for the IBM compiler
+      # -m* pass through architecture-specific compiler args for GCC
+      -64|-mips[0-9]|-r[0-9][0-9]*|-xarch=*|-xtarget=*|+DA*|+DD*|-q*|-m*)
+
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
 	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
 	case $arg in
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	*$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	  arg=&quot;\&quot;$arg\&quot;&quot;
 	  ;;
 	esac
@@ -1503,7 +1703,7 @@
 	for flag in $args; do
 	  IFS=&quot;$save_ifs&quot;
 	  case $flag in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	    *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	    flag=&quot;\&quot;$flag\&quot;&quot;
 	    ;;
 	  esac
@@ -1521,7 +1721,7 @@
 	for flag in $args; do
 	  IFS=&quot;$save_ifs&quot;
 	  case $flag in
-	    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	    *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	    flag=&quot;\&quot;$flag\&quot;&quot;
 	    ;;
 	  esac
@@ -1548,13 +1748,18 @@
 	continue
 	;;
 
+      -Kthread | -mthreads | -mt | -pthread | -pthreads | -threads | -qthreaded | -kthread )
+        compiler_flags=&quot;$compiler_flags $arg&quot;
+        continue
+        ;;
+
       # Some other compiler flag.
       -* | +*)
 	# Unknown arguments in both finalize_command and compile_command need
 	# to be aesthetically quoted because they are evaled later.
 	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
 	case $arg in
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	*$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	  arg=&quot;\&quot;$arg\&quot;&quot;
 	  ;;
 	esac
@@ -1688,7 +1893,7 @@
 	# to be aesthetically quoted because they are evaled later.
 	arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
 	case $arg in
-	*[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*|&quot;&quot;)
+	*$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	  arg=&quot;\&quot;$arg\&quot;&quot;
 	  ;;
 	esac
@@ -1838,10 +2043,7 @@
 	case $pass in
 	dlopen) libs=&quot;$dlfiles&quot; ;;
 	dlpreopen) libs=&quot;$dlprefiles&quot; ;;
-	link)
-	  libs=&quot;$deplibs %DEPLIBS%&quot;
-	  test &quot;X$link_all_deplibs&quot; != Xno &amp;&amp; libs=&quot;$libs $dependency_libs&quot;
-	  ;;
+	link) libs=&quot;$deplibs %DEPLIBS% $dependency_libs&quot; ;;
 	esac
       fi
       if test &quot;$pass&quot; = dlopen; then
@@ -1858,7 +2060,7 @@
 	    compile_deplibs=&quot;$deplib $compile_deplibs&quot;
 	    finalize_deplibs=&quot;$deplib $finalize_deplibs&quot;
 	  else
-	    deplibs=&quot;$deplib $deplibs&quot;
+	    compiler_flags=&quot;$compiler_flags $deplib&quot;
 	  fi
 	  continue
 	  ;;
@@ -1977,7 +2179,22 @@
 	  fi
 	  case $linkmode in
 	  lib)
-	    if test &quot;$deplibs_check_method&quot; != pass_all; then
+	    valid_a_lib=no
+	    case $deplibs_check_method in
+	      match_pattern*)
+		set dummy $deplibs_check_method
+	        match_pattern_regex=`expr &quot;$deplibs_check_method&quot; : &quot;$2 \(.*\)&quot;`
+		if eval $echo \&quot;$deplib\&quot; 2&gt;/dev/null \
+		    | $SED 10q \
+		    | $EGREP &quot;$match_pattern_regex&quot; &gt; /dev/null; then
+		  valid_a_lib=yes
+		fi
+		;;
+	      pass_all)
+		valid_a_lib=yes
+		;;
+            esac
+	    if test &quot;$valid_a_lib&quot; != yes; then
 	      $echo
 	      $echo &quot;*** Warning: Trying to link with static lib archive $deplib.&quot;
 	      $echo &quot;*** I have the capability to make that library automatically link in when&quot;
@@ -2051,7 +2268,9 @@
 	# it will not redefine variables installed, or shouldnotlink
 	installed=yes
 	shouldnotlink=no
+	avoidtemprpath=
 
+
 	# Read the .la file
 	case $lib in
 	*/* | *\\*) . $lib ;;
@@ -2149,11 +2368,19 @@
 	    dir=&quot;$libdir&quot;
 	    absdir=&quot;$libdir&quot;
 	  fi
+	  test &quot;X$hardcode_automatic&quot; = Xyes &amp;&amp; avoidtemprpath=yes
 	else
-	  dir=&quot;$ladir/$objdir&quot;
-	  absdir=&quot;$abs_ladir/$objdir&quot;
-	  # Remove this search path later
-	  notinst_path=&quot;$notinst_path $abs_ladir&quot;
+	  if test ! -f &quot;$ladir/$objdir/$linklib&quot; &amp;&amp; test -f &quot;$abs_ladir/$linklib&quot;; then
+	    dir=&quot;$ladir&quot;
+	    absdir=&quot;$abs_ladir&quot;
+	    # Remove this search path later
+	    notinst_path=&quot;$notinst_path $abs_ladir&quot;
+	  else
+	    dir=&quot;$ladir/$objdir&quot;
+	    absdir=&quot;$abs_ladir/$objdir&quot;
+	    # Remove this search path later
+	    notinst_path=&quot;$notinst_path $abs_ladir&quot;
+	  fi
 	fi # $installed = yes
 	name=`$echo &quot;X$laname&quot; | $Xsed -e 's/\.la$//' -e 's/^lib//'`
 
@@ -2226,7 +2453,7 @@
 	  if test -n &quot;$library_names&quot; &amp;&amp;
 	     { test &quot;$prefer_static_libs&quot; = no || test -z &quot;$old_library&quot;; }; then
 	    # We need to hardcode the library path
-	    if test -n &quot;$shlibpath_var&quot;; then
+	    if test -n &quot;$shlibpath_var&quot; &amp;&amp; test -z &quot;$avoidtemprpath&quot; ; then
 	      # Make sure the rpath contains only unique directories.
 	      case &quot;$temp_rpath &quot; in
 	      *&quot; $dir &quot;*) ;;
@@ -2670,13 +2897,13 @@
 	      *) continue ;;
 	      esac
 	      case &quot; $deplibs &quot; in
+	      *&quot; $path &quot;*) ;;
+	      *) deplibs=&quot;$path $deplibs&quot; ;;
+	      esac
+	      case &quot; $deplibs &quot; in
 	      *&quot; $depdepl &quot;*) ;;
 	      *) deplibs=&quot;$depdepl $deplibs&quot; ;;
 	      esac
-	      case &quot; $deplibs &quot; in
-	      *&quot; $path &quot;*) ;;
-	      *) deplibs=&quot;$deplibs $path&quot; ;;
-	      esac
 	    done
 	  fi # link_all_deplibs != no
 	fi # linkmode = lib
@@ -2929,11 +3156,6 @@
 	    age=&quot;$number_minor&quot;
 	    revision=&quot;$number_minor&quot;
 	    ;;
-	  *)
-	    $echo &quot;$modename: unknown library version type \`$version_type'&quot; 1&gt;&amp;2
-	    $echo &quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot; 1&gt;&amp;2
-	    exit $EXIT_FAILURE
-	    ;;
 	  esac
 	  ;;
 	no)
@@ -2947,7 +3169,7 @@
 	case $current in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  $echo &quot;$modename: CURRENT \`$current' is not a nonnegative integer&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: CURRENT \`$current' must be a nonnegative integer&quot; 1&gt;&amp;2
 	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
 	  exit $EXIT_FAILURE
 	  ;;
@@ -2956,7 +3178,7 @@
 	case $revision in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  $echo &quot;$modename: REVISION \`$revision' is not a nonnegative integer&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: REVISION \`$revision' must be a nonnegative integer&quot; 1&gt;&amp;2
 	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
 	  exit $EXIT_FAILURE
 	  ;;
@@ -2965,7 +3187,7 @@
 	case $age in
 	0|[1-9]|[1-9][0-9]|[1-9][0-9][0-9]|[1-9][0-9][0-9][0-9]|[1-9][0-9][0-9][0-9][0-9]) ;;
 	*)
-	  $echo &quot;$modename: AGE \`$age' is not a nonnegative integer&quot; 1&gt;&amp;2
+	  $echo &quot;$modename: AGE \`$age' must be a nonnegative integer&quot; 1&gt;&amp;2
 	  $echo &quot;$modename: \`$vinfo' is not valid version information&quot; 1&gt;&amp;2
 	  exit $EXIT_FAILURE
 	  ;;
@@ -2991,7 +3213,7 @@
 	  versuffix=&quot;$major.$age.$revision&quot;
 	  # Darwin ld doesn't like 0 for these options...
 	  minor_current=`expr $current + 1`
-	  verstring=&quot;-compatibility_version $minor_current -current_version $minor_current.$revision&quot;
+	  verstring=&quot;${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision&quot;
 	  ;;
 
 	freebsd-aout)
@@ -3197,7 +3419,7 @@
 	  *-*-netbsd*)
 	    # Don't link with libc until the a.out ld.so is fixed.
 	    ;;
-	  *-*-openbsd* | *-*-freebsd*)
+	  *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*)
 	    # Do not include libc due to us having libc/libc_r.
 	    test &quot;X$arg&quot; = &quot;X-lc&quot; &amp;&amp; continue
 	    ;;
@@ -3370,6 +3592,13 @@
 			*) potlib=`$echo &quot;X$potlib&quot; | $Xsed -e 's,[^/]*$,,'`&quot;$potliblink&quot;;;
 			esac
 		      done
+		      # It is ok to link against an archive when
+		      # building a shared library.
+		      if $AR -t $potlib &gt; /dev/null 2&gt;&amp;1; then
+		        newdeplibs=&quot;$newdeplibs $a_deplib&quot;
+		        a_deplib=&quot;&quot;
+		        break 2
+		      fi
 		      if eval $file_magic_cmd \&quot;\$potlib\&quot; 2&gt;/dev/null \
 			 | ${SED} 10q \
 			 | $EGREP &quot;$file_magic_regex&quot; &gt; /dev/null; then
@@ -3679,67 +3908,13 @@
 	    eval libobjs=\&quot;\$libobjs $whole_archive_flag_spec\&quot;
 	  else
 	    gentop=&quot;$output_objdir/${outputname}x&quot;
-	    $show &quot;${rm}r $gentop&quot;
-	    $run ${rm}r &quot;$gentop&quot;
-	    $show &quot;$mkdir $gentop&quot;
-	    $run $mkdir &quot;$gentop&quot;
-	    status=$?
-	    if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	      exit $status
-	    fi
 	    generated=&quot;$generated $gentop&quot;
 
-	    for xlib in $convenience; do
-	      # Extract the objects.
-	      case $xlib in
-	      [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	      *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	      esac
-	      xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	      xdir=&quot;$gentop/$xlib&quot;
-
-	      $show &quot;${rm}r $xdir&quot;
-	      $run ${rm}r &quot;$xdir&quot;
-	      $show &quot;$mkdir $xdir&quot;
-	      $run $mkdir &quot;$xdir&quot;
-	      status=$?
-	      if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-		exit $status
-	      fi
-	      # We will extract separately just the conflicting names and we will no
-	      # longer touch any unique names. It is faster to leave these extract
-	      # automatically by $AR in one run.
-	      $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	      $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
-	      if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
-		:
-	      else
-		$echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
-		$echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
-		$AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
-		do
-		  i=1
-		  while test &quot;$i&quot; -le &quot;$count&quot;
-		  do
-		   # Put our $i before any first dot (extension)
-		   # Never overwrite any file
-		   name_to=&quot;$name&quot;
-		   while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
-		   do
-		     name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
-		   done
-		   $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
-		   $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
-		   i=`expr $i + 1`
-		  done
-		done
-	      fi
-
-	      libobjs=&quot;$libobjs &quot;`find $xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
-	    done
+	    func_extract_archives $gentop $convenience
+	    libobjs=&quot;$libobjs $func_extract_archives_result&quot;
 	  fi
 	fi
-
+	
 	if test &quot;$thread_safe&quot; = yes &amp;&amp; test -n &quot;$thread_safe_flag_spec&quot;; then
 	  eval flag=\&quot;$thread_safe_flag_spec\&quot;
 	  linker_flags=&quot;$linker_flags $flag&quot;
@@ -3788,6 +3963,7 @@
 	    save_libobjs=$libobjs
 	  fi
 	  save_output=$output
+	  output_la=`$echo &quot;X$output&quot; | $Xsed -e &quot;$basename&quot;`
 
 	  # Clear the reloadable object creation command queue and
 	  # initialize k to one.
@@ -3797,7 +3973,7 @@
 	  delfiles=
 	  last_robj=
 	  k=1
-	  output=$output_objdir/$save_output-${k}.$objext
+	  output=$output_objdir/$output_la-${k}.$objext
 	  # Loop over the list of objects to be linked.
 	  for obj in $save_libobjs
 	  do
@@ -3817,9 +3993,9 @@
 		# the last one created.
 		eval concat_cmds=\&quot;\$concat_cmds~$reload_cmds $objlist $last_robj\&quot;
 	      fi
-	      last_robj=$output_objdir/$save_output-${k}.$objext
+	      last_robj=$output_objdir/$output_la-${k}.$objext
 	      k=`expr $k + 1`
-	      output=$output_objdir/$save_output-${k}.$objext
+	      output=$output_objdir/$output_la-${k}.$objext
 	      objlist=$obj
 	      len=1
 	    fi
@@ -3839,13 +4015,13 @@
 	    eval concat_cmds=\&quot;\$concat_cmds~$export_symbols_cmds\&quot;
           fi
 
-	  # Set up a command to remove the reloadale object files
+	  # Set up a command to remove the reloadable object files
 	  # after they are used.
 	  i=0
 	  while test &quot;$i&quot; -lt &quot;$k&quot;
 	  do
 	    i=`expr $i + 1`
-	    delfiles=&quot;$delfiles $output_objdir/$save_output-${i}.$objext&quot;
+	    delfiles=&quot;$delfiles $output_objdir/$output_la-${i}.$objext&quot;
 	  done
 
 	  $echo &quot;creating a temporary reloadable object file: $output&quot;
@@ -3977,64 +4153,10 @@
 	  eval reload_conv_objs=\&quot;\$reload_objs $whole_archive_flag_spec\&quot;
 	else
 	  gentop=&quot;$output_objdir/${obj}x&quot;
-	  $show &quot;${rm}r $gentop&quot;
-	  $run ${rm}r &quot;$gentop&quot;
-	  $show &quot;$mkdir $gentop&quot;
-	  $run $mkdir &quot;$gentop&quot;
-	  status=$?
-	  if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	    exit $status
-	  fi
 	  generated=&quot;$generated $gentop&quot;
 
-	  for xlib in $convenience; do
-	    # Extract the objects.
-	    case $xlib in
-	    [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	    *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	    esac
-	    xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	    xdir=&quot;$gentop/$xlib&quot;
-
-	    $show &quot;${rm}r $xdir&quot;
-	    $run ${rm}r &quot;$xdir&quot;
-	    $show &quot;$mkdir $xdir&quot;
-	    $run $mkdir &quot;$xdir&quot;
-	    status=$?
-	    if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-	      exit $status
-	    fi
-	    # We will extract separately just the conflicting names and we will no
-	    # longer touch any unique names. It is faster to leave these extract
-	    # automatically by $AR in one run.
-	    $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	    $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
-	    if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
-	      :
-	    else
-	      $echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
-	      $echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
-	      $AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
-	      do
-		i=1
-		while test &quot;$i&quot; -le &quot;$count&quot;
-		do
-		 # Put our $i before any first dot (extension)
-		 # Never overwrite any file
-		 name_to=&quot;$name&quot;
-		 while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
-		 do
-		   name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
-		 done
-		 $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
-		 $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
-		 i=`expr $i + 1`
-		done
-	      done
-	    fi
-
-	    reload_conv_objs=&quot;$reload_objs &quot;`find $xdir -name \*.$objext -print -o -name \*.lo -print | $NL2SP`
-	  done
+	  func_extract_archives $gentop $convenience
+	  reload_conv_objs=&quot;$reload_objs $func_extract_archives_result&quot;
 	fi
       fi
 
@@ -4296,12 +4418,12 @@
 
 	    # Prepare the list of exported symbols
 	    if test -z &quot;$export_symbols&quot;; then
-	      export_symbols=&quot;$output_objdir/$output.exp&quot;
+	      export_symbols=&quot;$output_objdir/$outputname.exp&quot;
 	      $run $rm $export_symbols
 	      $run eval &quot;${SED} -n -e '/^: @PROGRAM@$/d' -e 's/^.* \(.*\)$/\1/p' &quot;'&lt; &quot;$nlist&quot; &gt; &quot;$export_symbols&quot;'
 	    else
-	      $run eval &quot;${SED} -e 's/\([][.*^$]\)/\\\1/g' -e 's/^/ /' -e 's/$/$/'&quot;' &lt; &quot;$export_symbols&quot; &gt; &quot;$output_objdir/$output.exp&quot;'
-	      $run eval 'grep -f &quot;$output_objdir/$output.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
+	      $run eval &quot;${SED} -e 's/\([ ][.*^$]\)/\\\1/g' -e 's/^/ /' -e 's/$/$/'&quot;' &lt; &quot;$export_symbols&quot; &gt; &quot;$output_objdir/$outputname.exp&quot;'
+	      $run eval 'grep -f &quot;$output_objdir/$outputname.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T'
 	      $run eval 'mv &quot;$nlist&quot;T &quot;$nlist&quot;'
 	    fi
 	  fi
@@ -4353,7 +4475,26 @@
 #endif
 
 /* The mapping between symbol names and symbols. */
+&quot;
+
+	    case $host in
+	    *cygwin* | *mingw* )
+	  $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
+/* DATA imports from DLLs on WIN32 can't be const, because
+   runtime relocations are performed -- see ld's documentation
+   on pseudo-relocs */
+struct {
+&quot;
+	      ;;
+	    * )
+	  $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
 const struct {
+&quot;
+	      ;;
+	    esac
+
+
+	  $echo &gt;&gt; &quot;$output_objdir/$dlsyms&quot; &quot;\
   const char *name;
   lt_ptr address;
 }
@@ -4582,7 +4723,7 @@
 	esac
 	case $host in
 	  *cygwin* | *mingw* )
-	    cwrappersource=`$echo ${objdir}/lt-${output}.c`
+	    cwrappersource=`$echo ${objdir}/lt-${outputname}.c`
 	    cwrapper=`$echo ${output}.exe`
 	    $rm $cwrappersource $cwrapper
 	    trap &quot;$rm $cwrappersource $cwrapper; exit $EXIT_FAILURE&quot; 1 2 15
@@ -4815,7 +4956,7 @@
 
 # The HP-UX ksh and POSIX shell print the target directory to stdout
 # if CDPATH is set.
-if test \&quot;\${CDPATH+set}\&quot; = set; then CDPATH=:; export CDPATH; fi
+(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH
 
 relink_command=\&quot;$relink_command\&quot;
 
@@ -4992,71 +5133,73 @@
 
       if test -n &quot;$addlibs&quot;; then
 	gentop=&quot;$output_objdir/${outputname}x&quot;
-	$show &quot;${rm}r $gentop&quot;
-	$run ${rm}r &quot;$gentop&quot;
-	$show &quot;$mkdir $gentop&quot;
-	$run $mkdir &quot;$gentop&quot;
-	status=$?
-	if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
-	  exit $status
-	fi
 	generated=&quot;$generated $gentop&quot;
 
-	# Add in members from convenience archives.
-	for xlib in $addlibs; do
-	  # Extract the objects.
-	  case $xlib in
-	  [\\/]* | [A-Za-z]:[\\/]*) xabs=&quot;$xlib&quot; ;;
-	  *) xabs=`pwd`&quot;/$xlib&quot; ;;
-	  esac
-	  xlib=`$echo &quot;X$xlib&quot; | $Xsed -e 's%^.*/%%'`
-	  xdir=&quot;$gentop/$xlib&quot;
-
-	  $show &quot;${rm}r $xdir&quot;
-	  $run ${rm}r &quot;$xdir&quot;
-	  $show &quot;$mkdir $xdir&quot;
-	  $run $mkdir &quot;$xdir&quot;
-	  status=$?
-	  if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$xdir&quot;; then
-	    exit $status
-	  fi
-	  # We will extract separately just the conflicting names and we will no
-	  # longer touch any unique names. It is faster to leave these extract
-	  # automatically by $AR in one run.
-	  $show &quot;(cd $xdir &amp;&amp; $AR x $xabs)&quot;
-	  $run eval &quot;(cd \$xdir &amp;&amp; $AR x \$xabs)&quot; || exit $?
-	  if ($AR t &quot;$xabs&quot; | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
-	    :
-	  else
-	    $echo &quot;$modename: warning: object name conflicts; renaming object files&quot; 1&gt;&amp;2
-	    $echo &quot;$modename: warning: to ensure that they will not overwrite&quot; 1&gt;&amp;2
-	    $AR t &quot;$xabs&quot; | sort | uniq -cd | while read -r count name
-	    do
-	      i=1
-	      while test &quot;$i&quot; -le &quot;$count&quot;
-	      do
-	       # Put our $i before any first dot (extension)
-	       # Never overwrite any file
-	       name_to=&quot;$name&quot;
-	       while test &quot;X$name_to&quot; = &quot;X$name&quot; || test -f &quot;$xdir/$name_to&quot;
-	       do
-		 name_to=`$echo &quot;X$name_to&quot; | $Xsed -e &quot;s/\([^.]*\)/\1-$i/&quot;`
-	       done
-	       $show &quot;(cd $xdir &amp;&amp; $AR xN $i $xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot;
-	       $run eval &quot;(cd \$xdir &amp;&amp; $AR xN $i \$xabs '$name' &amp;&amp; $mv '$name' '$name_to')&quot; || exit $?
-	       i=`expr $i + 1`
-	      done
-	    done
-	  fi
-
-	  oldobjs=&quot;$oldobjs &quot;`find $xdir -name \*.${objext} -print -o -name \*.lo -print | $NL2SP`
-	done
+	func_extract_archives $gentop $addlibs
+	oldobjs=&quot;$oldobjs $func_extract_archives_result&quot;
       fi
 
       # Do each command in the archive commands.
       if test -n &quot;$old_archive_from_new_cmds&quot; &amp;&amp; test &quot;$build_libtool_libs&quot; = yes; then
        cmds=$old_archive_from_new_cmds
       else
+	# POSIX demands no paths to be encoded in archives.  We have
+	# to avoid creating archives with duplicate basenames if we
+	# might have to extract them afterwards, e.g., when creating a
+	# static archive out of a convenience library, or when linking
+	# the entirety of a libtool archive into another (currently
+	# not supported by libtool).
+	if (for obj in $oldobjs
+	    do
+	      $echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'
+	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
+	  :
+	else
+	  $echo &quot;copying selected object files to avoid basename conflicts...&quot;
+
+	  if test -z &quot;$gentop&quot;; then
+	    gentop=&quot;$output_objdir/${outputname}x&quot;
+	    generated=&quot;$generated $gentop&quot;
+
+	    $show &quot;${rm}r $gentop&quot;
+	    $run ${rm}r &quot;$gentop&quot;
+	    $show &quot;$mkdir $gentop&quot;
+	    $run $mkdir &quot;$gentop&quot;
+	    status=$?
+	    if test &quot;$status&quot; -ne 0 &amp;&amp; test ! -d &quot;$gentop&quot;; then
+	      exit $status
+	    fi
+	  fi
+
+	  save_oldobjs=$oldobjs
+	  oldobjs=
+	  counter=1
+	  for obj in $save_oldobjs
+	  do
+	    objbase=`$echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'`
+	    case &quot; $oldobjs &quot; in
+	    &quot; &quot;) oldobjs=$obj ;;
+	    *[\ /]&quot;$objbase &quot;*)
+	      while :; do
+		# Make sure we don't pick an alternate name that also
+		# overlaps.
+		newobj=lt$counter-$objbase
+		counter=`expr $counter + 1`
+		case &quot; $oldobjs &quot; in
+		*[\ /]&quot;$newobj &quot;*) ;;
+		*) if test ! -f &quot;$gentop/$newobj&quot;; then break; fi ;;
+		esac
+	      done
+	      $show &quot;ln $obj $gentop/$newobj || cp $obj $gentop/$newobj&quot;
+	      $run ln &quot;$obj&quot; &quot;$gentop/$newobj&quot; ||
+	      $run cp &quot;$obj&quot; &quot;$gentop/$newobj&quot;
+	      oldobjs=&quot;$oldobjs $gentop/$newobj&quot;
+	      ;;
+	    *) oldobjs=&quot;$oldobjs $obj&quot; ;;
+	    esac
+	  done
+	fi
+
 	eval cmds=\&quot;$old_archive_cmds\&quot;
 
 	if len=`expr &quot;X$cmds&quot; : &quot;.*&quot;` &amp;&amp;
@@ -5070,20 +5213,7 @@
 	  objlist=
 	  concat_cmds=
 	  save_oldobjs=$oldobjs
-	  # GNU ar 2.10+ was changed to match POSIX; thus no paths are
-	  # encoded into archives.  This makes 'ar r' malfunction in
-	  # this piecewise linking case whenever conflicting object
-	  # names appear in distinct ar calls; check, warn and compensate.
-	    if (for obj in $save_oldobjs
-	    do
-	      $echo &quot;X$obj&quot; | $Xsed -e 's%^.*/%%'
-	    done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then
-	    :
-	  else
-	    $echo &quot;$modename: warning: object name conflicts; overriding AR_FLAGS to 'cq'&quot; 1&gt;&amp;2
-	    $echo &quot;$modename: warning: to ensure that POSIX-compatible ar will work&quot; 1&gt;&amp;2
-	    AR_FLAGS=cq
-	  fi
+
 	  # Is there a better way of finding the last object in the list?
 	  for obj in $save_oldobjs
 	  do
@@ -5177,9 +5307,53 @@
 		  $echo &quot;$modename: \`$deplib' is not a valid libtool archive&quot; 1&gt;&amp;2
 		  exit $EXIT_FAILURE
 		fi
-		newdependency_libs=&quot;$newdependency_libs $libdir/$name&quot;
+		if test &quot;X$EGREP&quot; = X ; then
+			EGREP=egrep
+		fi
+		# We do not want portage's install root ($D) present.  Check only for
+		# this if the .la is being installed.
+		if test &quot;$installed&quot; = yes &amp;&amp; test &quot;$D&quot;; then
+		  eval mynewdependency_lib=`echo &quot;$libdir/$name&quot; |sed -e &quot;s:$D:/:g&quot; -e 's:/\+:/:g'`
+		else
+		  mynewdependency_lib=&quot;$libdir/$name&quot;
+		fi
+		# Do not add duplicates
+		if test &quot;$mynewdependency_lib&quot;; then
+		  my_little_ninja_foo_1=`echo $newdependency_libs |$EGREP -e &quot;$mynewdependency_lib&quot;`
+		  if test -z &quot;$my_little_ninja_foo_1&quot;; then
+		    newdependency_libs=&quot;$newdependency_libs $mynewdependency_lib&quot;
+		  fi
+		fi
 		;;
-	      *) newdependency_libs=&quot;$newdependency_libs $deplib&quot; ;;
+		  *)
+		if test &quot;$installed&quot; = yes; then
+		  # Rather use S=WORKDIR if our version of portage supports it.
+		  # This is because some ebuild (gcc) do not use $S as buildroot.
+		  if test &quot;$PWORKDIR&quot;; then
+		    S=&quot;$PWORKDIR&quot;
+		  fi
+		  # We do not want portage's build root ($S) present.
+		  my_little_ninja_foo_2=`echo $deplib |$EGREP -e &quot;$S&quot;`
+		  if test -n &quot;$my_little_ninja_foo_2&quot; &amp;&amp; test &quot;$S&quot;; then
+		    mynewdependency_lib=&quot;&quot;
+		  # We do not want portage's install root ($D) present.
+		  my_little_ninja_foo_3=`echo $deplib |$EGREP -e &quot;$D&quot;`
+		  elif test -n &quot;$my_little_ninja_foo_3&quot; &amp;&amp; test &quot;$D&quot;; then
+		    eval mynewdependency_lib=`echo &quot;$deplib&quot; |sed -e &quot;s:$D:/:g&quot; -e 's:/\+:/:g'`
+		  else
+		    mynewdependency_lib=&quot;$deplib&quot;
+		  fi
+		else
+		  mynewdependency_lib=&quot;$deplib&quot;
+		fi
+		# Do not add duplicates
+		if test &quot;$mynewdependency_lib&quot;; then
+		  my_little_ninja_foo_4=`echo $newdependency_libs |$EGREP -e &quot;$mynewdependency_lib&quot;`
+		  if test -z &quot;$my_little_ninja_foo_4&quot;; then
+			newdependency_libs=&quot;$newdependency_libs $mynewdependency_lib&quot;
+		  fi
+		fi
+		;;
 	      esac
 	    done
 	    dependency_libs=&quot;$newdependency_libs&quot;
@@ -5231,6 +5405,10 @@
 	  case $host,$output,$installed,$module,$dlname in
 	    *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;
 	  esac
+	  # Do not add duplicates
+	  if test &quot;$installed&quot; = yes &amp;&amp; test &quot;$D&quot;; then
+	    install_libdir=`echo &quot;$install_libdir&quot; |sed -e &quot;s:$D:/:g&quot; -e 's:/\+:/:g'`
+	  fi
 	  $echo &gt; $output &quot;\
 # $outputname - a libtool library file
 # Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP
@@ -5295,7 +5473,7 @@
       # Aesthetically quote it.
       arg=`$echo &quot;X$nonopt&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
       case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	arg=&quot;\&quot;$arg\&quot;&quot;
 	;;
       esac
@@ -5311,7 +5489,7 @@
     # Aesthetically quote it.
     arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
     case $arg in
-    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
+    *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
       arg=&quot;\&quot;$arg\&quot;&quot;
       ;;
     esac
@@ -5359,7 +5537,7 @@
       # Aesthetically quote the argument.
       arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`
       case $arg in
-      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\'\ \	]*|*]*)
+      *$quote_scanset* | *]* | *\|* | *\&amp;* | *\(* | *\)* | &quot;&quot;)
 	arg=&quot;\&quot;$arg\&quot;&quot;
 	;;
       esac
@@ -6398,7 +6576,7 @@
 $echo
 $echo &quot;Try \`$modename --help' for more information about other modes.&quot;
 
-exit $EXIT_SUCCESS
+exit $?
 
 # The TAGs below are defined such that we never get into a situation
 # in which we disable both kinds of libraries.  Given conflicting

Modified: branches/mloskot-style-refactoring/src/Makefile
===================================================================
--- branches/mloskot-style-refactoring/src/Makefile	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/src/Makefile	2005-11-11 18:07:47 UTC (rev 227)
@@ -25,7 +25,7 @@
 pkgincludedir = $(includedir)/openspace
 top_builddir = ..
 am__cd = CDPATH=&quot;$${ZSH_VERSION+.}$(PATH_SEPARATOR)&quot; &amp;&amp; cd
-INSTALL = /usr/bin/install -c
+INSTALL = /bin/install -c
 install_sh_DATA = $(install_sh) -c -m 644
 install_sh_PROGRAM = $(install_sh) -c
 install_sh_SCRIPT = $(install_sh) -c
@@ -37,7 +37,7 @@
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_triplet = x86_64-unknown-linux-gnu
+host_triplet = i686-pc-linux-gnu
 bin_PROGRAMS = openspace$(EXEEXT)
 subdir = src
 DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
@@ -112,14 +112,14 @@
 CTAGS = ctags
 DIST_SUBDIRS = $(SUBDIRS)
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
-ACLOCAL = ${SHELL} /home/mloskot/dev/openspace/work/missing --run aclocal-1.8
+ACLOCAL = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run aclocal-1.8
 AMDEP_FALSE = #
 AMDEP_TRUE = 
-AMTAR = ${SHELL} /home/mloskot/dev/openspace/work/missing --run tar
+AMTAR = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run tar
 AR = ar
-AUTOCONF = ${SHELL} /home/mloskot/dev/openspace/work/missing --run autoconf
-AUTOHEADER = ${SHELL} /home/mloskot/dev/openspace/work/missing --run autoheader
-AUTOMAKE = ${SHELL} /home/mloskot/dev/openspace/work/missing --run automake-1.8
+AUTOCONF = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run autoconf
+AUTOHEADER = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run autoheader
+AUTOMAKE = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run automake-1.8
 AWK = gawk
 CC = gcc
 CCDEPMODE = depmode=gcc3
@@ -152,7 +152,7 @@
 LIBTOOL = $(SHELL) $(top_builddir)/libtool
 LN_S = ln -s
 LTLIBOBJS = 
-MAKEINFO = ${SHELL} /home/mloskot/dev/openspace/work/missing --run makeinfo
+MAKEINFO = ${SHELL} /root/openspace4/mloskot-style-refactoring/missing --run makeinfo
 OBJEXT = o
 PACKAGE = openspace
 PACKAGE_BUGREPORT = <A HREF="http://openspace.linux.pl">http://openspace.linux.pl</A>
@@ -181,28 +181,28 @@
 am__leading_dot = .
 am__quote = 
 bindir = ${exec_prefix}/bin
-build = x86_64-unknown-linux-gnu
+build = i686-pc-linux-gnu
 build_alias = 
-build_cpu = x86_64
+build_cpu = i686
 build_os = linux-gnu
-build_vendor = unknown
+build_vendor = pc
 datadir = ${prefix}/share
 exec_prefix = ${prefix}
-host = x86_64-unknown-linux-gnu
+host = i686-pc-linux-gnu
 host_alias = 
-host_cpu = x86_64
+host_cpu = i686
 host_os = linux-gnu
-host_vendor = unknown
+host_vendor = pc
 includedir = ${prefix}/include
 infodir = ${prefix}/info
-install_sh = /home/mloskot/dev/openspace/work/install-sh
+install_sh = /root/openspace4/mloskot-style-refactoring/install-sh
 libdir = ${exec_prefix}/lib
 libexecdir = ${exec_prefix}/libexec
 localstatedir = ${prefix}/var
 mandir = ${prefix}/man
 mkdir_p = mkdir -p -- .
 oldincludedir = /usr/include
-prefix = /home/mloskot/usr
+prefix = /usr
 program_transform_name = s,x,x,
 sbindir = ${exec_prefix}/sbin
 sharedstatedir = ${prefix}/com

Modified: branches/mloskot-style-refactoring/src/OSFileList.cpp
===================================================================
--- branches/mloskot-style-refactoring/src/OSFileList.cpp	2005-11-11 17:38:14 UTC (rev 226)
+++ branches/mloskot-style-refactoring/src/OSFileList.cpp	2005-11-11 18:07:47 UTC (rev 227)
@@ -61,6 +61,11 @@
 #endif
 #include &lt;sys/mount.h&gt;
 
+
+#ifndef PATH_LIBDIR
+#define PATH_LIBDIR &quot;/usr/local/lib&quot;
+#endif
+
 FXDEFMAP (OSFileList) OSFileListMap[] =
 {
 FXMAPFUNC (SEL_FOCUSIN, OSFileList::ID_ICO, OSFileList::setFocus),
@@ -253,7 +258,7 @@
     
 
 
-    string plugin_path = string(PATH_LIBDIR) + &quot;/openspace/plugins/OSFileList/libfilelist&quot; + this-&gt;type;
+    string plugin_path = string(PATH_LIBDIR) + &quot;/openspace/plugins/filelist/libfilelist&quot; + this-&gt;type;
 
 
 #ifdef WIN32
@@ -264,14 +269,14 @@
 
     if(!FXFile::exists(plugin_path.c_str()))
     {
-    plugin_path = FXFile::getUserDirectory (&quot;&quot;).text ()+string(&quot;/.openspace/plugins/OSFileList/libfilelist&quot;)+ this-&gt;type;
+    plugin_path = FXFile::getUserDirectory (&quot;&quot;).text ()+string(&quot;/.openspace/plugins/filelist/libfilelist&quot;)+ this-&gt;type;
     #ifdef WIN32
     plugin_path += &quot;.dll&quot;;
     #else
     plugin_path += &quot;.so&quot;;
     #endif
     }
-    
+
     void *dllhandle = fxdllOpen (plugin_path.c_str ());
     if (dllhandle)
     {


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000006.html">[Openspace-svn] r226 - branches/mloskot-style-refactoring/src
</A></li>
	<LI>Next message: <A HREF="000008.html">[Openspace-svn] r228 - branches/mloskot-style-refactoring/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#9">[ date ]</a>
              <a href="thread.html#9">[ thread ]</a>
              <a href="subject.html#9">[ subject ]</a>
              <a href="author.html#9">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/openspace-svn">More information about the Openspace-svn
mailing list</a><br>
</body></html>
