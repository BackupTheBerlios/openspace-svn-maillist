From compbatant at berlios.de  Sun Apr  2 20:50:24 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 2 Apr 2006 20:50:24 +0200
Subject: [Openspace-svn] r269 - in trunk: . src
Message-ID: <200604021850.k32IoOuS009859@sheep.berlios.de>

Author: compbatant
Date: 2006-04-02 20:50:17 +0200 (Sun, 02 Apr 2006)
New Revision: 269

Modified:
   trunk/openspacerc.in
   trunk/src/OSFileList.cpp
   trunk/src/OSMainWindow.cpp
Log:
zmiany kosmetyczne;)


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-03-31 14:42:44 UTC (rev 268)
+++ trunk/openspacerc.in	2006-04-02 18:50:17 UTC (rev 269)
@@ -45,8 +45,8 @@
 	</speed_delay>
 	
  	<mainwindow>
-		<width>898</width>
-		<height>600</height>
+		<width>704</width>
+		<height>450</height>
 	</mainwindow>
   
   	<defaultdir>

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-03-31 14:42:44 UTC (rev 268)
+++ trunk/src/OSFileList.cpp	2006-04-02 18:50:17 UTC (rev 269)
@@ -270,7 +270,7 @@
 
     info = new FXLabel (p, fb->info ().c_str ());
 
-    textfield = new FXTextField (toolbar, 30, this, OSFileList::ID_TEXTFIELD_RUN);
+    textfield = new FXTextField (toolbar, 21, this, OSFileList::ID_TEXTFIELD_RUN);
 
     dial = NULL;
     processing = false;
@@ -784,7 +784,7 @@
 long OSFileList::lostFocus (FXObject * obj, FXSelector sel, void *ptr)
 {
 //active=false;
-    setBackColor (FXRGB (220, 220, 220));
+  //  setBackColor (FXRGB (220, 220, 220));
 
 
 }

Modified: trunk/src/OSMainWindow.cpp
===================================================================
--- trunk/src/OSMainWindow.cpp	2006-03-31 14:42:44 UTC (rev 268)
+++ trunk/src/OSMainWindow.cpp	2006-04-02 18:50:17 UTC (rev 269)
@@ -40,7 +40,7 @@
 
 
 //-----MAIN WINDOW---------------------------------------------------------------------------------------------------------------------------
-OSMainWindow::OSMainWindow ( FXApp * a ) : FXMainWindow ( a, "openspace", NULL, NULL, DECOR_ALL | LAYOUT_FIX_WIDTH, 0, 0, 600, 400, 0, 0 )
+OSMainWindow::OSMainWindow ( FXApp * a ) : FXMainWindow ( a, "openspace", NULL, NULL, DECOR_ALL | LAYOUT_FIX_WIDTH, 0, 0, 600, 400, 0, 0, 0, 0, 0, 0)
 {
     conf = new OSConfigure ();
 
@@ -141,28 +141,28 @@
             new FXToolBarGrip ( toolbar, toolbar, FXToolBar::ID_TOOLBARGRIP, TOOLBARGRIP_SINGLE );
 
             FXVerticalFrame *ff = new FXVerticalFrame ( this, LAYOUT_FILL_X | LAYOUT_FILL_Y| FRAME_NONE, 0, 0, 0, 0, 0, 0, 0, 0 );
-            controlframe = new FXVerticalFrame ( ff, LAYOUT_FILL_X | FRAME_NONE, 0, 0, 0, 0, 0, 0, 0, 0 );
+            controlframe = new FXVerticalFrame ( ff, LAYOUT_FILL_X | FRAME_NONE, 0, 0, 0, 0, 5, 5, 0, 0 );
             splitter = new FXSplitter ( ff, LAYOUT_FILL_X | SPLITTER_TRACKING | LAYOUT_FILL_Y );
-            left = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 0, 0, 0 );
-            right = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 0, 0, 0 );
+            left = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 5, 0, 0, 0 );
+            right = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 0, 5, 0, 0 );
 	    
      		
-            leftcontrolframe = new FXVerticalFrame ( left, LAYOUT_FILL_X );
-            leftframe = new FXVerticalFrame ( left, LAYOUT_FILL_X | LAYOUT_FILL_Y );
-            rightcontrolframe = new FXVerticalFrame ( right, LAYOUT_FILL_X );
-            rightframe = new FXVerticalFrame ( right, LAYOUT_FILL_X | LAYOUT_FILL_Y );
+            leftcontrolframe = new FXVerticalFrame ( left, LAYOUT_FILL_X , 0, 0, 0, 0, 0, 0, 0, 0 );
+            leftframe = new FXVerticalFrame ( left, LAYOUT_FILL_X | LAYOUT_FILL_Y , 0, 0, 0, 0, 0, 0, 0, 0 );
+            rightcontrolframe = new FXVerticalFrame ( right, LAYOUT_FILL_X , 0, 0, 0, 0, 0, 0, 0, 0 );
+            rightframe = new FXVerticalFrame ( right, LAYOUT_FILL_X | LAYOUT_FILL_Y, 0, 0, 0, 0, 0, 0, 0, 0 );
 
-            new FXButton ( toolbar, "\thide/show copy/move progress", objmanager->osicons[ "plus" ], this, OSMainWindow::ID_COMMANDS_SHOW, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
-            new FXButton ( toolbar, "\topen new panel", objmanager->osicons[ "folder" ], this, OSMainWindow::ID_NEWFRAME, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
-            new FXButton ( toolbar, "\tconnect", objmanager->osicons[ "network" ], this, OSMainWindow::ID_NEW_NETWORK, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
-            new FXButton ( toolbar, "\tsearch", objmanager->osicons[ "search" ], this, OSMainWindow::ID_NEW_SEARCH, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
+            new FXButton ( toolbar, "\thide/show copy/move progress", objmanager->osicons[ "plus" ], this, OSMainWindow::ID_COMMANDS_SHOW, FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
+            new FXButton ( toolbar, "\topen new panel", objmanager->osicons[ "folder" ], this, OSMainWindow::ID_NEWFRAME,FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
+            new FXButton ( toolbar, "\tconnect", objmanager->osicons[ "network" ], this, OSMainWindow::ID_NEW_NETWORK, FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
+            new FXButton ( toolbar, "\tsearch", objmanager->osicons[ "search" ], this, OSMainWindow::ID_NEW_SEARCH, FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
 
             new FXSeparator ( toolbar, SEPARATOR_NONE );
             new FXSeparator ( toolbar, SEPARATOR_GROOVE );
             new FXSeparator ( toolbar, SEPARATOR_NONE );
 
-            new FXButton ( toolbar, "\tconfiguration", objmanager->osicons[ "configure" ], this, OSMainWindow::ID_CONFIGURE, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
-            new FXButton ( toolbar, "\tabout", objmanager->osicons[ "about" ], this, OSMainWindow::ID_ABOUT, FRAME_THICK, 0, 0, 0, 0, 0, 0, 0, 0 );
+            new FXButton ( toolbar, "\tconfiguration", objmanager->osicons[ "configure" ], this, OSMainWindow::ID_CONFIGURE, FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
+            new FXButton ( toolbar, "\tabout", objmanager->osicons[ "about" ], this, OSMainWindow::ID_ABOUT,FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
             toolbar->dock( rightdock );
 
             string dir = parseDir ( conf->readonestring ( "/OpenspaceConfig/leftdir/dir" ) );



From compbatant at berlios.de  Sun Apr  2 23:46:31 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 2 Apr 2006 23:46:31 +0200
Subject: [Openspace-svn] r270 - trunk/src
Message-ID: <200604022146.k32LkV8g011961@sheep.berlios.de>

Author: compbatant
Date: 2006-04-02 23:46:30 +0200 (Sun, 02 Apr 2006)
New Revision: 270

Modified:
   trunk/src/OSMainWindow.cpp
Log:
kosmetyka


Modified: trunk/src/OSMainWindow.cpp
===================================================================
--- trunk/src/OSMainWindow.cpp	2006-04-02 18:50:17 UTC (rev 269)
+++ trunk/src/OSMainWindow.cpp	2006-04-02 21:46:30 UTC (rev 270)
@@ -140,17 +140,17 @@
             FXToolBar *toolbar = new FXToolBar ( topdock, dragshell1, LAYOUT_DOCK_NEXT | LAYOUT_SIDE_TOP | FRAME_RAISED );
             new FXToolBarGrip ( toolbar, toolbar, FXToolBar::ID_TOOLBARGRIP, TOOLBARGRIP_SINGLE );
 
-            FXVerticalFrame *ff = new FXVerticalFrame ( this, LAYOUT_FILL_X | LAYOUT_FILL_Y| FRAME_NONE, 0, 0, 0, 0, 0, 0, 0, 0 );
-            controlframe = new FXVerticalFrame ( ff, LAYOUT_FILL_X | FRAME_NONE, 0, 0, 0, 0, 5, 5, 0, 0 );
+            FXVerticalFrame *ff = new FXVerticalFrame ( this, LAYOUT_FILL_X | LAYOUT_FILL_Y| FRAME_NONE, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 );
+            controlframe = new FXVerticalFrame ( ff, LAYOUT_FILL_X | FRAME_NONE, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0 );
             splitter = new FXSplitter ( ff, LAYOUT_FILL_X | SPLITTER_TRACKING | LAYOUT_FILL_Y );
             left = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 5, 0, 0, 0 );
             right = new FXVerticalFrame ( splitter, LAYOUT_FILL_X | LAYOUT_FILL_Y | FRAME_NONE, 0, 0, w / 2, 0, 0, 5, 0, 0 );
 	    
      		
             leftcontrolframe = new FXVerticalFrame ( left, LAYOUT_FILL_X , 0, 0, 0, 0, 0, 0, 0, 0 );
-            leftframe = new FXVerticalFrame ( left, LAYOUT_FILL_X | LAYOUT_FILL_Y , 0, 0, 0, 0, 0, 0, 0, 0 );
+            leftframe = new FXVerticalFrame ( left, LAYOUT_FILL_X | LAYOUT_FILL_Y , 0, 0, 0, 0, 0, 0, 0, 0, 0 ,0 );
             rightcontrolframe = new FXVerticalFrame ( right, LAYOUT_FILL_X , 0, 0, 0, 0, 0, 0, 0, 0 );
-            rightframe = new FXVerticalFrame ( right, LAYOUT_FILL_X | LAYOUT_FILL_Y, 0, 0, 0, 0, 0, 0, 0, 0 );
+            rightframe = new FXVerticalFrame ( right, LAYOUT_FILL_X | LAYOUT_FILL_Y, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 );
 
             new FXButton ( toolbar, "\thide/show copy/move progress", objmanager->osicons[ "plus" ], this, OSMainWindow::ID_COMMANDS_SHOW, FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);
             new FXButton ( toolbar, "\topen new panel", objmanager->osicons[ "folder" ], this, OSMainWindow::ID_NEWFRAME,FRAME_RAISED | LAYOUT_TOP | LAYOUT_LEFT | BUTTON_TOOLBAR, 0, 0, 0, 0, 0, 0, 0, 0);



From compbatant at berlios.de  Mon Apr  3 23:57:42 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Mon, 3 Apr 2006 23:57:42 +0200
Subject: [Openspace-svn] r271 - trunk/src
Message-ID: <200604032157.k33Lvge5017238@sheep.berlios.de>

Author: compbatant
Date: 2006-04-03 23:57:41 +0200 (Mon, 03 Apr 2006)
New Revision: 271

Modified:
   trunk/src/OSFileListItem.cpp
Log:
kosmetyka cd;)


Modified: trunk/src/OSFileListItem.cpp
===================================================================
--- trunk/src/OSFileListItem.cpp	2006-04-02 21:46:30 UTC (rev 270)
+++ trunk/src/OSFileListItem.cpp	2006-04-03 21:57:41 UTC (rev 271)
@@ -220,7 +220,7 @@
             for ( int i = 0;i < osf.attrib.size();i++ )
             {
 
-                dc.drawText( xt + 2, yt + ( i + 2 ) * font->getFontAscent() + 2, osf.attrib[ i ].c_str(), osf.attrib[ i ].length() );
+                dc.drawText( xt + 4, yt + ( i + 2 ) * font->getFontAscent() + 2, osf.attrib[ i ].c_str(), osf.attrib[ i ].length() );
 
             }
             //=============CHANGES==========================================
@@ -235,7 +235,8 @@
     {
 
         //=============CHANGES==========================================
-        xi = x;
+        //xi = x;
+	xi=x+ 2;
         //=============CHANGES==========================================
         yi = y + BIG_LINE_SPACING / 2 + ( h - th - BIG_LINE_SPACING - ss - ih ) / 2;
         if ( isSelected() )



From compbatant at berlios.de  Tue Apr  4 21:00:38 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Tue, 4 Apr 2006 21:00:38 +0200
Subject: [Openspace-svn] r272 - trunk/src
Message-ID: <200604041900.k34J0c6e006761@sheep.berlios.de>

Author: compbatant
Date: 2006-04-04 21:00:35 +0200 (Tue, 04 Apr 2006)
New Revision: 272

Modified:
   trunk/src/OSFileListItem.cpp
   trunk/src/OSPreferences.cpp
Log:
kosmetyka


Modified: trunk/src/OSFileListItem.cpp
===================================================================
--- trunk/src/OSFileListItem.cpp	2006-04-03 21:57:41 UTC (rev 271)
+++ trunk/src/OSFileListItem.cpp	2006-04-04 19:00:35 UTC (rev 272)
@@ -247,19 +247,19 @@
         {
             dc.drawIcon( bigIcon, xi, y + 4 + font->getFontHeight() );
         }
-        if ( osf.type & EXECUTABLE && !( osf.type & FOLDER ) )
+	if ( osf.type & SYMLINK )
         {
-	    FXIcon *icon=( ( OSFileList* ) list ) ->specialicons[ 2 ];
+	    FXIcon *icon=( ( OSFileList* ) list ) ->specialicons[ 3 ];
 	    if(icon)
             dc.drawIcon( icon, xi, y + 4 + font->getFontHeight() );
         }
-        else if ( osf.type & SYMLINK )
+        else if ( osf.type & EXECUTABLE && !( osf.type & FOLDER ) )
         {
-	    FXIcon *icon=( ( OSFileList* ) list ) ->specialicons[ 3 ];
+	    FXIcon *icon=( ( OSFileList* ) list ) ->specialicons[ 2 ];
 	    if(icon)
             dc.drawIcon( icon, xi, y + 4 + font->getFontHeight() );
         }
-
+        
         if ( osf.content != "" )
         {
             dc.setFont( font1 );

Modified: trunk/src/OSPreferences.cpp
===================================================================
--- trunk/src/OSPreferences.cpp	2006-04-03 21:57:41 UTC (rev 271)
+++ trunk/src/OSPreferences.cpp	2006-04-04 19:00:35 UTC (rev 272)
@@ -638,7 +638,7 @@
 
 
 
-    new FXLabel ( commandsPane, "shortuct mask: ", NULL, LAYOUT_LEFT );
+    new FXLabel ( commandsPane, "shortcut mask: ", NULL, LAYOUT_LEFT );
     shortcutMaskList = new FXListBox ( commandsPane );
     shortcutMaskList->setNumVisible( 3 );
     shortcutMaskList->appendItem( "" );



From compbatant at berlios.de  Wed Apr  5 22:43:44 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Wed, 5 Apr 2006 22:43:44 +0200
Subject: [Openspace-svn] r273 - trunk/src/plugins/filelist
Message-ID: <200604052043.k35KhiM7025645@sheep.berlios.de>

Author: compbatant
Date: 2006-04-05 22:43:43 +0200 (Wed, 05 Apr 2006)
New Revision: 273

Modified:
   trunk/src/plugins/filelist/OSVfsLocal.cpp
Log:
poprawiony blad z usuwaniem symlinkow do katalogow


Modified: trunk/src/plugins/filelist/OSVfsLocal.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsLocal.cpp	2006-04-04 19:00:35 UTC (rev 272)
+++ trunk/src/plugins/filelist/OSVfsLocal.cpp	2006-04-05 20:43:43 UTC (rev 273)
@@ -267,7 +267,7 @@
 	{
 
 	    std::string sr = (*iter);
-	    if (FXFile::isDirectory (sr.c_str ()))
+	    if (FXFile::isDirectory (sr.c_str ()) &&  !FXFile::isLink(sr.c_str ()))
 		sr.append (SEPARATOR);
 	    FXTRACE ((5, "REMOVE: %s", sr.c_str ()));
 



From compbatant at berlios.de  Wed Apr  5 23:15:05 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Wed, 5 Apr 2006 23:15:05 +0200
Subject: [Openspace-svn] r274 - trunk/src
Message-ID: <200604052115.k35LF5e2030299@sheep.berlios.de>

Author: compbatant
Date: 2006-04-05 23:15:04 +0200 (Wed, 05 Apr 2006)
New Revision: 274

Modified:
   trunk/src/OSMainWindow.cpp
Log:
usunity sefault przy zamykaniu panelu z plikami - tylko u niektorych byl ten segfault:/


Modified: trunk/src/OSMainWindow.cpp
===================================================================
--- trunk/src/OSMainWindow.cpp	2006-04-05 20:43:43 UTC (rev 273)
+++ trunk/src/OSMainWindow.cpp	2006-04-05 21:15:04 UTC (rev 274)
@@ -582,8 +582,11 @@
         }
         if ( canclose )
         {
-            delete boxel->fr;
-            sender = NULL;
+	OSThreadExec *el = new OSThreadExec (boxel->fr->f->fb, "close",string("none"));
+	el->end=true;
+	el->filel=(void*)boxel->fr;
+	objmanager->thread_vec.push_back (el);
+ 
         }
         else
         {
@@ -773,6 +776,11 @@
 
                     }
                 }
+		if ( telem->command == "close" )
+                {
+		           delete (OSFrame*)telem->filel;
+     
+		}
                 if ( telem->command == "copy" )
                 {
                     if ( ( left_frame->f->fb == telem->fb && download == true ) || ( download == false && right_frame->f->fb == telem->fb ) )



From compbatant at berlios.de  Wed Apr  5 23:43:17 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Wed, 5 Apr 2006 23:43:17 +0200
Subject: [Openspace-svn] r275 - trunk/src
Message-ID: <200604052143.k35LhHLu002003@sheep.berlios.de>

Author: compbatant
Date: 2006-04-05 23:43:16 +0200 (Wed, 05 Apr 2006)
New Revision: 275

Modified:
   trunk/src/OSMainWindow.cpp
Log:
rc3


Modified: trunk/src/OSMainWindow.cpp
===================================================================
--- trunk/src/OSMainWindow.cpp	2006-04-05 21:15:04 UTC (rev 274)
+++ trunk/src/OSMainWindow.cpp	2006-04-05 21:43:16 UTC (rev 275)
@@ -582,9 +582,11 @@
         }
         if ( canclose )
         {
+	boxel->fr->hf->hide();
 	OSThreadExec *el = new OSThreadExec (boxel->fr->f->fb, "close",string("none"));
 	el->end=true;
 	el->filel=(void*)boxel->fr;
+	el->gui=NULL;
 	objmanager->thread_vec.push_back (el);
  
         }
@@ -817,6 +819,7 @@
                     telem->pane->popup ( NULL, this->getX (), this->getY (), lab->getWidth (), lab->getHeight () );
                 }
                 //cleanup
+		if(telem->gui)
                 delete ( ( OSInfoPanel * ) telem->gui );
                 telem->gui = NULL;
                 infoframe->recalc ();



From compbatant at berlios.de  Fri Apr  7 16:23:04 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 7 Apr 2006 16:23:04 +0200
Subject: [Openspace-svn] r276 - trunk/src
Message-ID: <200604071423.k37EN4SN005492@sheep.berlios.de>

Author: compbatant
Date: 2006-04-07 16:23:03 +0200 (Fri, 07 Apr 2006)
New Revision: 276

Modified:
   trunk/src/OSPreferences.cpp
Log:
nie dzialalo usuwanie komend


Modified: trunk/src/OSPreferences.cpp
===================================================================
--- trunk/src/OSPreferences.cpp	2006-04-05 21:43:16 UTC (rev 275)
+++ trunk/src/OSPreferences.cpp	2006-04-07 14:23:03 UTC (rev 276)
@@ -1606,7 +1606,7 @@
     if ( name == "" ) return false;
 
     int p, k;
-    FXRex identifier( "[0-9a-zA-Z]*" );
+    FXRex identifier( "[0-9a-zA-Z_]*" );
     identifier.match( name.c_str(), name.size(), &p, &k );
 
 
@@ -1703,6 +1703,9 @@
     conf->removestring ( res );
 
 
+    commandsMap.erase(command);
+
+
 }
 
 long OSPreferences:: onAdditionalCommandChange( FXObject * sender, FXSelector sel, void * )



From compbatant at berlios.de  Fri Apr  7 17:20:04 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 7 Apr 2006 17:20:04 +0200
Subject: [Openspace-svn] r277 - trunk/src
Message-ID: <200604071520.k37FK4pA012773@sheep.berlios.de>

Author: compbatant
Date: 2006-04-07 17:20:02 +0200 (Fri, 07 Apr 2006)
New Revision: 277

Modified:
   trunk/src/Makefile
   trunk/src/Makefile.am
   trunk/src/Makefile.in
   trunk/src/OSConfigure.cpp
   trunk/src/OSFileList.cpp
   trunk/src/OSMimeApp.cpp
Log:
naprawiony blad przy instalacji w innej lokalizacji i nie podawaniu sysconfdir


Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/Makefile	2006-04-07 15:20:02 UTC (rev 277)
@@ -201,11 +201,11 @@
 mandir = ${prefix}/man
 mkdir_p = mkdir -p -- .
 oldincludedir = /usr/include
-prefix = /usr
+prefix = /root/usr
 program_transform_name = s,x,x,
 sbindir = ${exec_prefix}/sbin
 sharedstatedir = ${prefix}/com
-sysconfdir = /etc
+sysconfdir = ${prefix}/etc
 target_alias = 
 openspace_SOURCES = main.cpp OSCMDDialogBox.cpp OSCMDDialogBox.h \
 	OSCommandTypeInfo.cpp OSCommandTypeInfo.h OSConfigure.cpp OSConfigure.h OSFile.h \
@@ -221,7 +221,8 @@
 SUBDIRS = plugins
 INCLUDES = -I$(top_srcdir)/src `WANT_FOX="1.4" fox-config --cflags`  `xml2-config  --cflags`  \
 	-DPATH_CFG=\"$(sysconfdir)\" \
-	-DPATH_LIBDIR=\"$(libdir)\"
+	-DPATH_LIBDIR=\"$(libdir)\" \
+	-DPREFIX=\"$(prefix)\" 
 
 openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
 all: config.h

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/Makefile.am	2006-04-07 15:20:02 UTC (rev 277)
@@ -15,7 +15,8 @@
 
 INCLUDES = -I$(top_srcdir)/src `WANT_FOX="1.4" fox-config --cflags`  `xml2-config  --cflags`  \
 	-DPATH_CFG=\"$(sysconfdir)\" \
-	-DPATH_LIBDIR=\"$(libdir)\"
+	-DPATH_LIBDIR=\"$(libdir)\" \
+	-DPREFIX=\"$(prefix)\" 
 
 openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
 

Modified: trunk/src/Makefile.in
===================================================================
--- trunk/src/Makefile.in	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/Makefile.in	2006-04-07 15:20:02 UTC (rev 277)
@@ -221,7 +221,8 @@
 SUBDIRS = plugins
 INCLUDES = -I$(top_srcdir)/src `WANT_FOX="1.4" fox-config --cflags`  `xml2-config  --cflags`  \
 	-DPATH_CFG=\"$(sysconfdir)\" \
-	-DPATH_LIBDIR=\"$(libdir)\"
+	-DPATH_LIBDIR=\"$(libdir)\" \
+	-DPREFIX=\"$(prefix)\" 
 
 openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
 all: config.h

Modified: trunk/src/OSConfigure.cpp
===================================================================
--- trunk/src/OSConfigure.cpp	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/OSConfigure.cpp	2006-04-07 15:20:02 UTC (rev 277)
@@ -37,7 +37,7 @@
 #endif
 
 #ifndef PATH_CFG
-#define PATH_CFG        "/usr/local/etc"
+#define PATH_CFG        "PREFIX/etc"
 #endif
 
 OSConfigure* conf;

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/OSFileList.cpp	2006-04-07 15:20:02 UTC (rev 277)
@@ -57,7 +57,7 @@
 
 
 #ifndef PATH_LIBDIR
-#define PATH_LIBDIR "/usr/local/lib"
+#define PATH_LIBDIR "PREFIX/lib"
 #endif
 
 FXDEFMAP (OSFileList) OSFileListMap[] =

Modified: trunk/src/OSMimeApp.cpp
===================================================================
--- trunk/src/OSMimeApp.cpp	2006-04-07 14:23:03 UTC (rev 276)
+++ trunk/src/OSMimeApp.cpp	2006-04-07 15:20:02 UTC (rev 277)
@@ -43,7 +43,7 @@
 #endif
 
 #ifndef PATH_CFG
-#define PATH_CFG        "/usr/local/etc/"
+#define PATH_CFG        "PREFIX/etc"
 #endif
 
 



From compbatant at berlios.de  Fri Apr  7 18:05:50 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 7 Apr 2006 18:05:50 +0200
Subject: [Openspace-svn] r278 - trunk/src
Message-ID: <200604071605.k37G5owQ017775@sheep.berlios.de>

Author: compbatant
Date: 2006-04-07 18:05:49 +0200 (Fri, 07 Apr 2006)
New Revision: 278

Modified:
   trunk/src/OSPreferences.cpp
Log:
aaaaaaaaaaaale bug ;)


Modified: trunk/src/OSPreferences.cpp
===================================================================
--- trunk/src/OSPreferences.cpp	2006-04-07 15:20:02 UTC (rev 277)
+++ trunk/src/OSPreferences.cpp	2006-04-07 16:05:49 UTC (rev 278)
@@ -674,13 +674,13 @@
 
 
 
-        OSCommandTypeInfo * ctlast;
+        OSCommandTypeInfo ctlast;
         string res;
         while ( conf->getnextnode ( res ) )
         {
 
             OSCommandTypeInfo ct;
-            ctlast = &ct;
+            
             commandsCombo->appendItem( res.c_str (), objmanager->osicons[ "execute" ] );
             ct.name = res;
             OSConfigure conflocal = *conf;
@@ -708,20 +708,20 @@
             ct.key_mask = conflocal.readonestring ( "/OpenspaceConfig/commands/" + res + "/key_mask" );
 
             commandsMap[ ct.name ] = ct;
-
+	    ctlast = ct;
         }
 
-        commandsRescan->setCheck( ctlast->rescan );
-        commandsCapture->setCheck( ctlast->capture );
-        commandsTextfield->setText ( ctlast->exec.c_str () );
+        commandsRescan->setCheck( ctlast.rescan );
+        commandsCapture->setCheck( ctlast.capture );
+        commandsTextfield->setText ( ctlast.exec.c_str () );
         commandsCombo->setCurrentItem ( commandsCombo->getNumItems () - 1 );
-        currentCommandName = ctlast->name;
+        currentCommandName = ctlast.name;
 
         string str;
-        if ( ctlast->type == "" )
+        if ( ctlast.type == "" )
             str = "command type: EXTERNAL";
         else
-            str = "command type: " + ctlast->type;
+            str = "command type: " + ctlast.type;
 
         commandsType->setText( str.c_str() );
         string shorticonname;
@@ -737,14 +737,14 @@
             if ( icon != NULL )
                 iconsList->appendItem( iter->first.c_str(), icon );
         }
-        if ( ctlast->icon != "" )
-            iconsList->setCurrentItem( iconsList->findItem( ctlast->icon.c_str() ) );
+        if ( ctlast.icon != "" )
+            iconsList->setCurrentItem( iconsList->findItem( ctlast.icon.c_str() ) );
 
-        if ( ctlast->key != "" )
-            shortcutList->setCurrentItem( shortcutList->findItem( ctlast->key.c_str() ) );
+        if ( ctlast.key != "" )
+            shortcutList->setCurrentItem( shortcutList->findItem( ctlast.key.c_str() ) );
 
-        if ( ctlast->key_mask != "" )
-            shortcutMaskList->setCurrentItem( shortcutMaskList->findItem( ctlast->key_mask.c_str() ) );
+        if ( ctlast.key_mask != "" )
+            shortcutMaskList->setCurrentItem( shortcutMaskList->findItem( ctlast.key_mask.c_str() ) );
 
 
 
@@ -754,7 +754,7 @@
         new FXButton ( hfr, "New Command", objmanager->osicons["plus"], this, ID_NEW_COMMAND, FRAME_RAISED|ICON_BEFORE_TEXT  );
         newCommandEdit = new FXTextField ( hfr, 20 );
 
-        if ( ctlast->type == "INTERNAL" || ctlast->type == "PLUGIN" )
+        if ( ctlast.type == "INTERNAL" || ctlast.type == "PLUGIN" )
         {
             commandsTextfield->disable();
             commandsRescan->disable();
@@ -773,7 +773,7 @@
 
     if ( conf->openxpath ( "/OpenspaceConfig/file_types" ) != -1 )
     {
-        OSFileTypeInfo * ctlast;
+        OSFileTypeInfo ctlast;
         new FXLabel( filetypePane, "File Type:" );
         fileTypeList = new FXListBox ( filetypePane, this, ID_FILETYPE_CHANGE );
         fileTypeList->setNumVisible( 30 );
@@ -864,14 +864,15 @@
             }
             OSFileTypeInfo ct;
             ct.load( res );
-            ctlast = &ct;
+            
             fileTypeList->appendItem( xml2mime( ct.name ) .c_str (), objmanager->osicons[ "unknown" ] );
 
 
             filetypesMap[ ct.name ] = ct;
+	    ctlast = ct;
         }
 
-        filetypestring = ctlast->name;
+        filetypestring = ctlast.name;
 
         map < string, FXIcon * >::iterator iter2;
         iconsList2->appendItem( "", NULL );
@@ -880,8 +881,8 @@
             FXIcon *icon = iter2->second;
             iconsList2->appendItem( iter2->first.c_str(), icon );
         }
-        if ( ctlast->icon != "" )
-            iconsList2->setCurrentItem( iconsList2->findItem( ctlast->icon.c_str() ) );
+        if ( ctlast.icon != "" )
+            iconsList2->setCurrentItem( iconsList2->findItem( ctlast.icon.c_str() ) );
 
 
 
@@ -901,8 +902,8 @@
         }
 
         vector<string>::iterator iter;
-        if ( ctlast->commands.size() > 0 )
-            for ( iter = ctlast->commands.begin();iter != ctlast->commands.end();iter++ )
+        if ( ctlast.commands.size() > 0 )
+            for ( iter = ctlast.commands.begin();iter != ctlast.commands.end();iter++ )
             {
                 additionalCommands->appendItem( iter->c_str() );
 
@@ -911,10 +912,10 @@
 
 
         fileTypeList->setCurrentItem ( fileTypeList->getNumItems () - 1 );
-        fileTypeDefaultBox->setCurrentItem( fileTypeDefaultBox->findItem( ctlast->command.c_str() ) );
+        fileTypeDefaultBox->setCurrentItem( fileTypeDefaultBox->findItem( ctlast.command.c_str() ) );
 
-        setAllColor( colorbutton, readcolor( ctlast->color ) );
-        setAllColor( backcolorbutton, readcolor2( ctlast->backcolor ) );
+        setAllColor( colorbutton, readcolor( ctlast.color ) );
+        setAllColor( backcolorbutton, readcolor2( ctlast.backcolor ) );
 
     }
 



From compbatant at berlios.de  Fri Apr  7 18:21:27 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 7 Apr 2006 18:21:27 +0200
Subject: [Openspace-svn] r279 - in trunk: icons/big icons/default src
Message-ID: <200604071621.k37GLRxm019253@sheep.berlios.de>

Author: compbatant
Date: 2006-04-07 18:21:26 +0200 (Fri, 07 Apr 2006)
New Revision: 279

Modified:
   trunk/icons/big/executable.png
   trunk/icons/big/execute.png
   trunk/icons/big/symlink.png
   trunk/icons/default/executable.png
   trunk/icons/default/execute.png
   trunk/icons/default/symlink.png
   trunk/src/Makefile
Log:
zmienione ikonki


Modified: trunk/icons/big/executable.png
===================================================================
(Binary files differ)

Modified: trunk/icons/big/execute.png
===================================================================
(Binary files differ)

Modified: trunk/icons/big/symlink.png
===================================================================
(Binary files differ)

Modified: trunk/icons/default/executable.png
===================================================================
(Binary files differ)

Modified: trunk/icons/default/execute.png
===================================================================
(Binary files differ)

Modified: trunk/icons/default/symlink.png
===================================================================
(Binary files differ)

Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-07 16:05:49 UTC (rev 278)
+++ trunk/src/Makefile	2006-04-07 16:21:26 UTC (rev 279)
@@ -201,11 +201,11 @@
 mandir = ${prefix}/man
 mkdir_p = mkdir -p -- .
 oldincludedir = /usr/include
-prefix = /root/usr
+prefix = /usr
 program_transform_name = s,x,x,
 sbindir = ${exec_prefix}/sbin
 sharedstatedir = ${prefix}/com
-sysconfdir = ${prefix}/etc
+sysconfdir = /etc
 target_alias = 
 openspace_SOURCES = main.cpp OSCMDDialogBox.cpp OSCMDDialogBox.h \
 	OSCommandTypeInfo.cpp OSCommandTypeInfo.h OSConfigure.cpp OSConfigure.h OSFile.h \



From compbatant at berlios.de  Fri Apr  7 23:58:32 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 7 Apr 2006 23:58:32 +0200
Subject: [Openspace-svn] r280 - in trunk: . src
Message-ID: <200604072158.k37LwW6h024691@sheep.berlios.de>

Author: compbatant
Date: 2006-04-07 23:58:31 +0200 (Fri, 07 Apr 2006)
New Revision: 280

Modified:
   trunk/openspacerc.in
   trunk/src/Makefile
   trunk/src/OSFileList.cpp
Log:
vfs pluginy nie zapisywaly rodzaju widoku: big icons,small,detailed


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-07 16:21:26 UTC (rev 279)
+++ trunk/openspacerc.in	2006-04-07 21:58:31 UTC (rev 280)
@@ -595,6 +595,7 @@
 		
 		<ftp>
 			<type>network</type>
+			<style>big icons</style>
 			<headers>
 				<header>size</header>
 				<header>owner</header>
@@ -624,6 +625,7 @@
 		</ftp>
 		<search>
 			<type>search</type>
+			<style>small icons</style>
 			<properties>
 				<name>
 					<width>400</width>					
@@ -632,6 +634,7 @@
 		</search>
 		<archive>
 			<type>vfs</type>
+			<style>small icons</style>
 			<properties>
 				<name>
 					<width>400</width>					

Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-07 16:21:26 UTC (rev 279)
+++ trunk/src/Makefile	2006-04-07 21:58:31 UTC (rev 280)
@@ -128,7 +128,7 @@
 CXX = g++
 CXXCPP = g++ -E
 CXXDEPMODE = depmode=gcc3
-CXXFLAGS = -g -O2
+CXXFLAGS = -O0
 CYGPATH_W = echo
 DEFS = -DHAVE_CONFIG_H
 DEPDIR = .deps

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-07 16:21:26 UTC (rev 279)
+++ trunk/src/OSFileList.cpp	2006-04-07 21:58:31 UTC (rev 280)
@@ -154,7 +154,6 @@
     else if (style == "detailed")
     this->setListStyle (ICONLIST_EXTENDEDSELECT | ICONLIST_DETAILED | ICONLIST_COLUMNS);
 
-
     sort_nr = 0;
 
 



From compbatant at berlios.de  Sat Apr  8 14:10:20 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sat, 8 Apr 2006 14:10:20 +0200
Subject: [Openspace-svn] r281 - trunk/src
Message-ID: <200604081210.k38CAKhX002059@sheep.berlios.de>

Author: compbatant
Date: 2006-04-08 14:09:40 +0200 (Sat, 08 Apr 2006)
New Revision: 281

Modified:
   trunk/src/Makefile
   trunk/src/OSFileList.cpp
Log:
pewien segfault usuniety przy zamykaniu panelu


Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-07 21:58:31 UTC (rev 280)
+++ trunk/src/Makefile	2006-04-08 12:09:40 UTC (rev 281)
@@ -128,7 +128,7 @@
 CXX = g++
 CXXCPP = g++ -E
 CXXDEPMODE = depmode=gcc3
-CXXFLAGS = -O0
+CXXFLAGS = -O0 -g
 CYGPATH_W = echo
 DEFS = -DHAVE_CONFIG_H
 DEPDIR = .deps

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-07 21:58:31 UTC (rev 280)
+++ trunk/src/OSFileList.cpp	2006-04-08 12:09:40 UTC (rev 281)
@@ -345,6 +345,11 @@
 OSFileList::~OSFileList ()
 {
 
+    if (popupmenu)
+    {
+    delete popupmenu;
+    }
+
     fb->quit ();
     delete sortpop;
     FXTRACE ((5, "destruct\n"));



From compbatant at berlios.de  Thu Apr 13 22:42:26 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Thu, 13 Apr 2006 22:42:26 +0200
Subject: [Openspace-svn] r282 - in trunk: . src
Message-ID: <200604132042.k3DKgQLs021049@sheep.berlios.de>

Author: compbatant
Date: 2006-04-13 22:42:25 +0200 (Thu, 13 Apr 2006)
New Revision: 282

Modified:
   trunk/openspacerc.in
   trunk/src/Makefile
   trunk/src/OSFileList.cpp
Log:
teraz polecenia wpisywane w gornym edit sa wywolywane jako odzielny proces i nie zawieszaja programu


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-08 12:09:40 UTC (rev 281)
+++ trunk/openspacerc.in	2006-04-13 20:42:25 UTC (rev 282)
@@ -251,10 +251,6 @@
 			<type>INTERNAL</type>
 			<icon>other</icon>
 		</other>
-		<ls>
-			<exec>ls</exec>
-			<options>capture</options>
-		</ls>
 		<special>
 			<type>INTERNAL</type>
 		</special>
@@ -532,7 +528,6 @@
 			<command>special</command>
 			<command>totalsize</command>
 			<command>new_file</command>
-			<command>ls</command>
 		</common>
 		<compress>
 			<command>OSCompress</command>

Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-08 12:09:40 UTC (rev 281)
+++ trunk/src/Makefile	2006-04-13 20:42:25 UTC (rev 282)
@@ -128,7 +128,7 @@
 CXX = g++
 CXXCPP = g++ -E
 CXXDEPMODE = depmode=gcc3
-CXXFLAGS = -O0 -g
+CXXFLAGS = -O2
 CYGPATH_W = echo
 DEFS = -DHAVE_CONFIG_H
 DEPDIR = .deps

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-08 12:09:40 UTC (rev 281)
+++ trunk/src/OSFileList.cpp	2006-04-13 20:42:25 UTC (rev 282)
@@ -337,9 +337,9 @@
 
 long OSFileList::texfield_run (FXObject * obj, FXSelector sel, void *ptr)
 {
+string cmd=textfield->getText ().text()+string(" &");
+system(cmd.c_str());
 
-system(textfield->getText ().text());
-
 }
 
 OSFileList::~OSFileList ()



From compbatant at berlios.de  Thu Apr 13 22:55:09 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Thu, 13 Apr 2006 22:55:09 +0200
Subject: [Openspace-svn] r283 - trunk/src/plugins/cmddialog
Message-ID: <200604132055.k3DKt9Gl021917@sheep.berlios.de>

Author: compbatant
Date: 2006-04-13 22:55:08 +0200 (Thu, 13 Apr 2006)
New Revision: 283

Modified:
   trunk/src/plugins/cmddialog/OSAccess.cpp
   trunk/src/plugins/cmddialog/OSClone.cpp
   trunk/src/plugins/cmddialog/OSCompress.cpp
   trunk/src/plugins/cmddialog/OSEditSymlink.cpp
   trunk/src/plugins/cmddialog/OSMd5sum.cpp
   trunk/src/plugins/cmddialog/OSMkdir.cpp
   trunk/src/plugins/cmddialog/OSRename.cpp
   trunk/src/plugins/cmddialog/OSSymlink.cpp
Log:
poprawka dla wrednych kompilatorow;)


Modified: trunk/src/plugins/cmddialog/OSAccess.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSAccess.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSAccess.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -77,7 +77,7 @@
     }
     OSAccess (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
-    virtual int OSAccess::exec (void)
+    int exec (void)
     {
 
 	unsigned int mode = 0;

Modified: trunk/src/plugins/cmddialog/OSClone.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSClone.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSClone.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -43,7 +43,7 @@
     OSClone ( FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src );
 
 
-    virtual int OSClone::exec ( void )
+    int exec ( void )
     {
         int error = 0;
     

Modified: trunk/src/plugins/cmddialog/OSCompress.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSCompress.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSCompress.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -47,7 +47,7 @@
     OSCompress (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
 
-    virtual int OSCompress::exec (void)
+    int exec (void)
     {
 	int error = 0;
 	vector < string >::iterator iter;

Modified: trunk/src/plugins/cmddialog/OSEditSymlink.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSEditSymlink.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSEditSymlink.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -46,7 +46,7 @@
     OSEditSymlink (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
 
-    virtual int OSEditSymlink::exec (void)
+    int exec (void)
     {
     
         int error = 0;

Modified: trunk/src/plugins/cmddialog/OSMd5sum.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSMd5sum.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSMd5sum.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -45,7 +45,7 @@
     OSMd5sum (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
 
-    virtual int OSMd5sum::exec (void)
+    virtual int exec (void)
     {
 	
     }

Modified: trunk/src/plugins/cmddialog/OSMkdir.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSMkdir.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSMkdir.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -33,7 +33,7 @@
     }
     OSMkdir (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
-    int OSMkdir::exec (void)
+    int exec (void)
     {
 	string s = text->getText ().text ();
 	fb->mkdir (s, 493);

Modified: trunk/src/plugins/cmddialog/OSRename.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSRename.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSRename.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -44,7 +44,7 @@
     OSRename (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
 
-    virtual int OSRename::exec (void)
+    int exec (void)
     {
 	int error = 0;
 	vector < string >::iterator iter;

Modified: trunk/src/plugins/cmddialog/OSSymlink.cpp
===================================================================
--- trunk/src/plugins/cmddialog/OSSymlink.cpp	2006-04-13 20:42:25 UTC (rev 282)
+++ trunk/src/plugins/cmddialog/OSSymlink.cpp	2006-04-13 20:55:08 UTC (rev 283)
@@ -45,7 +45,7 @@
     OSSymlink (FXWindow * w, OSVirtualFileSystemBase * fb, vector < string > src);
 
 
-    virtual int OSSymlink::exec (void)
+    int exec (void)
     {
 	int error = 0;
 	vector < string >::iterator iter;



From compbatant at berlios.de  Sun Apr 16 02:03:07 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 16 Apr 2006 02:03:07 +0200
Subject: [Openspace-svn] r284 - in trunk: . src
Message-ID: <200604160003.k3G03769006236@sheep.berlios.de>

Author: compbatant
Date: 2006-04-16 02:02:26 +0200 (Sun, 16 Apr 2006)
New Revision: 284

Modified:
   trunk/openspacerc.in
   trunk/src/Makefile
   trunk/src/Makefile.am
   trunk/src/Makefile.in
   trunk/src/OSFileList.cpp
   trunk/src/OSFileList.h
   trunk/src/OSPreferences.cpp
   trunk/src/OSPreferences.h
Log:
dodanie rozpoznawanie typu pliku na podstawie zawartosci jako opcje


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/openspacerc.in	2006-04-16 00:02:26 UTC (rev 284)
@@ -7,6 +7,7 @@
 	<position>center</position>
 	<icon_size>64</icon_size>
 	<show_hidden_files>true</show_hidden_files>
+	<mime_magic>false</mime_magic>
 	  <fonts>
 	         <normalfont>arial,90,,,normal,iso8859-1,0</normalfont>
     		 <captionfont1>arial,90,bold,,normal,iso8859-1,0</captionfont1>

Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/Makefile	2006-04-16 00:02:26 UTC (rev 284)
@@ -224,7 +224,7 @@
 	-DPATH_LIBDIR=\"$(libdir)\" \
 	-DPREFIX=\"$(prefix)\" 
 
-openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
+openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs` -lmagic  
 all: config.h
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/Makefile.am	2006-04-16 00:02:26 UTC (rev 284)
@@ -18,6 +18,6 @@
 	-DPATH_LIBDIR=\"$(libdir)\" \
 	-DPREFIX=\"$(prefix)\" 
 
-openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
+openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs` -lmagic  
 
 

Modified: trunk/src/Makefile.in
===================================================================
--- trunk/src/Makefile.in	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/Makefile.in	2006-04-16 00:02:26 UTC (rev 284)
@@ -224,7 +224,7 @@
 	-DPATH_LIBDIR=\"$(libdir)\" \
 	-DPREFIX=\"$(prefix)\" 
 
-openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs`  
+openspace_LDFLAGS = `WANT_FOX="1.4" fox-config --libs`  `xml2-config  --libs` -lmagic  
 all: config.h
 	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/OSFileList.cpp	2006-04-16 00:02:26 UTC (rev 284)
@@ -91,8 +91,9 @@
 FXIMPLEMENT (OSFileList, FXIconList, OSFileListMap, ARRAYNUMBER (OSFileListMap))
      bool OSFileList::ascend = true;
      bool OSFileList::strcase = false;
+     bool OSFileList::mime_magic = false;
+     magic_set* OSFileList::ms = NULL;
 
-
 //-----FILELIST----------------------------------------------------------------------------------------------------------------------------------------- 
 
 
@@ -100,6 +101,24 @@
 OSFileList::OSFileList (FXComposite * p, OSPathType pt,long id,OSFileListController* controller):
 FXIconList (p, this, ID_ICO, LAYOUT_FILL_X | LAYOUT_FILL_Y | ICONLIST_EXTENDEDSELECT | ICONLIST_COLUMNS)
 {
+
+if(ms==NULL)
+{
+//fxmessage("LOAD");
+ms = magic_open(MAGIC_MIME);
+    if (ms != NULL) 
+    {
+    	if(magic_load(ms, NULL) == -1) 
+    	{
+	magic_close(ms);
+	ms=NULL;
+	}
+	//else
+	//fxmessage("OK\n");
+
+    }
+}
+
 objmanager=OSObjectManager::instance(getApp());
  
 FXScrollArea::vertical->setArrowColor(FXRGB(255, 255, 255));
@@ -125,6 +144,12 @@
     else
     show_hidden_files=false;
 
+    if(conf->readonestring ("/OpenspaceConfig/mime_magic")=="true")
+    mime_magic=true;
+    else
+    mime_magic=false;
+
+
     dropaction = DRAG_MOVE;   
 
    
@@ -345,6 +370,8 @@
 OSFileList::~OSFileList ()
 {
 
+ //magic_close(ms);
+ 
     if (popupmenu)
     {
     delete popupmenu;
@@ -439,10 +466,23 @@
 
     //std::transform (name.begin (), name.end (), name.begin (), std::tolower);
 
-    string r = OSMimeType::getMimeFromName (name);
+    string r;
+    
+    if(!mime_magic)
+    {
+      r = OSMimeType::getMimeFromName (name);      
+    }
+    else
+    {	
+      r = magic_file(ms, name.c_str());
+      string::size_type n;
+      if((n=r.find(";"))!=string::npos)
+      {
+       r=r.substr(0,n);
+      }
+    } 
+   //printf("Name: '%s' MimeType: '%s'\n", name.c_str(), r.c_str());
 
-    //printf("Name: '%s' MimeType: '%s'\n", name.c_str(), r.c_str());
-
     return r;
 
 }

Modified: trunk/src/OSFileList.h
===================================================================
--- trunk/src/OSFileList.h	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/OSFileList.h	2006-04-16 00:02:26 UTC (rev 284)
@@ -31,6 +31,8 @@
 #include <string>
 #include <map>
 
+#include <magic.h>
+
 #include "OSVirtualFileSystemBase.h"
 #include "OSPathType.h"
 #include "OSThreadExec.h"
@@ -54,6 +56,8 @@
     OSPathType *pt;
     long id;
     
+    static  magic_set *ms;
+    
     OSFileListController *controller;  
 
     FXWindow *notifyparent;
@@ -84,6 +88,7 @@
 
     static bool ascend;
     static bool strcase;
+    static bool mime_magic;
 
     bool processing;
     bool maximize;

Modified: trunk/src/OSPreferences.cpp
===================================================================
--- trunk/src/OSPreferences.cpp	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/OSPreferences.cpp	2006-04-16 00:02:26 UTC (rev 284)
@@ -398,6 +398,19 @@
     placement->setNumVisible( 2 );
     placement->appendItem( "centered" );
     placement->appendItem( "cursor" );
+    
+    if(conf->readonestring ( "/OpenspaceConfig/position")=="cursor")
+    placement->setCurrentItem(1);
+    
+    new FXLabel ( mainpane, "determine file type" );
+    mime_determine = new FXListBox ( mainpane );
+    mime_determine->setNumVisible( 2 );
+    mime_determine->appendItem( "filename" );
+    mime_determine->appendItem( "file content" );
+    
+    
+    if(conf->readonestring ( "/OpenspaceConfig/mime_magic")=="true")
+    mime_determine->setCurrentItem(1);
 
     string iconsdir = conf->readonestring ( "/OpenspaceConfig/path" ) + "/icons";
     struct dirent *dp;
@@ -1475,6 +1488,13 @@
 
 
     conf->saveonestring ( "/OpenspaceConfig/position", placement->getItem ( placement->getCurrentItem() ).text() );
+    
+    string mime_determine_s=mime_determine->getItem ( mime_determine->getCurrentItem() ).text();
+    if(mime_determine_s=="filename")
+    conf->saveonestring ( "/OpenspaceConfig/mime_magic","false"  );
+    else
+    conf->saveonestring ( "/OpenspaceConfig/mime_magic","true"  );
+    
 
 }
 

Modified: trunk/src/OSPreferences.h
===================================================================
--- trunk/src/OSPreferences.h	2006-04-13 20:55:08 UTC (rev 283)
+++ trunk/src/OSPreferences.h	2006-04-16 00:02:26 UTC (rev 284)
@@ -96,7 +96,7 @@
     FXVerticalFrame *vfsPane;
     FXListBox *vfsList;
     FXList*headersList, *availableHeadersList;
-    FXListBox *placement;
+    FXListBox *placement,*mime_determine;
 
     FXList *additionalCommands, *additionalCommandsAvailable, *additionalCommandsAvailableForButtons;
     FXList *shutterCommands;



From compbatant at berlios.de  Mon Apr 17 14:52:54 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Mon, 17 Apr 2006 14:52:54 +0200
Subject: [Openspace-svn] r285 - trunk/src
Message-ID: <200604171252.k3HCqs3V000749@sheep.berlios.de>

Author: compbatant
Date: 2006-04-17 14:52:50 +0200 (Mon, 17 Apr 2006)
New Revision: 285

Modified:
   trunk/src/OSFileList.cpp
   trunk/src/OSFileList.h
Log:
wyswietlanie szczegolowych informacji o typie pliku w statusbarze, wyswietalnie wielkosci pliku takze w bajtach


Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-16 00:02:26 UTC (rev 284)
+++ trunk/src/OSFileList.cpp	2006-04-17 12:52:50 UTC (rev 285)
@@ -93,6 +93,7 @@
      bool OSFileList::strcase = false;
      bool OSFileList::mime_magic = false;
      magic_set* OSFileList::ms = NULL;
+     magic_set* OSFileList::ms2 = NULL;
 
 //-----FILELIST----------------------------------------------------------------------------------------------------------------------------------------- 
 
@@ -119,6 +120,24 @@
     }
 }
 
+
+if(ms2==NULL)
+{
+//fxmessage("LOAD");
+ms2 = magic_open(MAGIC_NONE);
+    if (ms != NULL) 
+    {
+    	if(magic_load(ms2, NULL) == -1) 
+    	{
+	magic_close(ms2);
+	ms2=NULL;
+	}
+	//else
+	//fxmessage("OK\n");
+
+    }
+}
+
 objmanager=OSObjectManager::instance(getApp());
  
 FXScrollArea::vertical->setArrowColor(FXRGB(255, 255, 255));
@@ -480,6 +499,10 @@
       {
        r=r.substr(0,n);
       }
+      
+      if(r=="")
+      r = OSMimeType::getMimeFromName (name);
+      
     } 
    //printf("Name: '%s' MimeType: '%s'\n", name.c_str(), r.c_str());
 
@@ -488,6 +511,15 @@
 }
 
      
+
+string OSFileList::getfiledescription (string name)
+{
+
+      string r;   
+      r = magic_file(ms2, name.c_str());      
+      return r;
+
+}
  
 
 //return command with replaced {f} with valid path
@@ -1998,10 +2030,10 @@
 
     }
     }
-    string inf = "selected: " + ntos (count) + " size: " + numtostring (size);
+    string inf = "selected: " + ntos (count) + " size: " + numtostring (size) + " ( "+ ntos(size) + " B )";
     if (count == 1)
     {
-    inf = inf + " " + os->osf.name;
+    inf = inf + " type: "+getfiletype(os->osf.name) + "\n "+getfiledescription(os->osf.name)+ "  " + os->osf.name;
     }
 
 

Modified: trunk/src/OSFileList.h
===================================================================
--- trunk/src/OSFileList.h	2006-04-16 00:02:26 UTC (rev 284)
+++ trunk/src/OSFileList.h	2006-04-17 12:52:50 UTC (rev 285)
@@ -57,6 +57,7 @@
     long id;
     
     static  magic_set *ms;
+    static  magic_set *ms2;
     
     OSFileListController *controller;  
 
@@ -116,6 +117,7 @@
     string resolvecommand( string command, string name );
     int runCommand( string name );
     static string getfiletype ( string name );
+    static string getfiledescription ( string name );
     long setKeys ( void );
 
 public:



From compbatant at berlios.de  Fri Apr 28 18:25:46 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 28 Apr 2006 18:25:46 +0200
Subject: [Openspace-svn] r286 - in trunk: . src/plugins/filelist
Message-ID: <200604281625.k3SGPklh012508@sheep.berlios.de>

Author: compbatant
Date: 2006-04-28 18:25:45 +0200 (Fri, 28 Apr 2006)
New Revision: 286

Added:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
   trunk/src/plugins/filelist/OSVfsSftp.h
Modified:
   trunk/openspacerc.in
   trunk/src/plugins/filelist/Makefile.am
   trunk/src/plugins/filelist/Makefile.in
Log:
poczatek prac nad dodaniem obslugi sftp, biblioteka libssh potrzebna do skompilowania


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-17 12:52:50 UTC (rev 285)
+++ trunk/openspacerc.in	2006-04-28 16:25:45 UTC (rev 286)
@@ -426,6 +426,12 @@
 							<command>unzip</command>
 					</commands>
 				</zip>
+				<x-zip>
+					<icon>mime-application-x-compressed-tar</icon>
+					<commands>
+							<command>unzip</command>
+					</commands>
+				</x-zip>				
 				<x-cd-image>
 					<icon>mime-application-x-cd-image</icon>
 				</x-cd-image>
@@ -619,6 +625,15 @@
 				</mode>
 			</properties>	
 		</ftp>
+		<sftp>
+			<type>network</type>
+			<style>small icons</style>
+			<properties>
+				<name>
+					<width>400</width>					
+				</name>
+			</properties>	
+		</sftp>
 		<search>
 			<type>search</type>
 			<style>small icons</style>

Modified: trunk/src/plugins/filelist/Makefile.am
===================================================================
--- trunk/src/plugins/filelist/Makefile.am	2006-04-17 12:52:50 UTC (rev 285)
+++ trunk/src/plugins/filelist/Makefile.am	2006-04-28 16:25:45 UTC (rev 286)
@@ -1,4 +1,4 @@
-pkglib_LTLIBRARIES= libOSVfsLocal.la libOSVfsSearch.la libOSVfsArchive.la libOSVfsFtp.la   
+pkglib_LTLIBRARIES= libOSVfsLocal.la libOSVfsSearch.la libOSVfsArchive.la libOSVfsFtp.la    libOSVfsSftp.la
 pkglibdir=$(libdir)/openspace/plugins/filelist
 INCLUDES = `WANT_FOX="1.4" fox-config --cflags` `xml2-config  --cflags` 
 
@@ -12,7 +12,10 @@
 libOSVfsFtp_la_LDFLAGS = `WANT_FOX=1.4 fox-config --libs` `xml2-config  --libs`
 libOSVfsFtp_la_SOURCES =OSVfsFtp.cpp OSVfsFtp.h  pftp.cpp pftp.h  ../../OSThreadExec.cpp ../../OSThreadExec.h ../../OSConfigure.h 
 
+libOSVfsSftp_la_LDFLAGS = `WANT_FOX=1.4 fox-config --libs` `xml2-config  --libs` -lssh
+libOSVfsSftp_la_SOURCES =OSVfsSftp.cpp OSVfsSftp.h OSFXFile.cpp OSFXFile.h ../../OSThreadExec.cpp ../../OSThreadExec.h  ../../OSConfigure.h 
 
+
 #libfilelistsftp_la_LDFLAGS = `WANT_FOX=1.4 fox-config --libs` `xml2-config  --libs`
 #libfilelistsftp_la_SOURCES =filelist_sftp.cpp filelist_sftp.h  ../../OSThreadExec.cpp ../../OSThreadExec.h  ../../OSConfigure.h 
 

Modified: trunk/src/plugins/filelist/Makefile.in
===================================================================
--- trunk/src/plugins/filelist/Makefile.in	2006-04-17 12:52:50 UTC (rev 285)
+++ trunk/src/plugins/filelist/Makefile.in	2006-04-28 16:25:45 UTC (rev 286)
@@ -14,7 +14,7 @@
 
 @SET_MAKE@
 
-SOURCES = $(libOSVfsArchive_la_SOURCES) $(libOSVfsFtp_la_SOURCES) $(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES)
+SOURCES = $(libOSVfsArchive_la_SOURCES) $(libOSVfsFtp_la_SOURCES) $(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES) $(libOSVfsSftp_la_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
@@ -62,6 +62,9 @@
 am_libOSVfsSearch_la_OBJECTS = OSVfsSearch.lo OSFXFile.lo \
 	OSThreadExec.lo
 libOSVfsSearch_la_OBJECTS = $(am_libOSVfsSearch_la_OBJECTS)
+libOSVfsSftp_la_LIBADD =
+am_libOSVfsSftp_la_OBJECTS = OSVfsSftp.lo OSFXFile.lo OSThreadExec.lo
+libOSVfsSftp_la_OBJECTS = $(am_libOSVfsSftp_la_OBJECTS)
 DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/src
 depcomp = $(SHELL) $(top_srcdir)/depcomp
 am__depfiles_maybe = depfiles
@@ -71,7 +74,8 @@
 @AMDEP_TRUE@	./$(DEPDIR)/OSVfsArchive.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/OSVfsFtp.Plo \
 @AMDEP_TRUE@	./$(DEPDIR)/OSVfsLocal.Plo \
- at AMDEP_TRUE@	./$(DEPDIR)/OSVfsSearch.Plo ./$(DEPDIR)/pftp.Plo
+ at AMDEP_TRUE@	./$(DEPDIR)/OSVfsSearch.Plo \
+ at AMDEP_TRUE@	./$(DEPDIR)/OSVfsSftp.Plo ./$(DEPDIR)/pftp.Plo
 CXXCOMPILE = $(CXX) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) \
 	$(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CXXFLAGS) $(CXXFLAGS)
 LTCXXCOMPILE = $(LIBTOOL) --mode=compile $(CXX) $(DEFS) \
@@ -89,9 +93,11 @@
 LINK = $(LIBTOOL) --mode=link $(CCLD) $(AM_CFLAGS) $(CFLAGS) \
 	$(AM_LDFLAGS) $(LDFLAGS) -o $@
 SOURCES = $(libOSVfsArchive_la_SOURCES) $(libOSVfsFtp_la_SOURCES) \
-	$(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES)
+	$(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES) \
+	$(libOSVfsSftp_la_SOURCES)
 DIST_SOURCES = $(libOSVfsArchive_la_SOURCES) $(libOSVfsFtp_la_SOURCES) \
-	$(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES)
+	$(libOSVfsLocal_la_SOURCES) $(libOSVfsSearch_la_SOURCES) \
+	$(libOSVfsSftp_la_SOURCES)
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -192,7 +198,7 @@
 sharedstatedir = @sharedstatedir@
 sysconfdir = @sysconfdir@
 target_alias = @target_alias@
-pkglib_LTLIBRARIES = libOSVfsLocal.la libOSVfsSearch.la libOSVfsArchive.la libOSVfsFtp.la   
+pkglib_LTLIBRARIES = libOSVfsLocal.la libOSVfsSearch.la libOSVfsArchive.la libOSVfsFtp.la    libOSVfsSftp.la
 INCLUDES = `WANT_FOX="1.4" fox-config --cflags` `xml2-config  --cflags` 
 libOSVfsLocal_la_LDFLAGS = `WANT_FOX="1.4" fox-config --libs` `xml2-config  --libs`  
 libOSVfsLocal_la_SOURCES = OSVfsLocal.cpp OSVfsLocal.h OSFXFile.cpp OSFXFile.h ../../OSThreadExec.cpp ../../OSThreadExec.h  ../../OSConfigure.h ../../OSUtils.cpp ../../OSUtils.h 
@@ -202,6 +208,8 @@
 libOSVfsArchive_la_SOURCES = OSVfsArchive.cpp OSVfsArchive.h ../../OSThreadExec.cpp ../../OSThreadExec.h  ../../OSConfigure.h 
 libOSVfsFtp_la_LDFLAGS = `WANT_FOX=1.4 fox-config --libs` `xml2-config  --libs`
 libOSVfsFtp_la_SOURCES = OSVfsFtp.cpp OSVfsFtp.h  pftp.cpp pftp.h  ../../OSThreadExec.cpp ../../OSThreadExec.h ../../OSConfigure.h 
+libOSVfsSftp_la_LDFLAGS = `WANT_FOX=1.4 fox-config --libs` `xml2-config  --libs` -lssh
+libOSVfsSftp_la_SOURCES = OSVfsSftp.cpp OSVfsSftp.h OSFXFile.cpp OSFXFile.h ../../OSThreadExec.cpp ../../OSThreadExec.h  ../../OSConfigure.h 
 all: all-am
 
 .SUFFIXES:
@@ -270,6 +278,8 @@
 	$(CXXLINK) -rpath $(pkglibdir) $(libOSVfsLocal_la_LDFLAGS) $(libOSVfsLocal_la_OBJECTS) $(libOSVfsLocal_la_LIBADD) $(LIBS)
 libOSVfsSearch.la: $(libOSVfsSearch_la_OBJECTS) $(libOSVfsSearch_la_DEPENDENCIES) 
 	$(CXXLINK) -rpath $(pkglibdir) $(libOSVfsSearch_la_LDFLAGS) $(libOSVfsSearch_la_OBJECTS) $(libOSVfsSearch_la_LIBADD) $(LIBS)
+libOSVfsSftp.la: $(libOSVfsSftp_la_OBJECTS) $(libOSVfsSftp_la_DEPENDENCIES) 
+	$(CXXLINK) -rpath $(pkglibdir) $(libOSVfsSftp_la_LDFLAGS) $(libOSVfsSftp_la_OBJECTS) $(libOSVfsSftp_la_LIBADD) $(LIBS)
 
 mostlyclean-compile:
 	-rm -f *.$(OBJEXT)
@@ -284,6 +294,7 @@
 @AMDEP_TRUE@@am__include@ @am__quote at ./$(DEPDIR)/OSVfsFtp.Plo at am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote at ./$(DEPDIR)/OSVfsLocal.Plo at am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote at ./$(DEPDIR)/OSVfsSearch.Plo at am__quote@
+ at AMDEP_TRUE@@am__include@ @am__quote at ./$(DEPDIR)/OSVfsSftp.Plo at am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote at ./$(DEPDIR)/pftp.Plo at am__quote@
 
 .cpp.o:

Added: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-17 12:52:50 UTC (rev 285)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 16:25:45 UTC (rev 286)
@@ -0,0 +1,361 @@
+
+#ifdef WIN32
+#define EXPORTFUNCTION extern "C" __declspec(dllexport)
+#else
+#define EXPORTFUNCTION extern "C"
+#endif
+
+#include "OSVfsSftp.h"
+#include "OSFXFile.h"
+#include "../../OSVirtualFileSystemHeader.h"
+#include "../../OSVirtualFileSystemInfo.h"
+#include "../../OSThreadExec.h"
+#include "../../OSFile.h"
+#include "../../OSUtils.h"
+
+#ifdef WIN32
+#define SEPARATOR "\\"
+#else
+#include <dlfcn.h>
+#define SEPARATOR "/"
+#endif
+
+#include <fx.h>
+#include <errno.h>
+#include <fstream>
+#include <sstream>
+#include <sys/mount.h>
+#include <sys/types.h>
+#include <unistd.h>
+#include <pwd.h>
+#include <grp.h>
+
+#include <string>
+#include <vector>
+#include <iostream>
+
+using namespace std;
+
+
+OSVirtualFileSystemInfo OSVfsSftp::setup (void)
+{
+	OSVirtualFileSystemInfo v;
+	
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("name"));
+	v.information="SFTP file list - default plugin";
+	v.version="1";
+	
+    return v;	
+}
+
+int OSVfsSftp::init (long id, std::vector<std::string> *vector_name, OSPathType pt, OSConfigure * conf)
+{
+    this->id=id;
+    fields = (*vector_name);
+
+
+
+    dirsftp=NULL;
+
+    
+    SSH_OPTIONS *options;
+    int auth=0;
+    char *password;
+    char *banner;
+    int state;
+    char buf[10];
+    char hash[MD5_DIGEST_LEN];
+
+    options=options_new();
+    if(!options)
+    {
+        fprintf(stderr,"Error : %s\n",ssh_get_error(NULL));
+        return -1;
+    } 
+      
+    options_set_username(options,(char*)pt.user.c_str());
+    options_set_host(options,(char*)pt.server.c_str());
+    session=ssh_connect(options);
+    
+    if(!session)
+    {
+        fprintf(stderr,"Connection failed : %s\n",ssh_get_error(NULL));
+        return -1;
+    }
+
+    state=ssh_is_server_known(session);
+    switch(state){
+        case SSH_SERVER_KNOWN_OK:
+            break; /* ok */
+        case SSH_SERVER_KNOWN_CHANGED:
+            fprintf(stderr,"Host key for server changed : server's one is now :\n");
+            ssh_get_pubkey_hash(session,hash);
+            ssh_print_hexa("Public key hash",(unsigned char*)hash,MD5_DIGEST_LEN);
+            fprintf(stderr,"For security reason, connection will be stopped\n");
+            ssh_disconnect(session);
+            return -1;
+        case SSH_SERVER_FOUND_OTHER:
+            fprintf(stderr,"The host key for this server was not found but an other type of key exists.\n");
+            fprintf(stderr,"An attacker might change the default server key to confuse your client"
+                "into thinking the key does not exist\n"
+                "We advise you to rerun the client with -d or -r for more safety.\n");
+                ssh_disconnect(session);
+              return -1;
+        case SSH_SERVER_NOT_KNOWN:
+            fprintf(stderr,"The server is unknown. Do you trust the host key ?\n");
+            ssh_get_pubkey_hash(session,hash);
+            ssh_print_hexa("Public key hash",(unsigned char*)hash,MD5_DIGEST_LEN);
+            fgets(buf,sizeof(buf),stdin);
+            if(strncasecmp(buf,"yes",3)!=0){
+                ssh_disconnect(session);
+                return -1;
+            }
+            fprintf(stderr,"This new key will be written on disk for further usage. do you agree ?\n");
+            fgets(buf,sizeof(buf),stdin);
+            if(strncasecmp(buf,"yes",3)==0){
+                if(ssh_write_knownhost(session))
+                    fprintf(stderr,"error %s\n",ssh_get_error(session));
+            }
+            
+            break;
+        case SSH_SERVER_ERROR:
+            fprintf(stderr,"%s",ssh_get_error(session));
+            ssh_disconnect(session);
+            return -1;
+    }
+
+    /* no ? you should :) */
+    auth=ssh_userauth_autopubkey(session);
+    if(auth==SSH_AUTH_ERROR){
+        fprintf(stderr,"Authenticating with pubkey: %s\n",ssh_get_error(session));
+        return -1;
+    }
+    banner=ssh_get_issue_banner(session);
+    if(banner){
+        printf("%s\n",banner);
+        free(banner);
+    }
+    if(auth!=SSH_AUTH_SUCCESS){
+        //M auth=auth_kbdint(session);
+        if(auth==SSH_AUTH_ERROR){
+            fprintf(stderr,"authenticating with keyb-interactive: %s\n",
+                    ssh_get_error(session));
+            return -1;
+        }
+    }
+    if(auth!=SSH_AUTH_SUCCESS){
+        password=getpass("Password : ");
+        if(ssh_userauth_password(session,NULL,password) != SSH_AUTH_SUCCESS){
+            fprintf(stderr,"Authentication failed: %s\n",ssh_get_error(session));
+            ssh_disconnect(session);
+            return -1;
+        }
+        memset(password,0,strlen(password));
+    }
+    ssh_say(1,"Authentication success\n");
+
+
+     //do_sftp(session);    
+    //if(!sftp)
+        //do_cleanup();
+    
+
+    sftp=sftp_new(session);
+    
+    if(!sftp)
+    {
+        ssh_say(0,"sftp error initialising channel : %s\n",ssh_get_error(session));
+        return -1;
+    }
+    if(sftp_init(sftp))
+    {
+        ssh_say(0,"error initialising sftp : %s\n",ssh_get_error(session));
+        return -1;
+    }
+    /* the connection is made */
+    
+
+
+    return 0;
+}
+
+
+OSFile OSVfsSftp::osreaddir ()
+{
+
+    OSFile os_file;
+
+    SFTP_ATTRIBUTES *file=sftp_readdir(sftp,dirsftp);
+    
+    if(file)
+    {
+    os_file.name=file->name;
+    	if((file->permissions & S_IFMT) == S_IFDIR)
+	os_file.type = FOLDER;
+	else
+        os_file.type = 0;
+    
+    //fxmessage("name=%s type=%x\n",file->name,file->permissions);
+    
+    sftp_attributes_free(file);
+    return os_file;
+    }
+
+
+    os_file.name = "";
+    return os_file;
+
+
+}
+
+
+std::string OSVfsSftp::getinitialdir( void )
+{
+       char* path="./";    
+       return string(sftp_canonicalize_path(sftp, path));
+}
+
+
+
+int OSVfsSftp::osopendir (std::string dir)
+{
+  
+    if(dirsftp)
+    sftp_dir_close(dirsftp);   
+
+    
+    /* opening a directory */
+  
+    dirsftp=sftp_opendir(sftp,(char*)dir.c_str());
+    
+    if(!dirsftp) 
+    {
+        ssh_say(0,"Directory not opened(%s)\n",ssh_get_error(session));
+        return -1;
+    }
+
+
+    /*
+    
+     reading the whole directory, file by file 
+    while((file=sftp_readdir(sftp,dir))){
+        ssh_say(0,"%30s(%.8lo) : %.5d.%.5d : %.10lld bytes\n",file->name,file->permissions,file->uid,file->gid,file->size);
+        sftp_attributes_free(file);
+    }
+     when file=NULL, an error has occured OR the directory listing is end of file 
+    if(!sftp_dir_eof(dir)){
+        ssh_say(0,"error : %s\n",ssh_get_error(session));
+        return -1;
+    }
+    if(sftp_dir_close(dir)){
+        ssh_say(0,"Error : %s\n",ssh_get_error(session));
+        return -1;
+    }
+
+*/
+
+}
+
+int OSVfsSftp::mkdir (std::string dir, int mode)
+{
+  
+}
+
+int OSVfsSftp::copy ( OSThreadExec * te)
+{
+
+}
+
+int OSVfsSftp::move (OSThreadExec* te)
+{
+
+}
+
+
+int OSVfsSftp::remove (OSThreadExec* te)
+{
+
+
+
+}
+
+int OSVfsSftp::rename (std::string orgname, std::string newname)
+{
+
+}
+
+
+int OSVfsSftp::copymove (OSThreadExec* te, bool copy)
+{
+
+  
+}
+
+
+
+void OSVfsSftp::totalsize (std::string path, unsigned long &size)
+{
+
+   
+}
+
+std::string OSVfsSftp::info (void)
+{
+    return "";
+}
+
+
+int OSVfsSftp::mode (std::string file)
+{
+    
+}
+
+bool OSVfsSftp::mode (std::string file, unsigned int mod, bool recursive)
+{
+   
+}
+
+std::string OSVfsSftp::owner (std::string file)
+{
+    
+}
+std::string OSVfsSftp::group (std::string file)
+{
+  
+}
+
+bool OSVfsSftp::owner (std::string file, std::string ownername, bool recursive)
+{
+   
+}
+
+bool OSVfsSftp::group (std::string file, std::string groupname, bool recursive)
+{
+   
+}
+
+std::string OSVfsSftp::symlink (std::string path)
+{
+  
+}
+bool OSVfsSftp::symlink (std::string src, std::string dst)
+{
+
+}
+bool OSVfsSftp::hardlink (std::string src, std::string dst)
+{
+ 
+}
+
+
+int OSVfsSftp::quit (void)
+{
+    ssh_disconnect(session);
+    return 0;
+}
+
+EXPORTFUNCTION OSVirtualFileSystemBase* get_filelist (void)
+{
+    FXTRACE ((5, "PLUGIN LOAD\n"));
+    return new OSVfsSftp ();
+}

Added: trunk/src/plugins/filelist/OSVfsSftp.h
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-17 12:52:50 UTC (rev 285)
+++ trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-28 16:25:45 UTC (rev 286)
@@ -0,0 +1,93 @@
+// $Id: OSVfsSftp.h 255 2006-02-18 17:08:23Z compbatant $
+/////////////////////////////////////////////////////////////////////////////
+// This file is part of OpenSpace project.
+//
+// OpenSpace is free software; you can redistribute it and/or modify
+// it under the terms of the GNU General Public License as published by
+// the Free Software Foundation; either version 2 of the License, or
+// (at your option) any later version.
+//
+// OpenSpace is distributed in the hope that it will be useful,
+// but WITHOUT ANY WARRANTY; without even the implied warranty of
+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+// GNU General Public License for more details.
+//
+// You should have received a copy of the GNU General Public License
+// along with OpenSpace; if not, write to the Free Software
+// Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+/////////////////////////////////////////////////////////////////////////////
+//
+// C++ Interface: $MODULE$
+//
+// Author: Mateusz Dworak <http://openspace.linux.pl>, (C) 2005
+//
+// Description: 
+//
+/////////////////////////////////////////////////////////////////////////////
+#ifndef FILELIST_LOCAL
+#define FILELIST_LOCAL
+
+#include"../../OSVirtualFileSystemBase.h"
+
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <dirent.h>
+#include <string>
+#include <vector>
+
+
+#include <libssh/libssh.h>
+#include <libssh/sftp.h>
+
+// Forward declarations
+class OSConfigure;
+class OSFile;
+class OSPathType;
+class OSThreadExec;
+
+/**
+ * Local file list plugin class.
+ * 
+ * @todo This plugin will be reorganized/renamed.
+ */
+class OSVfsSftp: public OSVirtualFileSystemBase
+{
+private:
+
+    
+    std::string dir;
+    std::vector<std::string> fields;
+    int copymove( OSThreadExec * te, bool copy = true );
+    SSH_SESSION *session;
+    SFTP_SESSION *sftp;
+    SFTP_DIR *dirsftp;
+
+public:
+
+    int osopendir ( std::string dir );
+    OSFile osreaddir ( void );
+    int mkdir ( std::string dir, int mode );
+    int copy ( OSThreadExec * te );
+    int move ( OSThreadExec * te );
+    int remove ( OSThreadExec * te );
+    int rename ( std::string orgname, std::string newname );
+    int init ( long id, std::vector<std::string> *vector_name, OSPathType pt, OSConfigure* conf );
+    int mode ( std::string file );
+    std::string owner ( std::string file );
+    std::string group ( std::string file );
+    bool mode ( std::string file, unsigned int, bool recursive = false );
+    bool owner ( std::string file, std::string ownername, bool recursive = false );
+    bool group ( std::string file, std::string groupname, bool recursive = false );
+    std::string info ( void );
+    int quit ( void );
+    std::string symlink ( std::string path );
+    bool symlink ( std::string src, std::string dst );
+    bool hardlink ( std::string src, std::string dst );
+    OSVirtualFileSystemInfo setup ( void );
+    void totalsize ( std::string path, unsigned long &size );
+    std::string getinitialdir( void );
+
+};
+
+#endif
+



From compbatant at berlios.de  Fri Apr 28 20:03:03 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 28 Apr 2006 20:03:03 +0200
Subject: [Openspace-svn] r287 - trunk/src/plugins/filelist
Message-ID: <200604281803.k3SI33iI024216@sheep.berlios.de>

Author: compbatant
Date: 2006-04-28 20:03:00 +0200 (Fri, 28 Apr 2006)
New Revision: 287

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
dziala logownie i chodzenie po katalogach sftp


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 16:25:45 UTC (rev 286)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 18:03:00 UTC (rev 287)
@@ -135,30 +135,82 @@
         printf("%s\n",banner);
         free(banner);
     }
+    
+    
     if(auth!=SSH_AUTH_SUCCESS){
-        //M auth=auth_kbdint(session);
+      
+      
+      
+      
+    auth=ssh_userauth_kbdint(session,NULL,NULL);
+    char *name,*instruction,*prompt,*ptr;
+    char buffer[128];
+    int i,n;
+    char echo;
+    while (auth==SSH_AUTH_INFO){
+        name=ssh_userauth_kbdint_getname(session);
+        instruction=ssh_userauth_kbdint_getinstruction(session);
+        n=ssh_userauth_kbdint_getnprompts(session);
+        if(strlen(name)>0)
+            printf("%s\n",name);
+        if(strlen(instruction)>0)
+            printf("%s\n",instruction);
+        for(i=0;i<n;++i){
+            prompt=ssh_userauth_kbdint_getprompt(session,i,&echo);
+            if(echo){
+                printf("%s",prompt);
+                fgets(buffer,sizeof(buffer),stdin);
+                buffer[sizeof(buffer)-1]=0;
+                if((ptr=strchr(buffer,'\n')))
+                    *ptr=0;
+                ssh_userauth_kbdint_setanswer(session,i,buffer);
+                memset(buffer,0,strlen(buffer));
+            } else {
+                //ptr=getpass(prompt);
+                ssh_userauth_kbdint_setanswer(session,i,(char*)pt.password.c_str());
+            }
+        }
+        auth=ssh_userauth_kbdint(session,NULL,NULL);
+    }
+      
+      
+      
+      
+      
         if(auth==SSH_AUTH_ERROR){
             fprintf(stderr,"authenticating with keyb-interactive: %s\n",
                     ssh_get_error(session));
             return -1;
         }
     }
+    
+    
+    
+    
+    
+    
+    
+    
     if(auth!=SSH_AUTH_SUCCESS){
-        password=getpass("Password : ");
-        if(ssh_userauth_password(session,NULL,password) != SSH_AUTH_SUCCESS){
+ cout<<pt.password<<endl;
+         if(ssh_userauth_password(session,NULL,(char*)pt.password.c_str()) != SSH_AUTH_SUCCESS){
             fprintf(stderr,"Authentication failed: %s\n",ssh_get_error(session));
             ssh_disconnect(session);
             return -1;
         }
-        memset(password,0,strlen(password));
+        //memset(password,0,strlen(password));
     }
+    
+    
+    
+    
+    
+    
+    
     ssh_say(1,"Authentication success\n");
 
 
-     //do_sftp(session);    
-    //if(!sftp)
-        //do_cleanup();
-    
+   
 
     sftp=sftp_new(session);
     
@@ -211,6 +263,7 @@
 
 std::string OSVfsSftp::getinitialdir( void )
 {
+
        char* path="./";    
        return string(sftp_canonicalize_path(sftp, path));
 }
@@ -235,25 +288,6 @@
     }
 
 
-    /*
-    
-     reading the whole directory, file by file 
-    while((file=sftp_readdir(sftp,dir))){
-        ssh_say(0,"%30s(%.8lo) : %.5d.%.5d : %.10lld bytes\n",file->name,file->permissions,file->uid,file->gid,file->size);
-        sftp_attributes_free(file);
-    }
-     when file=NULL, an error has occured OR the directory listing is end of file 
-    if(!sftp_dir_eof(dir)){
-        ssh_say(0,"error : %s\n",ssh_get_error(session));
-        return -1;
-    }
-    if(sftp_dir_close(dir)){
-        ssh_say(0,"Error : %s\n",ssh_get_error(session));
-        return -1;
-    }
-
-*/
-
 }
 
 int OSVfsSftp::mkdir (std::string dir, int mode)
@@ -350,6 +384,7 @@
 
 int OSVfsSftp::quit (void)
 {
+    if(dirsftp)
     ssh_disconnect(session);
     return 0;
 }



From compbatant at berlios.de  Fri Apr 28 20:48:00 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 28 Apr 2006 20:48:00 +0200
Subject: [Openspace-svn] r288 - trunk/src/plugins/filelist
Message-ID: <200604281848.k3SIm0SF014513@sheep.berlios.de>

Author: compbatant
Date: 2006-04-28 20:47:57 +0200 (Fri, 28 Apr 2006)
New Revision: 288

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
download i upload pojedynczych plikow :)


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 18:03:00 UTC (rev 287)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 18:47:57 UTC (rev 288)
@@ -30,6 +30,10 @@
 #include <pwd.h>
 #include <grp.h>
 
+#include <sys/stat.h>
+#include <fcntl.h>
+
+
 #include <string>
 #include <vector>
 #include <iostream>
@@ -56,6 +60,7 @@
 
 
     dirsftp=NULL;
+    sftp=NULL;
 
     
     SSH_OPTIONS *options;
@@ -253,7 +258,16 @@
     return os_file;
     }
 
+    if(!sftp_dir_eof(dirsftp)){
+        ssh_say(0,"error : %s\n",ssh_get_error(session));
+        //return;
+    }
 
+   if(sftp_dir_close(dirsftp)){
+        ssh_say(0,"Error : %s\n",ssh_get_error(session));
+        //return;
+    }
+
     os_file.name = "";
     return os_file;
 
@@ -273,8 +287,8 @@
 int OSVfsSftp::osopendir (std::string dir)
 {
   
-    if(dirsftp)
-    sftp_dir_close(dirsftp);   
+    //if(dirsftp)
+    //sftp_dir_close(dirsftp);   
 
     
     /* opening a directory */
@@ -286,18 +300,25 @@
         ssh_say(0,"Directory not opened(%s)\n",ssh_get_error(session));
         return -1;
     }
+    else
+    {
+    this->dir=dir;
+    }
 
 
 }
 
 int OSVfsSftp::mkdir (std::string dir, int mode)
 {
+
+  string file=this->dir+"/"+dir;
   
+  return sftp_mkdir(sftp, (char*)file.c_str(), NULL);
 }
 
 int OSVfsSftp::copy ( OSThreadExec * te)
 {
-
+copymove(te,true);
 }
 
 int OSVfsSftp::move (OSThreadExec* te)
@@ -322,6 +343,86 @@
 int OSVfsSftp::copymove (OSThreadExec* te, bool copy)
 {
 
+
+std::vector < std::string >::iterator iter;
+
+std::string::size_type pos = te->options.find ( "upload" );
+    if ( pos == std::string::npos )
+    {
+
+	for (iter = te->src.begin (); iter != te->src.end(); iter++)
+  	{
+	
+		
+		SFTP_FILE *dst;
+		int src;
+		int len=1;
+    		char data[1024];
+		
+		std::string ds = te->dst;
+	   	ds.append (SEPARATOR);
+	  	ds.append (FXFile::name (iter->c_str ()).text ());
+				
+		src=open(iter->c_str(),O_RDONLY,NULL);
+		
+    		dst=sftp_open(sftp,(char*)ds.c_str(),O_WRONLY|O_CREAT,NULL);
+		if(dst)
+		{
+		
+		
+		
+			while((len=read(src,data,1024)) > 0)
+			{
+       				if(sftp_write(dst,data,len)!=len)
+				{
+            			ssh_say(0,"error writing %d bytes : %s\n",len,ssh_get_error(session));
+            			return -1;
+        			}
+		
+			}
+		sftp_file_close(dst);
+		close(src);
+    		}	
+	
+    
+    	}
+    }
+    else
+    {
+    	for (iter = te->src.begin (); iter != te->src.end(); iter++)
+  	{
+		SFTP_FILE *src;
+		int dst;
+		int len=1;
+    		char data[1024];
+		
+    		src=sftp_open(sftp,(char*)iter->c_str(),O_RDONLY,NULL);
+		if(src)
+		{
+		
+		std::string ds = te->dst;
+	   	ds.append (SEPARATOR);
+	  	ds.append (FXFile::name (iter->c_str ()).text ());
+		
+		dst=open(ds.c_str(),O_WRONLY | O_CREAT | O_TRUNC,S_IRUSR+S_IWUSR);
+		
+			while((len=sftp_read(src,data,1024)) > 0)
+			{
+       				if(write(dst,data,len)!=len)
+				{
+            			ssh_say(0,"error writing %d bytes : %s\n",len,ssh_get_error(session));
+            			return -1;
+        			}
+		
+			}
+		sftp_file_close(src);
+		close(dst);
+    		}	
+    	}
+    }	
+
+
+
   
 }
 
@@ -370,7 +471,7 @@
 
 std::string OSVfsSftp::symlink (std::string path)
 {
-  
+  return "";
 }
 bool OSVfsSftp::symlink (std::string src, std::string dst)
 {
@@ -384,7 +485,7 @@
 
 int OSVfsSftp::quit (void)
 {
-    if(dirsftp)
+    if(sftp)
     ssh_disconnect(session);
     return 0;
 }



From compbatant at berlios.de  Fri Apr 28 22:28:58 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 28 Apr 2006 22:28:58 +0200
Subject: [Openspace-svn] r289 - in trunk/src: . plugins/filelist
Message-ID: <200604282028.k3SKSwfw012124@sheep.berlios.de>

Author: compbatant
Date: 2006-04-28 22:28:58 +0200 (Fri, 28 Apr 2006)
New Revision: 289

Modified:
   trunk/src/Makefile
   trunk/src/OSFileList.cpp
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
usuniety segfault przy zamykaniu panelu w ktorym wczesniej byl wywolowany cmddialog, dodane tworzenie katalogu w sftp


Modified: trunk/src/Makefile
===================================================================
--- trunk/src/Makefile	2006-04-28 18:47:57 UTC (rev 288)
+++ trunk/src/Makefile	2006-04-28 20:28:58 UTC (rev 289)
@@ -128,7 +128,7 @@
 CXX = g++
 CXXCPP = g++ -E
 CXXDEPMODE = depmode=gcc3
-CXXFLAGS = -O2
+CXXFLAGS = -g -O2
 CYGPATH_W = echo
 DEFS = -DHAVE_CONFIG_H
 DEPDIR = .deps

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-28 18:47:57 UTC (rev 288)
+++ trunk/src/OSFileList.cpp	2006-04-28 20:28:58 UTC (rev 289)
@@ -138,6 +138,8 @@
     }
 }
 
+dial=NULL;
+
 objmanager=OSObjectManager::instance(getApp());
  
 FXScrollArea::vertical->setArrowColor(FXRGB(255, 255, 255));
@@ -396,6 +398,9 @@
     delete popupmenu;
     }
 
+    if(dial)
+    delete dial;	
+    
     fb->quit ();
     delete sortpop;
     FXTRACE ((5, "destruct\n"));
@@ -1329,8 +1334,9 @@
     {
     
 
+	if(dial)
+	delete dial;
 
-
     string plugin_path = string(PATH_LIBDIR) + "/openspace/plugins/cmddialog/lib" + command + ".so";
 
     if(!FXFile::exists(plugin_path.c_str()))
@@ -2010,7 +2016,7 @@
 {
 
     dial->hide ();
-    delete dial;
+    //delete dial;
 }
 
 //update info about selected files

Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 18:47:57 UTC (rev 288)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 20:28:58 UTC (rev 289)
@@ -452,11 +452,11 @@
 
 std::string OSVfsSftp::owner (std::string file)
 {
-    
+return "";   
 }
 std::string OSVfsSftp::group (std::string file)
 {
-  
+return "";   
 }
 
 bool OSVfsSftp::owner (std::string file, std::string ownername, bool recursive)



From compbatant at berlios.de  Fri Apr 28 23:58:05 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Fri, 28 Apr 2006 23:58:05 +0200
Subject: [Openspace-svn] r290 - in trunk: . src src/plugins/filelist
Message-ID: <200604282158.k3SLw5jI020190@sheep.berlios.de>

Author: compbatant
Date: 2006-04-28 23:58:04 +0200 (Fri, 28 Apr 2006)
New Revision: 290

Modified:
   trunk/openspacerc.in
   trunk/src/OSFileListItem.cpp
   trunk/src/plugins/filelist/OSVfsSftp.cpp
   trunk/src/plugins/filelist/OSVfsSftp.h
Log:
dziala rename dla sftp, poprawiona szerokosc wyswietlanych ikon


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-28 20:28:58 UTC (rev 289)
+++ trunk/openspacerc.in	2006-04-28 21:58:04 UTC (rev 290)
@@ -628,10 +628,18 @@
 		<sftp>
 			<type>network</type>
 			<style>small icons</style>
+			<headers>
+				<header>size</header>
+			</headers>
 			<properties>
 				<name>
 					<width>400</width>					
 				</name>
+				<size>
+					<width>80</width>
+					<display>MB</display>
+					<type>size</type>
+				</size>
 			</properties>	
 		</sftp>
 		<search>

Modified: trunk/src/OSFileListItem.cpp
===================================================================
--- trunk/src/OSFileListItem.cpp	2006-04-28 20:28:58 UTC (rev 289)
+++ trunk/src/OSFileListItem.cpp	2006-04-28 21:58:04 UTC (rev 290)
@@ -286,11 +286,11 @@
         //=============CHANGES==========================================
         for ( int i = 0;i < osf.attrib.size();i++ )
         {
-            th = th + 4 + font1->getFontHeight();
+            th = th + 2 + font1->getFontHeight();
         }
         //=============CHANGES==========================================
 
-        if ( ih > th )
+        if ( ih + firstth > th )
             h = BIG_LINE_SPACING + ih + firstth + 4;
         else
             h = BIG_LINE_SPACING + th;

Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 20:28:58 UTC (rev 289)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 21:58:04 UTC (rev 290)
@@ -46,6 +46,7 @@
 	OSVirtualFileSystemInfo v;
 	
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("name"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("size","size"));	
 	v.information="SFTP file list - default plugin";
 	v.version="1";
 	
@@ -57,6 +58,7 @@
     this->id=id;
     fields = (*vector_name);
 
+    fieldsnum = vector_name->size ();
 
 
     dirsftp=NULL;
@@ -251,6 +253,29 @@
 	os_file.type = FOLDER;
 	else
         os_file.type = 0;
+	
+	os_file.size=file->size;
+	
+	
+	
+	
+    for (int i = 0; i < fieldsnum - 1; i++)
+    {
+
+	if (fields[i + 1] == "size")
+	    os_file.attrib.push_back(numtostring (os_file.size));
+	
+
+    }
+	
+	
+	
+	
+	
+	
+	
+	
+	
     
     //fxmessage("name=%s type=%x\n",file->name,file->permissions);
     
@@ -336,7 +361,7 @@
 
 int OSVfsSftp::rename (std::string orgname, std::string newname)
 {
-
+return sftp_rename(sftp,(char*)orgname.c_str(),(char*)newname.c_str());
 }
 
 

Modified: trunk/src/plugins/filelist/OSVfsSftp.h
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-28 20:28:58 UTC (rev 289)
+++ trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-28 21:58:04 UTC (rev 290)
@@ -54,7 +54,7 @@
 {
 private:
 
-    
+    int fieldsnum;
     std::string dir;
     std::vector<std::string> fields;
     int copymove( OSThreadExec * te, bool copy = true );



From compbatant at berlios.de  Sat Apr 29 01:18:45 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sat, 29 Apr 2006 01:18:45 +0200
Subject: [Openspace-svn] r291 - trunk/src/plugins/filelist
Message-ID: <200604282318.k3SNIjb9016087@sheep.berlios.de>

Author: compbatant
Date: 2006-04-29 01:18:42 +0200 (Sat, 29 Apr 2006)
New Revision: 291

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
zaczete prace nad totalsize dla sftp


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 21:58:04 UTC (rev 290)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 23:18:42 UTC (rev 291)
@@ -456,7 +456,50 @@
 void OSVfsSftp::totalsize (std::string path, unsigned long &size)
 {
 
-   
+fxmessage("%s\n",path.c_str());
+
+SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)path.c_str ());
+
+ if(attr) 
+ {
+  if((attr->permissions & S_IFMT) == S_IFDIR)
+  {
+
+  dirsftp=sftp_opendir(sftp,(char*)path.c_str());
+
+   if(dirsftp)
+   { 
+
+    SFTP_ATTRIBUTES *file;
+    
+    while(file=sftp_readdir(sftp,dirsftp))
+    {
+
+    	if (file->name[0] != '.' || (file->name[1] != '\0' && (file->name[1] != '.' || file->name[2] != '\0')))
+    	{
+
+    
+    		std::string filename = path;
+		filename.append ("/");
+		filename.append (file->name);
+ 
+    	        totalsize (filename, size);
+
+	}	
+    }
+   sftp_dir_close (dirsftp);
+   }
+  }
+  else
+  {
+  //fxmessage("%d\n",attr->size);
+  size += (unsigned int) attr->size;
+  //fxmessage("total=%d\n",size);
+  }    
+ sftp_attributes_free(attr);
+ }
+
+
 }
 
 std::string OSVfsSftp::info (void)



From compbatant at berlios.de  Sat Apr 29 15:30:24 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sat, 29 Apr 2006 15:30:24 +0200
Subject: [Openspace-svn] r292 - in trunk: . src src/plugins/filelist
Message-ID: <200604291330.k3TDUO2s007173@sheep.berlios.de>

Author: compbatant
Date: 2006-04-29 15:30:00 +0200 (Sat, 29 Apr 2006)
New Revision: 292

Modified:
   trunk/openspacerc.in
   trunk/src/OSFileList.cpp
   trunk/src/plugins/filelist/OSVfsLocal.cpp
   trunk/src/plugins/filelist/OSVfsSftp.cpp
   trunk/src/plugins/filelist/OSVfsSftp.h
Log:
dodanie wyswietlania praw i dat w sftp, wyswietlanie informacji na pasku stanu w zaleznosci czy vfs local czy nie


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-28 23:18:42 UTC (rev 291)
+++ trunk/openspacerc.in	2006-04-29 13:30:00 UTC (rev 292)
@@ -630,6 +630,8 @@
 			<style>small icons</style>
 			<headers>
 				<header>size</header>
+				<header>mode</header>
+				<header>modified</header>
 			</headers>
 			<properties>
 				<name>
@@ -640,6 +642,17 @@
 					<display>MB</display>
 					<type>size</type>
 				</size>
+				<accessed>
+					<width>100</width>
+					<type>date</type>
+				</accessed>
+				<modified>
+					<width>100</width>
+					<type>date</type>
+				</modified>
+				<mode>
+					<width>80</width>
+				</mode>
 			</properties>	
 		</sftp>
 		<search>

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-28 23:18:42 UTC (rev 291)
+++ trunk/src/OSFileList.cpp	2006-04-29 13:30:00 UTC (rev 292)
@@ -519,7 +519,6 @@
 
 string OSFileList::getfiledescription (string name)
 {
-
       string r;   
       r = magic_file(ms2, name.c_str());      
       return r;
@@ -2039,7 +2038,14 @@
     string inf = "selected: " + ntos (count) + " size: " + numtostring (size) + " ( "+ ntos(size) + " B )";
     if (count == 1)
     {
-    inf = inf + " type: "+getfiletype(os->osf.name) + "\n "+getfiledescription(os->osf.name)+ "  " + os->osf.name;
+    	   if(this->type=="local" || this->type=="search")
+           {
+           inf = inf + " type: "+getfiletype(os->osf.name) + "\n "+getfiledescription(os->osf.name)+ "  " + os->osf.name;
+	   }
+	   else
+	   {
+	   inf = inf + " type: "+getfiletype(os->osf.name) +" "+os->osf.name;
+	   }
     }
 
 

Modified: trunk/src/plugins/filelist/OSVfsLocal.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsLocal.cpp	2006-04-28 23:18:42 UTC (rev 291)
+++ trunk/src/plugins/filelist/OSVfsLocal.cpp	2006-04-29 13:30:00 UTC (rev 292)
@@ -42,6 +42,7 @@
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("size","size"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("owner"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("group"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("mode"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("accessed","date"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("modified","date"));
 	v.information="Local file list - default plugin";

Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-28 23:18:42 UTC (rev 291)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 13:30:00 UTC (rev 292)
@@ -46,7 +46,10 @@
 	OSVirtualFileSystemInfo v;
 	
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("name"));
-	v.vfsheaders.push_back(OSVirtualFileSystemHeader("size","size"));	
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("mode"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("size","size"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("accessed","date"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("modified","date"));	
 	v.information="SFTP file list - default plugin";
 	v.version="1";
 	
@@ -235,6 +238,17 @@
     
 
 
+	if(sftp)
+	version=sftp->server_version;
+	
+	
+	char chstr[ 20 ] = { 0 };
+        sprintf ( chstr, "%d", version );
+	
+	string info="version " + string(chstr);
+	fxmessage("%s\n",info.c_str());
+
+
     return 0;
 }
 
@@ -264,6 +278,28 @@
 
 	if (fields[i + 1] == "size")
 	    os_file.attrib.push_back(numtostring (os_file.size));
+	else if (fields[i + 1] == "accessed")
+	    os_file.attrib.push_back(FXFile::time ("%H:%M %d/%m/%y", file->atime).text());
+	else if (fields[i + 1] == "modified")
+ 	    os_file.attrib.push_back(FXFile::time ("%H:%M %d/%m/%y", file->mtime).text());  
+	else if (fields[i + 1] == "mode")
+	{
+
+	    std::string str = "---------";	 
+
+		(file->permissions & S_IRUSR) ? str[0] = 'r' : str[0] = '-';
+		(file->permissions & S_IWUSR) ? str[1] = 'w' : str[1] = '-';
+		(file->permissions & S_IXUSR) ? str[2] = 'x' : str[2] = '-';
+		(file->permissions & S_IRGRP) ? str[3] = 'r' : str[3] = '-';
+		(file->permissions & S_IWGRP) ? str[4] = 'w' : str[4] = '-';
+		(file->permissions & S_IXGRP) ? str[5] = 'x' : str[5] = '-';
+		(file->permissions & S_IROTH) ? str[6] = 'r' : str[6] = '-';
+		(file->permissions & S_IWOTH) ? str[7] = 'w' : str[7] = '-';
+		(file->permissions & S_IXOTH) ? str[8] = 'x' : str[8] = '-';
+
+	    os_file.attrib.push_back(str);
+
+	}
 	
 
     }
@@ -315,6 +351,7 @@
     //if(dirsftp)
     //sftp_dir_close(dirsftp);   
 
+
     
     /* opening a directory */
   
@@ -477,24 +514,21 @@
 
     	if (file->name[0] != '.' || (file->name[1] != '\0' && (file->name[1] != '.' || file->name[2] != '\0')))
     	{
-
-    
+   
     		std::string filename = path;
 		filename.append ("/");
 		filename.append (file->name);
  
     	        totalsize (filename, size);
-
-	}	
+	}
+	
     }
    sftp_dir_close (dirsftp);
    }
   }
   else
   {
-  //fxmessage("%d\n",attr->size);
   size += (unsigned int) attr->size;
-  //fxmessage("total=%d\n",size);
   }    
  sftp_attributes_free(attr);
  }
@@ -504,13 +538,16 @@
 
 std::string OSVfsSftp::info (void)
 {
-    return "";
+string info="";
+return info;
 }
 
 
 int OSVfsSftp::mode (std::string file)
 {
     
+
+    
 }
 
 bool OSVfsSftp::mode (std::string file, unsigned int mod, bool recursive)
@@ -520,6 +557,17 @@
 
 std::string OSVfsSftp::owner (std::string file)
 {
+
+	SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)file.c_str ());
+        if(attr) 
+	{
+	string owner="";
+	//owner+=attr->owner;
+	//fxmessage(attr->uid);
+	sftp_attributes_free(attr);	
+	return owner;
+	}
+
 return "";   
 }
 std::string OSVfsSftp::group (std::string file)

Modified: trunk/src/plugins/filelist/OSVfsSftp.h
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-28 23:18:42 UTC (rev 291)
+++ trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-29 13:30:00 UTC (rev 292)
@@ -61,6 +61,7 @@
     SSH_SESSION *session;
     SFTP_SESSION *sftp;
     SFTP_DIR *dirsftp;
+    int version;
 
 public:
 



From compbatant at berlios.de  Sat Apr 29 16:22:25 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sat, 29 Apr 2006 16:22:25 +0200
Subject: [Openspace-svn] r293 - in trunk: . src/plugins/filelist
Message-ID: <200604291422.k3TEMPGN015171@sheep.berlios.de>

Author: compbatant
Date: 2006-04-29 16:22:21 +0200 (Sat, 29 Apr 2006)
New Revision: 293

Modified:
   trunk/openspacerc.in
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
grupa i owner pliku w sftp, narazie tyko uid i gid


Modified: trunk/openspacerc.in
===================================================================
--- trunk/openspacerc.in	2006-04-29 13:30:00 UTC (rev 292)
+++ trunk/openspacerc.in	2006-04-29 14:22:21 UTC (rev 293)
@@ -627,10 +627,12 @@
 		</ftp>
 		<sftp>
 			<type>network</type>
-			<style>small icons</style>
+			<style>big icons</style>
 			<headers>
 				<header>size</header>
 				<header>mode</header>
+				<header>owner</header>
+				<header>group</header>
 				<header>modified</header>
 			</headers>
 			<properties>
@@ -653,6 +655,12 @@
 				<mode>
 					<width>80</width>
 				</mode>
+				<owner>
+					<width>80</width>
+				</owner>
+				<group>
+					<width>80</width>
+				</group>
 			</properties>	
 		</sftp>
 		<search>

Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 13:30:00 UTC (rev 292)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 14:22:21 UTC (rev 293)
@@ -47,6 +47,8 @@
 	
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("name"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("mode"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("owner"));
+	v.vfsheaders.push_back(OSVirtualFileSystemHeader("group"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("size","size"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("accessed","date"));
 	v.vfsheaders.push_back(OSVirtualFileSystemHeader("modified","date"));	
@@ -242,10 +244,7 @@
 	version=sftp->server_version;
 	
 	
-	char chstr[ 20 ] = { 0 };
-        sprintf ( chstr, "%d", version );
-	
-	string info="version " + string(chstr);
+	string info="version " + ntos(version);
 	fxmessage("%s\n",info.c_str());
 
 
@@ -278,6 +277,10 @@
 
 	if (fields[i + 1] == "size")
 	    os_file.attrib.push_back(numtostring (os_file.size));
+	else if (fields[i + 1] == "owner")
+	    os_file.attrib.push_back(ntos(file->uid));
+	else if (fields[i + 1] == "group")
+	    os_file.attrib.push_back(ntos(file->gid));       
 	else if (fields[i + 1] == "accessed")
 	    os_file.attrib.push_back(FXFile::time ("%H:%M %d/%m/%y", file->atime).text());
 	else if (fields[i + 1] == "modified")



From compbatant at berlios.de  Sat Apr 29 20:14:59 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sat, 29 Apr 2006 20:14:59 +0200
Subject: [Openspace-svn] r294 - trunk/src/plugins/filelist
Message-ID: <200604291814.k3TIExRT017338@sheep.berlios.de>

Author: compbatant
Date: 2006-04-29 20:14:50 +0200 (Sat, 29 Apr 2006)
New Revision: 294

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
Log:
sftp-pobieranie i zmiana praw do plikow zrobiona


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 14:22:21 UTC (rev 293)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 18:14:50 UTC (rev 294)
@@ -548,14 +548,28 @@
 
 int OSVfsSftp::mode (std::string file)
 {
-    
+  
+  SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)file.c_str ());
+        if(attr) 
+	{
+	return attr->permissions;
+	}  
 
     
 }
 
 bool OSVfsSftp::mode (std::string file, unsigned int mod, bool recursive)
 {
-   
+
+	SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)file.c_str ());
+        if(attr) 
+	{
+	attr->permissions=mod;
+	sftp_setstat(sftp,(char*)file.c_str (),attr);
+	sftp_attributes_free(attr);
+	}
+
+    
 }
 
 std::string OSVfsSftp::owner (std::string file)
@@ -564,9 +578,7 @@
 	SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)file.c_str ());
         if(attr) 
 	{
-	string owner="";
-	//owner+=attr->owner;
-	//fxmessage(attr->uid);
+	string owner=ntos(attr->uid);
 	sftp_attributes_free(attr);	
 	return owner;
 	}



From compbatant at berlios.de  Sun Apr 30 16:03:34 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 30 Apr 2006 16:03:34 +0200
Subject: [Openspace-svn] r295 - trunk/src/plugins/filelist
Message-ID: <200604301403.k3UE3YrJ012711@sheep.berlios.de>

Author: compbatant
Date: 2006-04-30 16:03:32 +0200 (Sun, 30 Apr 2006)
New Revision: 295

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
   trunk/src/plugins/filelist/OSVfsSftp.h
Log:
sftp-rekurencyjne uploadowanie plikow


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-29 18:14:50 UTC (rev 294)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-30 14:03:32 UTC (rev 295)
@@ -308,16 +308,7 @@
     }
 	
 	
-	
-	
-	
-	
-	
-	
-	
     
-    //fxmessage("name=%s type=%x\n",file->name,file->permissions);
-    
     sftp_attributes_free(file);
     return os_file;
     }
@@ -350,11 +341,6 @@
 
 int OSVfsSftp::osopendir (std::string dir)
 {
-  
-    //if(dirsftp)
-    //sftp_dir_close(dirsftp);   
-
-
     
     /* opening a directory */
   
@@ -388,7 +374,7 @@
 
 int OSVfsSftp::move (OSThreadExec* te)
 {
-
+copymove(te,false);
 }
 
 
@@ -405,32 +391,26 @@
 }
 
 
-int OSVfsSftp::copymove (OSThreadExec* te, bool copy)
+
+
+int OSVfsSftp::uploadFile (string from, string to, OSThreadExec* te)
 {
 
+fxmessage("from %s to %s\n",from.c_str(),to.c_str());
 
-std::vector < std::string >::iterator iter;
 
-std::string::size_type pos = te->options.find ( "upload" );
-    if ( pos == std::string::npos )
-    {
+te->act_file_name=from;
+te->act_file_size=0;
+te->file_size=FXFile::size(from.c_str());
 
-	for (iter = te->src.begin (); iter != te->src.end(); iter++)
-  	{
-	
-		
 		SFTP_FILE *dst;
 		int src;
 		int len=1;
     		char data[1024];
+						
+		src=open(from.c_str(),O_RDONLY,NULL);
 		
-		std::string ds = te->dst;
-	   	ds.append (SEPARATOR);
-	  	ds.append (FXFile::name (iter->c_str ()).text ());
-				
-		src=open(iter->c_str(),O_RDONLY,NULL);
-		
-    		dst=sftp_open(sftp,(char*)ds.c_str(),O_WRONLY|O_CREAT,NULL);
+    		dst=sftp_open(sftp,(char*)to.c_str(),O_WRONLY|O_CREAT,NULL);
 		if(dst)
 		{
 		
@@ -443,34 +423,30 @@
             			ssh_say(0,"error writing %d bytes : %s\n",len,ssh_get_error(session));
             			return -1;
         			}
-		
+			te->act_total_size+=len;
+			te->act_file_size+=len;
+			
 			}
 		sftp_file_close(dst);
 		close(src);
     		}	
-	
-    
-    	}
-    }
-    else
-    {
-    	for (iter = te->src.begin (); iter != te->src.end(); iter++)
-  	{
+}
+
+
+int OSVfsSftp::downloadFile (string from, string to, OSThreadExec* te)
+{
+
 		SFTP_FILE *src;
 		int dst;
 		int len=1;
     		char data[1024];
 		
-    		src=sftp_open(sftp,(char*)iter->c_str(),O_RDONLY,NULL);
+    		src=sftp_open(sftp,(char*)from.c_str(),O_RDONLY,NULL);
 		if(src)
 		{
+				
+		dst=open(to.c_str(),O_WRONLY | O_CREAT | O_TRUNC,S_IRUSR+S_IWUSR);
 		
-		std::string ds = te->dst;
-	   	ds.append (SEPARATOR);
-	  	ds.append (FXFile::name (iter->c_str ()).text ());
-		
-		dst=open(ds.c_str(),O_WRONLY | O_CREAT | O_TRUNC,S_IRUSR+S_IWUSR);
-		
 			while((len=sftp_read(src,data,1024)) > 0)
 			{
        				if(write(dst,data,len)!=len)
@@ -482,8 +458,58 @@
 			}
 		sftp_file_close(src);
 		close(dst);
-    		}	
+  		}	
+	
+}
+
+
+
+
+int OSVfsSftp::copymove (OSThreadExec* te, bool copy)
+{
+
+unsigned long size = 0;
+
+std::vector < std::string >::iterator iter;
+
+fxmessage(te->options.c_str());
+
+std::string::size_type pos = te->options.find ( "upload" );
+    if ( pos == std::string::npos )
+    {
+
+
+	for ( iter = te->src.begin (); iter != te->src.end(); iter++ )
+        {
+            std::string sr = ( *iter );
+            if ( FXFile::isDirectory ( sr.c_str () ) )
+                sr.append ( "/" );
+            local_totalsize ( sr, size );
+        }
+
+        te->total_size = size;
+
+
+	for (iter = te->src.begin (); iter != te->src.end(); iter++)
+  	{
+	
+	goLocalRecursive( *iter, this->dir, te );	
+		
+	
+    
     	}
+    }
+    else
+    {
+    	for (iter = te->src.begin (); iter != te->src.end(); iter++)
+  	{
+		
+		
+		//std::string ds = te->dst;
+	   	//ds.append (SEPARATOR);
+	  	//ds.append (FXFile::name (iter->c_str ()).text ());
+		
+    	}
     }	
 
 
@@ -496,9 +522,10 @@
 void OSVfsSftp::totalsize (std::string path, unsigned long &size)
 {
 
-fxmessage("%s\n",path.c_str());
+//fxmessage("%s\n",path.c_str());
 
 SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)path.c_str ());
+SFTP_DIR *dirsftp;
 
  if(attr) 
  {
@@ -534,11 +561,127 @@
   size += (unsigned int) attr->size;
   }    
  sftp_attributes_free(attr);
- }
+ } 
 
 
 }
 
+void OSVfsSftp::goLocalRecursive ( std::string path, std::string dstdir, OSThreadExec *te )
+{
+
+    if ( te->cancel == true )
+        return ;
+
+    if ( FXFile::isDirectory ( path.c_str () ) )
+    {
+        struct stat status;
+        struct dirent *dp;
+        DIR *dirp;
+
+        
+	
+        
+
+
+        dirp = opendir ( path.c_str () );
+	
+	this->dir=dstdir;
+	
+	dstdir = dstdir +"/"+ FXFile::name( path.c_str() ).text();
+	this->mkdir( FXFile::name( path.c_str() ).text(),0);
+
+	fxmessage("MKDIR = %s\n",dstdir.c_str());
+
+        while ( ( dp = readdir ( dirp ) ) != NULL )
+        {
+            if ( dp->d_name[ 0 ] != '.' || ( dp->d_name[ 1 ] != '\0' && ( dp->d_name[ 1 ] != '.' || dp->d_name[ 2 ] != '\0' ) ) )
+            {
+
+                std::string file = path + "/";
+                file.append ( dp->d_name );
+                goLocalRecursive( file, dstdir, te );
+            }
+        }
+
+        closedir ( dirp );
+    }
+    else
+    {
+        
+		std::string ds = dstdir;
+	   	ds.append (SEPARATOR);
+	  	ds.append (FXFile::name (path.c_str()).text ());
+		uploadFile(path,ds,te);
+
+    }
+
+}
+
+
+
+
+
+
+void OSVfsSftp::local_totalsize ( std::string path, unsigned long &size )
+{
+
+//fxmessage("%s\n",path.c_str());
+
+    if ( FXFile::isDirectory ( path.c_str () ) )
+    {
+        struct stat status;
+        struct dirent *dp;
+        DIR *dirp;
+
+
+        dirp = opendir ( path.c_str () );
+
+        while ( ( dp = readdir ( dirp ) ) != NULL )
+        {
+            if ( dp->d_name[ 0 ] != '.' || ( dp->d_name[ 1 ] != '\0' && ( dp->d_name[ 1 ] != '.' || dp->d_name[ 2 ] != '\0' ) ) )
+            {
+
+                std::string file = path;
+                file.append ( dp->d_name );
+#ifndef WIN32
+                lstat ( file.c_str (), &status );
+#else
+                stat ( file.c_str (), &status );
+#endif
+                if ( S_ISDIR ( status.st_mode ) )
+                {
+                    size = size + ( unsigned int ) status.st_size;
+                    file.append ( "/" );
+                    totalsize ( file, size );
+
+                }
+                else
+                {
+                    size = size + status.st_size;
+                }
+            }
+        }
+
+        closedir ( dirp );
+    }
+    else
+    {
+        size += FXFile::size ( path.c_str () );
+
+    }
+
+}
+
+
+
+
+
+
+
+
+
+
+
 std::string OSVfsSftp::info (void)
 {
 string info="";

Modified: trunk/src/plugins/filelist/OSVfsSftp.h
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-29 18:14:50 UTC (rev 294)
+++ trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-30 14:03:32 UTC (rev 295)
@@ -86,6 +86,10 @@
     bool hardlink ( std::string src, std::string dst );
     OSVirtualFileSystemInfo setup ( void );
     void totalsize ( std::string path, unsigned long &size );
+    void local_totalsize ( std::string path, unsigned long &size );
+    void goLocalRecursive ( std::string path, std::string prefix, OSThreadExec *te );
+    int  uploadFile (std::string from, std::string to, OSThreadExec* te);
+    int  downloadFile (std::string from, std::string to, OSThreadExec* te);
     std::string getinitialdir( void );
 
 };



From compbatant at berlios.de  Sun Apr 30 17:27:30 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 30 Apr 2006 17:27:30 +0200
Subject: [Openspace-svn] r296 - trunk/src/plugins/filelist
Message-ID: <200604301527.k3UFRUxO031144@sheep.berlios.de>

Author: compbatant
Date: 2006-04-30 17:27:29 +0200 (Sun, 30 Apr 2006)
New Revision: 296

Modified:
   trunk/src/plugins/filelist/OSVfsSftp.cpp
   trunk/src/plugins/filelist/OSVfsSftp.h
Log:
usuwanie, download, upload rekurencyjny - sftp


Modified: trunk/src/plugins/filelist/OSVfsSftp.cpp
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-30 14:03:32 UTC (rev 295)
+++ trunk/src/plugins/filelist/OSVfsSftp.cpp	2006-04-30 15:27:29 UTC (rev 296)
@@ -380,9 +380,13 @@
 
 int OSVfsSftp::remove (OSThreadExec* te)
 {
+std::vector < std::string >::iterator iter;
 
+for ( iter = te->src.begin (); iter != te->src.end(); iter++ )
+        {
+	removeRecursive( *iter, te );	
+	}
 
-
 }
 
 int OSVfsSftp::rename (std::string orgname, std::string newname)
@@ -396,17 +400,45 @@
 int OSVfsSftp::uploadFile (string from, string to, OSThreadExec* te)
 {
 
-fxmessage("from %s to %s\n",from.c_str(),to.c_str());
+//fxmessage("from %s to %s\n",from.c_str(),to.c_str());
 
 
 te->act_file_name=from;
 te->act_file_size=0;
 te->file_size=FXFile::size(from.c_str());
 
+
+fxmessage("TO=%s\n",to.c_str());
+
+SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)to.c_str ());
+
+	if (attr)
+	{
+	sftp_attributes_free(attr);
+	
+	    if (te->all == false)
+	    {
+
+		te->question = true;
+		while (te->answer != true)
+		    usleep (5000);
+		te->answer = false;
+
+	    }
+	    if (!te->overwrite)
+		return -1;	
+	    if (this->removeRecursive( to, te )==-1)
+		return -1;
+	}
+	
+
+	
+
+
 		SFTP_FILE *dst;
 		int src;
 		int len=1;
-    		char data[1024];
+    		char data[131072]; //128KB
 						
 		src=open(from.c_str(),O_RDONLY,NULL);
 		
@@ -416,7 +448,7 @@
 		
 		
 		
-			while((len=read(src,data,1024)) > 0)
+			while((len=read(src,data,131072)) > 0)
 			{
        				if(sftp_write(dst,data,len)!=len)
 				{
@@ -425,6 +457,8 @@
         			}
 			te->act_total_size+=len;
 			te->act_file_size+=len;
+			if ( te->cancel == true )
+        		return -1;
 			
 			}
 		sftp_file_close(dst);
@@ -436,10 +470,35 @@
 int OSVfsSftp::downloadFile (string from, string to, OSThreadExec* te)
 {
 
+te->act_file_name=from;
+te->act_file_size=0;
+
+
+if (FXFile::exists (to.c_str()))
+	{
+
+	    if (te->all == false)
+	    {
+
+		te->question = true;
+		while (te->answer != true)
+		    usleep (5000);
+		te->answer = false;
+
+	    }
+	    if (!te->overwrite)
+		return -1;	
+	    if (!OSFXFile::remove (to.c_str(), te))
+		return -1;
+	}
+
+
+
+
 		SFTP_FILE *src;
 		int dst;
 		int len=1;
-    		char data[1024];
+    		char data[131072]; //128KB
 		
     		src=sftp_open(sftp,(char*)from.c_str(),O_RDONLY,NULL);
 		if(src)
@@ -447,14 +506,17 @@
 				
 		dst=open(to.c_str(),O_WRONLY | O_CREAT | O_TRUNC,S_IRUSR+S_IWUSR);
 		
-			while((len=sftp_read(src,data,1024)) > 0)
+			while((len=sftp_read(src,data,131072)) > 0)
 			{
        				if(write(dst,data,len)!=len)
 				{
             			ssh_say(0,"error writing %d bytes : %s\n",len,ssh_get_error(session));
             			return -1;
         			}
-		
+			te->act_total_size+=len;
+			te->act_file_size+=len;
+			if ( te->cancel == true )
+        		return -1;
 			}
 		sftp_file_close(src);
 		close(dst);
@@ -501,14 +563,21 @@
     }
     else
     {
+    
+    
+    	for ( iter = te->src.begin (); iter != te->src.end(); iter++ )
+        {
+            totalsize ( *iter, size );
+        }
+
+        te->total_size = size;
+	
+    
     	for (iter = te->src.begin (); iter != te->src.end(); iter++)
   	{
+
+	goRecursive( *iter, te->dst, te );
 		
-		
-		//std::string ds = te->dst;
-	   	//ds.append (SEPARATOR);
-	  	//ds.append (FXFile::name (iter->c_str ()).text ());
-		
     	}
     }	
 
@@ -590,7 +659,7 @@
 	dstdir = dstdir +"/"+ FXFile::name( path.c_str() ).text();
 	this->mkdir( FXFile::name( path.c_str() ).text(),0);
 
-	fxmessage("MKDIR = %s\n",dstdir.c_str());
+	//fxmessage("MKDIR = %s\n",dstdir.c_str());
 
         while ( ( dp = readdir ( dirp ) ) != NULL )
         {
@@ -618,10 +687,120 @@
 }
 
 
+int OSVfsSftp::removeRecursive ( std::string path, OSThreadExec *te )
+{
 
+ if ( te->cancel == true )
+        return -1;
+int ret=0;
 
+SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)path.c_str ());
+SFTP_DIR *dirsftp;
 
+ if(attr) 
+ {
+  if((attr->permissions & S_IFMT) == S_IFDIR)
+  {
 
+  dirsftp=sftp_opendir(sftp,(char*)path.c_str());
+
+   if(dirsftp)
+   { 
+
+    SFTP_ATTRIBUTES *file;
+    
+    while(file=sftp_readdir(sftp,dirsftp))
+    {
+
+    	if (file->name[0] != '.' || (file->name[1] != '\0' && (file->name[1] != '.' || file->name[2] != '\0')))
+    	{
+   
+    		std::string filename = path;
+		filename.append ("/");
+		filename.append (file->name);
+ 
+    	        removeRecursive(filename,te);
+	}
+	
+    }
+   sftp_dir_close (dirsftp);
+   te->act_file_name=path;
+   ret=sftp_rmdir(sftp,(char*)path.c_str());  
+   }
+  }
+  else
+  {
+  te->act_file_name=path;
+  ret=sftp_rm(sftp,(char*)path.c_str());  
+  }    
+ sftp_attributes_free(attr);
+ } 
+ 
+return ret; 
+ 
+}
+
+
+void OSVfsSftp::goRecursive ( std::string path, std::string dstdir, OSThreadExec *te )
+{
+
+ if ( te->cancel == true )
+        return ;
+
+
+SFTP_ATTRIBUTES * attr=sftp_stat (sftp,(char*)path.c_str ());
+SFTP_DIR *dirsftp;
+
+ if(attr) 
+ {
+  if((attr->permissions & S_IFMT) == S_IFDIR)
+  {
+
+	dstdir = dstdir +"/"+ FXFile::name( path.c_str() ).text();
+	FXFile::createDirectory(dstdir.c_str(),0);
+
+	//fxmessage("X MKDIR = %s\n",dstdir.c_str());
+
+  dirsftp=sftp_opendir(sftp,(char*)path.c_str());
+
+   if(dirsftp)
+   { 
+
+    SFTP_ATTRIBUTES *file;
+    
+    while(file=sftp_readdir(sftp,dirsftp))
+    {
+
+    	if (file->name[0] != '.' || (file->name[1] != '\0' && (file->name[1] != '.' || file->name[2] != '\0')))
+    	{
+   
+    		std::string filename = path;
+		filename.append ("/");
+		filename.append (file->name);
+ 
+    	        goRecursive(filename,dstdir,te);
+	}
+	
+    }
+   sftp_dir_close (dirsftp);
+   }
+  }
+  else
+  {
+  te->file_size=attr->size;
+  
+  
+  	downloadFile(path,dstdir+"/"+string(FXFile::name (path.c_str()).text ()),te);
+  
+  }    
+ sftp_attributes_free(attr);
+ } 
+}
+
+
+
+
+
 void OSVfsSftp::local_totalsize ( std::string path, unsigned long &size )
 {
 

Modified: trunk/src/plugins/filelist/OSVfsSftp.h
===================================================================
--- trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-30 14:03:32 UTC (rev 295)
+++ trunk/src/plugins/filelist/OSVfsSftp.h	2006-04-30 15:27:29 UTC (rev 296)
@@ -88,6 +88,8 @@
     void totalsize ( std::string path, unsigned long &size );
     void local_totalsize ( std::string path, unsigned long &size );
     void goLocalRecursive ( std::string path, std::string prefix, OSThreadExec *te );
+    void goRecursive ( std::string path, std::string prefix, OSThreadExec *te );
+    int removeRecursive ( std::string path, OSThreadExec *te );
     int  uploadFile (std::string from, std::string to, OSThreadExec* te);
     int  downloadFile (std::string from, std::string to, OSThreadExec* te);
     std::string getinitialdir( void );



From compbatant at berlios.de  Sun Apr 30 18:23:03 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 30 Apr 2006 18:23:03 +0200
Subject: [Openspace-svn] r297 - in trunk: . src
Message-ID: <200604301623.k3UGN3EZ003019@sheep.berlios.de>

Author: compbatant
Date: 2006-04-30 18:23:02 +0200 (Sun, 30 Apr 2006)
New Revision: 297

Modified:
   trunk/configure
   trunk/configure.ac
   trunk/src/OSFileList.cpp
   trunk/src/OSFileList.h
   trunk/src/config.h
   trunk/src/config.h.in
Log:
dodanie sprawdzania w configure libmagic libssh, koretka przy wykrywaniu typu plikow na podstawie zawartosci dla pewnych typow


Modified: trunk/configure
===================================================================
--- trunk/configure	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/configure	2006-04-30 16:23:02 UTC (rev 297)
@@ -20958,6 +20958,7 @@
 fi
 
 
+
 echo "$as_me:$LINENO: checking for ANSI C header files" >&5
 echo $ECHO_N "checking for ANSI C header files... $ECHO_C" >&6
 if test "${ac_cv_header_stdc+set}" = set; then
@@ -21286,6 +21287,320 @@
 done
 
 
+
+
+for ac_header in libssh/sftp.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $ac_header usability" >&5
+echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_cxx_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $ac_header presence" >&5
+echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <$ac_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_cxx_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_cxx_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ---------------------------------------- ##
+## Report this to http://openspace.linux.pl ##
+## ---------------------------------------- ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=\$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  { { echo "$as_me:$LINENO: error: \"libssh/sftp.h not found\"" >&5
+echo "$as_me: error: \"libssh/sftp.h not found\"" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+done
+
+
+
+for ac_header in magic.h
+do
+as_ac_Header=`echo "ac_cv_header_$ac_header" | $as_tr_sh`
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+else
+  # Is the header compilable?
+echo "$as_me:$LINENO: checking $ac_header usability" >&5
+echo $ECHO_N "checking $ac_header usability... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_includes_default
+#include <$ac_header>
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_cxx_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_header_compiler=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_header_compiler=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_compiler" >&5
+echo "${ECHO_T}$ac_header_compiler" >&6
+
+# Is the header present?
+echo "$as_me:$LINENO: checking $ac_header presence" >&5
+echo $ECHO_N "checking $ac_header presence... $ECHO_C" >&6
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <$ac_header>
+_ACEOF
+if { (eval echo "$as_me:$LINENO: \"$ac_cpp conftest.$ac_ext\"") >&5
+  (eval $ac_cpp conftest.$ac_ext) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } >/dev/null; then
+  if test -s conftest.err; then
+    ac_cpp_err=$ac_cxx_preproc_warn_flag
+    ac_cpp_err=$ac_cpp_err$ac_cxx_werror_flag
+  else
+    ac_cpp_err=
+  fi
+else
+  ac_cpp_err=yes
+fi
+if test -z "$ac_cpp_err"; then
+  ac_header_preproc=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+  ac_header_preproc=no
+fi
+rm -f conftest.err conftest.$ac_ext
+echo "$as_me:$LINENO: result: $ac_header_preproc" >&5
+echo "${ECHO_T}$ac_header_preproc" >&6
+
+# So?  What about this header?
+case $ac_header_compiler:$ac_header_preproc:$ac_cxx_preproc_warn_flag in
+  yes:no: )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&5
+echo "$as_me: WARNING: $ac_header: accepted by the compiler, rejected by the preprocessor!" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the compiler's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the compiler's result" >&2;}
+    ac_header_preproc=yes
+    ;;
+  no:yes:* )
+    { echo "$as_me:$LINENO: WARNING: $ac_header: present but cannot be compiled" >&5
+echo "$as_me: WARNING: $ac_header: present but cannot be compiled" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     check for missing prerequisite headers?" >&5
+echo "$as_me: WARNING: $ac_header:     check for missing prerequisite headers?" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: see the Autoconf documentation" >&5
+echo "$as_me: WARNING: $ac_header: see the Autoconf documentation" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&5
+echo "$as_me: WARNING: $ac_header:     section \"Present But Cannot Be Compiled\"" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: proceeding with the preprocessor's result" >&5
+echo "$as_me: WARNING: $ac_header: proceeding with the preprocessor's result" >&2;}
+    { echo "$as_me:$LINENO: WARNING: $ac_header: in the future, the compiler will take precedence" >&5
+echo "$as_me: WARNING: $ac_header: in the future, the compiler will take precedence" >&2;}
+    (
+      cat <<\_ASBOX
+## ---------------------------------------- ##
+## Report this to http://openspace.linux.pl ##
+## ---------------------------------------- ##
+_ASBOX
+    ) |
+      sed "s/^/$as_me: WARNING:     /" >&2
+    ;;
+esac
+echo "$as_me:$LINENO: checking for $ac_header" >&5
+echo $ECHO_N "checking for $ac_header... $ECHO_C" >&6
+if eval "test \"\${$as_ac_Header+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  eval "$as_ac_Header=\$ac_header_preproc"
+fi
+echo "$as_me:$LINENO: result: `eval echo '${'$as_ac_Header'}'`" >&5
+echo "${ECHO_T}`eval echo '${'$as_ac_Header'}'`" >&6
+
+fi
+if test `eval echo '${'$as_ac_Header'}'` = yes; then
+  cat >>confdefs.h <<_ACEOF
+#define `echo "HAVE_$ac_header" | $as_tr_cpp` 1
+_ACEOF
+
+else
+  { { echo "$as_me:$LINENO: error: \"magic.h not found\"" >&5
+echo "$as_me: error: \"magic.h not found\"" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+done
+
+
+
+
+
 # Extract the first word of "fox-config", so it can be a program name with args.
 set dummy fox-config; ac_word=$2
 echo "$as_me:$LINENO: checking for $ac_word" >&5
@@ -21372,6 +21687,8 @@
         fi
 
 
+
+
                                                                                                     ac_config_files="$ac_config_files openspacerc Makefile src/Makefile icons/Makefile icons/default/Makefile icons/mini/Makefile icons/big/Makefile src/plugins/Makefile src/plugins/filelist/Makefile src/plugins/cmddialog/Makefile"
 
 cat >confcache <<\_ACEOF

Modified: trunk/configure.ac
===================================================================
--- trunk/configure.ac	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/configure.ac	2006-04-30 16:23:02 UTC (rev 297)
@@ -39,11 +39,22 @@
 dnl Check for FOX
 AC_CHECK_LIB(FOX-1.4,fxfindfox,,AC_MSG_ERROR("libFOX-1.4 not found"))
 
+
 dnl Checks for FOX 1.4 header files.
 AC_HEADER_STDC
 AC_LANG_CPLUSPLUS
 AC_CHECK_HEADERS(fox-1.4/fx.h,,AC_MSG_ERROR("fox-1.4/fx.h not found"))
 
+
+dnl Checks for libssh header files.
+AC_CHECK_HEADERS(libssh/sftp.h,,AC_MSG_ERROR("libssh/sftp.h not found"))
+
+dnl Checks for libmagic header files.
+AC_CHECK_HEADERS(magic.h,,AC_MSG_ERROR("magic.h not found"))
+
+
+
+
 AC_CHECK_PROG(FOX_CONFIG, fox-config,yes,no )
         if test "$FOX_CONFIG" = "no"
         then     
@@ -56,6 +67,8 @@
         fi
 
 
+
+
 AC_CONFIG_FILES([
 		 openspacerc
 		 Makefile

Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/src/OSFileList.cpp	2006-04-30 16:23:02 UTC (rev 297)
@@ -492,7 +492,7 @@
 
     string r;
     
-    if(!mime_magic)
+    if(!mime_magic || type!="local" || type!="search")
     {
       r = OSMimeType::getMimeFromName (name);      
     }
@@ -505,7 +505,8 @@
        r=r.substr(0,n);
       }
       
-      if(r=="")
+      if(r=="" || r=="video/unknown" || r=="application/octet-stream" || r=="audio/X-HX-AAC-ADTS") // .serverauth.9710: video/unknown
+
       r = OSMimeType::getMimeFromName (name);
       
     } 
@@ -1825,10 +1826,10 @@
     }
     else if (fl->sort_nr == -1) //extension sorting
     {
-    string exta = OSFileList::getfiletype (a->getText ().text ());
+    string exta = fl->getfiletype (a->getText ().text ());
     if (exta == "")
         exta = "zzzzz";
-    string extb = OSFileList::getfiletype (b->getText ().text ());
+    string extb = fl->getfiletype (b->getText ().text ());
     if (exta == "")
         extb = "zzzzz";
 

Modified: trunk/src/OSFileList.h
===================================================================
--- trunk/src/OSFileList.h	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/src/OSFileList.h	2006-04-30 16:23:02 UTC (rev 297)
@@ -116,7 +116,7 @@
     string getdefaultcommand ( string name );
     string resolvecommand( string command, string name );
     int runCommand( string name );
-    static string getfiletype ( string name );
+    string getfiletype ( string name);
     static string getfiledescription ( string name );
     long setKeys ( void );
 

Modified: trunk/src/config.h
===================================================================
--- trunk/src/config.h	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/src/config.h	2006-04-30 16:23:02 UTC (rev 297)
@@ -35,10 +35,16 @@
 /* Define to 1 if you have the `FOX-1.4' library (-lFOX-1.4). */
 #define HAVE_LIBFOX_1_4 1
 
+/* Define to 1 if you have the <libssh/sftp.h> header file. */
+#define HAVE_LIBSSH_SFTP_H 1
+
 /* Define to 1 if `lstat' has the bug that it succeeds when given the
    zero-length file name argument. */
 /* #undef HAVE_LSTAT_EMPTY_STRING_BUG */
 
+/* Define to 1 if you have the <magic.h> header file. */
+#define HAVE_MAGIC_H 1
+
 /* Define to 1 if you have the <memory.h> header file. */
 #define HAVE_MEMORY_H 1
 

Modified: trunk/src/config.h.in
===================================================================
--- trunk/src/config.h.in	2006-04-30 15:27:29 UTC (rev 296)
+++ trunk/src/config.h.in	2006-04-30 16:23:02 UTC (rev 297)
@@ -34,10 +34,16 @@
 /* Define to 1 if you have the `FOX-1.4' library (-lFOX-1.4). */
 #undef HAVE_LIBFOX_1_4
 
+/* Define to 1 if you have the <libssh/sftp.h> header file. */
+#undef HAVE_LIBSSH_SFTP_H
+
 /* Define to 1 if `lstat' has the bug that it succeeds when given the
    zero-length file name argument. */
 #undef HAVE_LSTAT_EMPTY_STRING_BUG
 
+/* Define to 1 if you have the <magic.h> header file. */
+#undef HAVE_MAGIC_H
+
 /* Define to 1 if you have the <memory.h> header file. */
 #undef HAVE_MEMORY_H
 



From compbatant at berlios.de  Sun Apr 30 18:37:28 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 30 Apr 2006 18:37:28 +0200
Subject: [Openspace-svn] r298 - trunk/src
Message-ID: <200604301637.k3UGbS7G008263@sheep.berlios.de>

Author: compbatant
Date: 2006-04-30 18:37:25 +0200 (Sun, 30 Apr 2006)
New Revision: 298

Modified:
   trunk/src/OSFileList.cpp
Log:
jescze poprawka na rozpoznawanie typow plikow po zawartosci


Modified: trunk/src/OSFileList.cpp
===================================================================
--- trunk/src/OSFileList.cpp	2006-04-30 16:23:02 UTC (rev 297)
+++ trunk/src/OSFileList.cpp	2006-04-30 16:37:25 UTC (rev 298)
@@ -492,12 +492,8 @@
 
     string r;
     
-    if(!mime_magic || type!="local" || type!="search")
+    if(mime_magic && (type=="local" || type=="search"))
     {
-      r = OSMimeType::getMimeFromName (name);      
-    }
-    else
-    {	
       r = magic_file(ms, name.c_str());
       string::size_type n;
       if((n=r.find(";"))!=string::npos)
@@ -505,10 +501,14 @@
        r=r.substr(0,n);
       }
       
-      if(r=="" || r=="video/unknown" || r=="application/octet-stream" || r=="audio/X-HX-AAC-ADTS") // .serverauth.9710: video/unknown
+      if(r=="" || r=="video/unknown" || r=="application/octet-stream" || r=="FFF6    0xFFF0          audio/X-HX-AAC-ADTS") // .serverauth.9710: video/unknown
 
-      r = OSMimeType::getMimeFromName (name);
-      
+      r = OSMimeType::getMimeFromName (name);    
+    }
+    else
+    {	
+     r = OSMimeType::getMimeFromName (name);
+ 
     } 
    //printf("Name: '%s' MimeType: '%s'\n", name.c_str(), r.c_str());
 



From compbatant at berlios.de  Sun Apr 30 18:43:07 2006
From: compbatant at berlios.de (compbatant at BerliOS)
Date: Sun, 30 Apr 2006 18:43:07 +0200
Subject: [Openspace-svn] r299 - trunk
Message-ID: <200604301643.k3UGh763009778@sheep.berlios.de>

Author: compbatant
Date: 2006-04-30 18:42:35 +0200 (Sun, 30 Apr 2006)
New Revision: 299

Modified:
   trunk/README
Log:
readme


Modified: trunk/README
===================================================================
--- trunk/README	2006-04-30 16:37:25 UTC (rev 298)
+++ trunk/README	2006-04-30 16:42:35 UTC (rev 299)
@@ -4,7 +4,10 @@
 *FOX toolkit library in version 1.4.x http://fox-toolkit.org
 *libpng
 *libxml2
+*libssh - tested on version 0.11 http://0xbadc0de.be/libssh/libssh-0.11.tgz
+*libmagic
 
+
 LICENSING
 This software is Copyright (c) 2005 by Mateusz Dworak.
 	You are free to distribute this software under the terms



